unit UPrincipal;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
   Dialogs, DB, DBTables, StdCtrls, Buttons, ComCtrls, DBXpress, FMTBcd,
  SqlExpr, DBClient, Provider, DBCtrls;

type
  TFPrincipal = class(TForm)
    ProgressBar1: TProgressBar;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    Label4: TLabel;
    Label5: TLabel;
    Button1: TButton;
    Conexao: TSQLConnection;
    QDestino: TSQLQuery;
    QOrigem: TQuery;
    sqlDestino: TSQLDataSet;
    dspDestino: TDataSetProvider;
    cdsDestino: TClientDataSet;
    QEventos: TQuery;
    QPagamentos: TQuery;
    sqlParcelas: TSQLDataSet;
    sqlParcelasCOD_EMP_PAR: TIntegerField;
    sqlParcelasCOD_DIV_PAR: TIntegerField;
    sqlParcelasTP_PAR: TIntegerField;
    sqlParcelasPARCELA_PAR: TIntegerField;
    sqlParcelasDATAPAGTO_PAR: TDateField;
    sqlParcelasDATAMOVIM_PAR: TDateField;
    sqlParcelasLOTE_PAR: TIntegerField;
    sqlParcelasCOD_BCO_PAR: TIntegerField;
    sqlParcelasSITUACAO_PAR: TIntegerField;
    sqlParcelasUNICA_PAR: TStringField;
    dspParcelas: TDataSetProvider;
    cdsParcelas: TClientDataSet;
    cdsReceitas: TClientDataSet;
    dspReceitas: TDataSetProvider;
    sqlReceitas: TSQLDataSet;
    sqlReceitasCOD_EMP_FRC: TIntegerField;
    sqlReceitasCOD_DIV_FRC: TIntegerField;
    sqlReceitasPARCELA_PAR_FRC: TIntegerField;
    sqlReceitasTP_PAR_FRC: TIntegerField;
    sqlReceitasCOD_REC_FRC: TIntegerField;
    sqlReceitasANO_FRC: TStringField;
    sqlReceitasSITUACAO_FRC: TIntegerField;
    sqlReceitasCODORIGEM_FRC: TIntegerField;
    sqlReceitasCOD_IND_FRC: TIntegerField;
    sqlReceitasLVALOR_FRC: TFloatField;
    sqlReceitasLVRCORRE_FRC: TFloatField;
    sqlReceitasLVRMULTA_FRC: TFloatField;
    sqlReceitasLVRJUROS_FRC: TFloatField;
    sqlReceitasLISENTO_FRC: TFloatField;
    sqlReceitasLDESCOVENCI_FRC: TFloatField;
    sqlReceitasLDESCOR_FRC: TFloatField;
    sqlReceitasLDESCOC_FRC: TFloatField;
    sqlReceitasLDESCOM_FRC: TFloatField;
    sqlReceitasLDESCOJ_FRC: TFloatField;
    sqlReceitasLACRES_FRC: TFloatField;
    sqlReceitasPVALOR_FRC: TFloatField;
    sqlReceitasPVRCORRE_FRC: TFloatField;
    sqlReceitasPVRMULTA_FRC: TFloatField;
    sqlReceitasPVRJUROS_FRC: TFloatField;
    sqlReceitasPISENTO_FRC: TFloatField;
    sqlReceitasPDESCOVENCI_FRC: TFloatField;
    sqlReceitasPDESDCO_FRC: TFloatField;
    sqlReceitasLOGIN_INC_FRC: TStringField;
    sqlReceitasDTA_INC_FRC: TSQLTimeStampField;
    sqlReceitasLOGIN_ALT_FRC: TStringField;
    sqlReceitasDTA_ALT_FRC: TSQLTimeStampField;
    sqlReceitasCODULTORI_FRC: TIntegerField;
    sqlReceitasOUTRAS_FRC: TStringField;
    sqlReceitasPDESCOR_FRC: TFloatField;
    sqlReceitasPDESCOC_FRC: TFloatField;
    sqlReceitasPDESCOM_FRC: TFloatField;
    sqlReceitasPDESCOJ_FRC: TFloatField;
    sqlParcelasEXECUTADA_PAR: TStringField;
    sqlParcelasATIVA_PAR: TStringField;
    QVerifica: TSQLQuery;
    sqlParcelasSITUACAOANTIGA_PAR: TIntegerField;
    sqlParcelasLIVRO_PAR: TIntegerField;
    sqlParcelasFOLHA_PAR: TIntegerField;
    sqlParcelasINSCRI_PAR: TIntegerField;
    sqlParcelasDATAINSCRI_PAR: TDateField;
    sqlParcelasDATAVENCI: TDateField;
    sqlParcelasMOEDA_PAR: TStringField;
    sqlParcelasCOD_IND_PAR: TIntegerField;
    sqlParcelasDATAGERACAO_PAR: TDateField;
    sqlParcelasDATAEXEC_PARC: TDateField;
    sqlParcelasCANCELADO_PAR: TStringField;
    sqlParcelasPARCE_PAR: TStringField;
    sqlParcelasDATACANCELA_PAR: TDateField;
    sqlParcelasDATAPARCE_PAR: TDateField;
    sqlParcelasPROCESSO_PAR: TStringField;
    sqlParcelasNNUMERO_PAR: TFloatField;
    sqlParcelasVALOR_PAR: TFloatField;
    sqlParcelasLOGIN_INC_PAR: TStringField;
    sqlParcelasDTA_INC_PAR: TSQLTimeStampField;
    sqlParcelasLOGIN_ALT_PAR: TStringField;
    sqlParcelasDTA_ALT_PAR: TSQLTimeStampField;
    QParcelamento: TQuery;
    QCadastro: TQuery;
    Label6: TLabel;
    QAuxiliar: TSQLQuery;
    Database1: TDatabase;
    QHistorico: TQuery;
    QBaixa: TSQLQuery;
    sqlAtualiza: TSQLDataSet;
    dspAtualiza: TDataSetProvider;
    cdsAtualiza: TClientDataSet;
    DBRichEdit1: TDBRichEdit;
    DataSource1: TDataSource;
    procedure ReceitaPrincipal;
    procedure receitas;
    procedure Limpa;
    procedure Button1Click(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure guias;
    procedure guiasParcelamento;
    procedure parcelas;
    procedure parcelasParcelamentos;
    procedure dividaativa;
    procedure outrasreceitas;
    procedure lancamentos;
    procedure Itens;
    procedure ItensCobranca;
    procedure lancamentosCobranca;
    Function Replace(Str: String; Lixo: String; Certo: String): String;
    Function TrataDadosFinanceiro(Valor : Variant) : string;
    procedure modulo;
    procedure Atividades;
    procedure mobiliario;
    Function TiraCaracter(s: String): Variant;
    function criaparcelamento(controle,matricula,ano,receita,dtparcelamento,codseq:String):Integer;
    function cidade(nome,Estado:String):String;
    function logradouro(nome,cep:String):String;
    function Bairro(nome:String):String;
    function Contribuintes(nome,rg,cnpj,fone,fax,email,cid,uf,logra,numero,complemento,bai,cep:String):String;
    function verificacodigodadivida(cadastro,ano,tributo,matricula,modulo:String):Integer;
    function buscacadastro(codigodevedor,nome,tributo:String):String;
    procedure multa;
    procedure Juros;
    procedure AtualizaDados;
    procedure Generators;
    procedure refis;
    procedure Indices;
    procedure bancos;
    procedure lotes;
    procedure gleba;
    procedure Agrupamento;
    procedure AcertaCadastro;
    procedure AcertaTestada;
    function OrigemDivida(modulo:Integer;divida:Integer):String;
    procedure AcertaCadastroLancamento;
    procedure Fichasreceitas;
    procedure Contabilizacao;
    procedure BuscaContribuinteDiversos;
    procedure renumeraContribuintes;
    procedure renumeraMobiliario;
    procedure GeraSecao;
    procedure tipologia;
    procedure acertaLogradouro;
    procedure AcertaMobiliario;
    procedure Leituras;
    procedure LeiturasCadastro;
    procedure NotasFiscaisAvulsa;
    procedure NotasFiscaisAvulsaItens;
    function ContribuintesNota(nome,rg,cnpj,fone,fax,email,cid,uf,logra,numero,complemento,bai,cep:String):String;
    procedure AcertaContribuintes;
    procedure AcertaContribuintes1;
    procedure AcertaHistorico;
    procedure Fiscais;
    procedure Graficas;
    procedure aidf;

    Function BaixaParcelasFinanceiro(empresa, divida, tipo, parcela: Integer; dtPagamento,
                                     dtMovimento, descontovenci, codbanco, lote: String;
                                     Correcao, Multa, Juros, ValorReceita,desconto,acrescimo,
                                   ValorPagamento: real;
                                   usu_baixa : string; codcxa : integer): Integer;

   procedure rateiacmjBaixa(var correcao:real;var multa:real;var juros:real;var desconto:Real;var acrescimo:real);

   Function AlteraFinanceiroBaixa_FI_RECEITAS(COD_EMP_FRC, COD_DIV_FRC, PARCELA_PAR_FRC, TP_PAR_FRC,
                                           COD_REC_FRC, ANO_FRC, SITUACAO_FRC, CODORIGEM_FRC, CODULTORI_FRC,
                                           PVALOR_FRC, PVRCORRE_FRC, PVRMULTA_FRC, PVRJUROS_FRC,
                                           PISENTO_FRC, PDESCOVENCI_FRC, PDESDCO_FRC,PDESCOR_FRC,PDESCOC_FRC,
                                           PDESCOM_FRC,PDESCOJ_FRC,LOGIN_ALT_FRC, DTA_ALT_FRC,LVALOR_FRC,
                                           usu_baixa, codcxa : Variant): Integer;


  Function AlteraFinanceiroBaixa_FI_PARCELA(COD_EMP_PAR, COD_DIV_PAR, PARCELA_PAR, TP_PAR,
                                            DATAPAGTO_PAR, DATAMOVIM_PAR, LOTE_PAR, COD_BCO_PAR,
                                            LOGIN_ALT_PAR, DTA_ALT_PAR,
                                            usu_baixa, codcxa: Variant): Integer;



  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  FPrincipal: TFPrincipal;
  TD:TTransactionDesc;
  tipodabaixa:String;

implementation
uses UnitFuncoes;

{$R *.dfm}

procedure TFPrincipal.rateiacmjBaixa(var correcao:real;var multa:real;var juros:real;var desconto:Real;var acrescimo:real);
var
  deduzcorrecao,deduzmulta,deduzjuros,diferenca,AuxDesconto,AuxAcrescimo:Double;
begin

 if (desconto>0) and ((correcao+multa+juros)>0) then
 begin

   if desconto>(correcao+multa+juros) then
   begin
     desconto:=desconto-(correcao+multa+juros);
     Correcao:=0;
     Juros:=0;
     MUlta:=0;
   end
   else
   begin

       deduzcorrecao:=correcao * (desconto/(correcao+multa+juros));
       deduzmulta:=multa * (desconto/(correcao+multa+juros));
       deduzjuros:=juros * (desconto/(correcao+multa+juros));

       deduzcorrecao:=trunc(deduzcorrecao*100)/100;
       deduzmulta:=trunc(deduzmulta*100)/100;
       deduzjuros:=trunc(deduzjuros*100)/100;

       diferenca:=desconto-(deduzcorrecao+deduzmulta+deduzjuros);

       correcao:=correcao-deduzCorrecao;
       multa:=multa-deduzMulta;
       juros:=juros-deduzjuros;

      if (diferenca>0) then
      begin
       if (juros>=diferenca) then
       begin
        juros:=juros-diferenca;
        diferenca:=0;
       end
       else
       begin
        diferenca:=diferenca-juros;
        juros:=0;
       end;
      end;

      if (diferenca>0) then
      begin
       if (multa>=diferenca) then
       begin
        multa:=multa-diferenca;
        diferenca:=0;
       end
       else
       begin
        diferenca:=diferenca-multa;
        multa:=0;
       end;
      end;

      if (diferenca>0) then
      begin
       if (correcao>=diferenca) then
       begin
        correcao:=correcao-diferenca;
        diferenca:=0;
       end;
      end;
      desconto:=0;
   end;

 end;///desconto>0


  if (Acrescimo>0) then
    if ((correcao+multa+juros)>0) then
    begin
       deduzcorrecao:=correcao * (Acrescimo/(correcao+multa+juros));
       deduzmulta:=multa * (Acrescimo/(correcao+multa+juros));
       deduzjuros:=juros * (Acrescimo/(correcao+multa+juros));

       deduzcorrecao:=trunc(deduzcorrecao*100)/100;
       deduzmulta:=trunc(deduzmulta*100)/100;
       deduzjuros:=trunc(deduzjuros*100)/100;

       diferenca:=Acrescimo-(deduzcorrecao+deduzmulta+deduzjuros);

       correcao:=correcao+deduzCorrecao;
       multa:=multa+deduzMulta;
       juros:=juros+deduzjuros;

       juros:=juros+diferenca;
       diferenca:=0;
    end
    else
     juros:=acrescimo;


end;




Function TFPrincipal.BaixaParcelasFinanceiro(empresa, divida, tipo, parcela: Integer; dtPagamento,
                                 dtMovimento, descontovenci, codbanco,
                                 lote: String; Correcao, Multa, Juros, ValorReceita,
                                 desconto,acrescimo,ValorPagamento: real;
                                 usu_baixa : string; codcxa : integer): Integer;
Var Erros,ja,numerodereceitas,contReceitas: Integer;
    vrCorrecao, VrMulta, vrJuros,difercorrecao,diferjuros,difermulta,vrDesconto,diferDesconto,diferPagto,acerto: Double;
    PVALOR_FRC, PVRCORRE_FRC, PVRMULTA_FRC, PVRJUROS_FRC,
    PISENTO_FRC, PDESCOVENCI_FRC, PDESDCO_FRC,PDESCOR_FRC,PDESCOC_FRC,
    PDESCOM_FRC,PDESCOJ_FRC,LOGIN_ALT_FRC,DTA_ALT_FRC,LVALOR_FRC,
    SITUACAO_PAR,SITUACAOANTIGA_PAR,LOGIN_ALT_PAR,DTA_ALT_PAR : Variant;
Begin
  result := 1;
  rateiacmjBaixa(correcao, multa, juros, desconto, acrescimo);

  if trim(dtmovimento) = '' then dtmovimento := DateToStr(date);
  if trim(dtpagamento) = '' then dtpagamento := DateToStr(date);

  cdsParcelas.Close;
  sqlParcelas.Params.ParamValues['empresa'] := empresa;
  sqlParcelas.Params.ParamValues['divida']  := divida;
  sqlParcelas.Params.ParamValues['tipo']    := tipo;
  sqlParcelas.Params.ParamValues['parcela'] := parcela;
  cdsParcelas.Open;

  difercorrecao := 0; diferjuros := 0; difermulta := 0;
  If Not cdsParcelas.IsEmpty Then Begin


     if (cdsParcelas.FieldByName('SITUACAO_PAR').value>=0) and
        (cdsParcelas.FieldByName('SITUACAO_PAR').value<=9999) then begin

            cdsReceitas.Close;
            sqlReceitas.Params.ParamValues['empresa'] := empresa;
            sqlReceitas.Params.ParamValues['divida']  := divida;
            sqlReceitas.Params.ParamValues['tipo']    := tipo;
            sqlReceitas.Params.ParamValues['parcela'] := parcela;
            cdsReceitas.Open;

            numerodereceitas:=cdsReceitas.recordcount;
            contreceitas := 1;

            LOGIN_ALT_FRC := 'CONVERSAO';
            DTA_ALT_FRC   := DATETOSTR(DATE);

            While Not cdsReceitas.Eof Do Begin
              // Rolo
              if valorreceita = 0 then begin
                valorreceita := juros;
                juros:=0;
                lvalor_frc   := valorreceita;
              end
              else lvalor_frc := cdsReceitas.fieldByName('lvalor_frc').value;

              if ValorReceita = 0 then
                vrDesconto := (lvalor_frc -
                               cdsReceitas.fieldByName('ldescor_frc').value -
                               cdsReceitas.fieldByName('lisento_frc').value)
              else
                vrDesconto := (lvalor_frc -
                               cdsReceitas.fieldByName('ldescor_frc').value -
                               cdsReceitas.fieldByName('lisento_frc').value) *
                               (desconto / ValorReceita);

              vrDesconto    := trunc(vrDesconto * 100) / 100;
              diferDesconto := diferDesconto + vrDesconto;

              pdescor_frc := vrDesconto;

              pvalor_frc := lvalor_frc -
                            cdsReceitas.fieldByName('ldescor_frc').Value -
                            cdsReceitas.fieldByName('lisento_frc').value -
                            pdescor_frc;

              If descontovenci = 'SNN' Then Begin
                 pvalor_frc := pvalor_frc - cdsReceitas.fieldByName('ldescovenci_frc').value;
                 pdescovenci_frc := cdsReceitas.fieldByName('ldescovenci_frc').value;
              End
              Else pdescovenci_frc:= 0;

              if ValorReceita>0 then
              vrCorrecao := pvalor_frc * (correcao / ValorReceita)
              else
              vrCorrecao:=0;

              if ValorReceita>0 then
              vrMulta    := pvalor_frc * (Multa / ValorReceita)
              else
              vrMulta:=0;

              if ValorReceita>0 then
              vrJuros    := pvalor_frc * (Juros / ValorReceita)
              else
              vrJuros:=0;

              vrCorrecao := trunc(vrCorrecao * 100) / 100;
              vrMulta    := trunc(vrMulta * 100) / 100;
              vrJuros    := trunc(vrJuros * 100) / 100;

              diferCorrecao := diferCorrecao + vrCorrecao;
              diferMulta    := diferMulta + vrMulta;
              diferJuros    := diferJuros + vrJuros;

              pvrcorre_frc := cdsReceitas.fieldByName('lvrcorre_frc').Value - cdsReceitas.fieldByName('ldescoc_frc').Value + vrCorrecao;
              pvrmulta_frc := cdsReceitas.fieldByName('lvrmulta_frc').Value - cdsReceitas.fieldByName('ldescom_frc').Value + vrMulta;
              pvrjuros_frc := cdsReceitas.fieldByName('lvrjuros_frc').Value - cdsReceitas.fieldByName('ldescoj_frc').Value + cdsReceitas.fieldByName('lacres_frc').Value + vrJuros;

              pdescoc_frc := cdsReceitas.fieldByName('ldescoc_frc').Value;
              pdescom_frc := cdsReceitas.fieldByName('ldescom_frc').Value;
              pdescoj_frc := cdsReceitas.fieldByName('ldescoj_frc').Value;


              pisento_frc := cdsReceitas.fieldByName('lisento_frc').Value;
              pdesdco_frc := cdsReceitas.fieldByName('ldescoc_frc').Value + cdsReceitas.fieldByName('ldescom_frc').Value + cdsReceitas.fieldByName('ldescoj_frc').Value + cdsReceitas.fieldByName('ldescor_frc').Value;



              if contreceitas=numerodereceitas then begin // acerta valores das diferenças
               pvalor_frc   := pvalor_frc - (desconto - diferdesconto) ;
               pdescor_frc  := pdescor_frc + (desconto - diferdesconto) ;
               pvrcorre_frc := pvrcorre_frc + (correcao - difercorrecao) ;
               pvrmulta_frc := pvrmulta_frc + (multa - difermulta) ;
               pvrjuros_frc := pvrjuros_frc + (juros - diferjuros);
              end;


              diferPagto:=diferPagto+pvalor_frc+pvrcorre_frc+pvrmulta_frc+pvrjuros_frc;

              if numerodereceitas=contreceitas then begin // acerta as diferenças no ultimo registro com pagamento

                 if diferPagto<valorPagamento then
                 pvrjuros_frc:=pvrjuros_frc+(valorPagamento-diferPagto)
                 else
                 if diferPagto>valorPagamento then
                 begin
                   acerto:=diferPagto-valorPagamento;
                   if (pvrjuros_frc>=acerto) and (acerto>0) then
                     pvrjuros_frc:=pvrjuros_frc-acerto
                   else
                   if (pvrmulta_frc>=acerto) and (acerto>0) then
                     pvrmulta_frc:=pvrmulta_frc-acerto
                   else
                   if (pvrcorre_frc>=acerto) and (acerto>0) then
                     pvrcorre_frc:=pvrcorre_frc-acerto
                   else
                   if (pvalor_frc>=acerto) and (acerto>0) then
                     pvalor_frc:=pvalor_frc-acerto;
                 end;

              end;




              AlteraFinanceiroBaixa_FI_RECEITAS(cdsReceitas.fieldByName('COD_EMP_FRC').value,
                                           cdsReceitas.fieldByName('COD_DIV_FRC').value,
                                           cdsReceitas.fieldByName('PARCELA_PAR_FRC').value,
                                           cdsReceitas.fieldByName('TP_PAR_FRC').value,
                                           cdsReceitas.fieldByName('COD_REC_FRC').value,
                                           cdsReceitas.fieldByName('ANO_FRC').value,
                                           cdsReceitas.fieldByName('SITUACAO_FRC').value,
                                           cdsReceitas.fieldByName('CODORIGEM_FRC').value,
                                           cdsReceitas.fieldByName('CODULTORI_FRC').value,
                                           PVALOR_FRC,
                                           PVRCORRE_FRC,
                                           PVRMULTA_FRC,
                                           PVRJUROS_FRC,
                                           PISENTO_FRC,
                                           PDESCOVENCI_FRC,
                                           PDESDCO_FRC,
                                           PDESCOR_FRC,
                                           PDESCOC_FRC,
                                           PDESCOM_FRC,
                                           PDESCOJ_FRC,
                                           LOGIN_ALT_FRC,
                                           StrToDateTime(DTA_ALT_FRC),
                                           LVALOR_FRC,
                                           usu_baixa,
                                           codcxa);

              contreceitas := contreceitas + 1;
              cdsReceitas.next;
            End;

            //SITUACAOANTIGA_PAR := 0; //QOrigem.fieldByName('di_situacao').AsInteger;

           { if cdsParcelas.fieldByName('executada_par').AsString  = 'S' then SITUACAO_PAR := 8
            else if cdsParcelas.fieldByName('ativa_par').AsString = 'S' then SITUACAO_PAR := 7
            else SITUACAO_PAR := 6;
            }

            LOGIN_ALT_PAR := 'CONVERSAO';
            DTA_ALT_PAR   := DATETOSTR(DATE);

            AlteraFinanceiroBaixa_FI_PARCELA(cdsParcelas.fieldByName('COD_EMP_PAR').value,
                                             cdsParcelas.fieldByName('COD_DIV_PAR').value,
                                             cdsParcelas.fieldByName('PARCELA_PAR').value,
                                             cdsParcelas.fieldByName('TP_PAR').value,
                                             Invertedata(dtPagamento),
                                             invertedata(dtMovimento),
                                             strToInt(lote),
                                             strToInt(codbanco),
                                             LOGIN_ALT_PAR,
                                             strtoDateTime(DTA_ALT_PAR),
                                             usu_baixa,
                                             codcxa);


       result := 2;
     end
     else result := 3;
  End; //Não é vazio o cdsParcelas
End;





Function TFPrincipal.AlteraFinanceiroBaixa_FI_RECEITAS(COD_EMP_FRC, COD_DIV_FRC, PARCELA_PAR_FRC, TP_PAR_FRC,
                                           COD_REC_FRC, ANO_FRC, SITUACAO_FRC, CODORIGEM_FRC, CODULTORI_FRC,
                                           PVALOR_FRC, PVRCORRE_FRC, PVRMULTA_FRC, PVRJUROS_FRC,
                                           PISENTO_FRC, PDESCOVENCI_FRC, PDESDCO_FRC,PDESCOR_FRC,PDESCOC_FRC,
                                           PDESCOM_FRC,PDESCOJ_FRC,LOGIN_ALT_FRC, DTA_ALT_FRC,LVALOR_FRC,
                                           usu_baixa, codcxa : Variant): Integer;
Var qrx: TSQLQuery;

Begin
 try
    qrx := TSQLQuery.Create(Application.Owner);
    qrx.SQLConnection := Conexao;
    qrx.sql.text := ' UPDATE FI_RECEITAS SET '+
                         ' PVALOR_FRC='+TrataDadosFinanceiro(PVALOR_FRC)+','+
                         ' PVRCORRE_FRC='+TrataDadosFinanceiro(PVRCORRE_FRC)+','+
                         ' PVRMULTA_FRC='+TrataDadosFinanceiro(PVRMULTA_FRC)+','+
                         ' PVRJUROS_FRC='+TrataDadosFinanceiro(PVRJUROS_FRC)+','+
                         ' PISENTO_FRC='+TrataDadosFinanceiro(PISENTO_FRC)+','+
                         ' PDESCOVENCI_FRC='+TrataDadosFinanceiro(PDESCOVENCI_FRC)+','+
                         ' PDESDCO_FRC='+TrataDadosFinanceiro(PDESDCO_FRC)+','+
                         ' PDESCOR_FRC='+TrataDadosFinanceiro(PDESCOR_FRC)+','+
                         ' PDESCOC_FRC='+TrataDadosFinanceiro(PDESCOC_FRC)+','+
                         ' PDESCOM_FRC='+TrataDadosFinanceiro(PDESCOM_FRC)+','+
                         ' PDESCOJ_FRC='+TrataDadosFinanceiro(PDESCOJ_FRC)+','+
                         ' LOGIN_INC_FRC='+TrataDadosFinanceiro(LOGIN_ALT_FRC)   +','+
                         ' DTA_INC_FRC='+TrataDadosFinanceiro(DTA_ALT_FRC)+','+
                         ' LOGIN_ALT_FRC='+TrataDadosFinanceiro(usu_baixa)   +','+
                         ' DTA_ALT_FRC='+TrataDadosFinanceiro(DTA_ALT_FRC)+','+
                         ' LVALOR_FRC='+TrataDadosFinanceiro(LVALOR_FRC)+
                    ' WHERE COD_EMP_FRC='+TrataDadosFinanceiro(COD_EMP_FRC)+
                      ' AND COD_DIV_FRC='+TrataDadosFinanceiro(COD_DIV_FRC)+
                      ' AND PARCELA_PAR_FRC='+TrataDadosFinanceiro(PARCELA_PAR_FRC)+
                      ' AND TP_PAR_FRC='+TrataDadosFinanceiro(TP_PAR_FRC)+
                      ' AND COD_REC_FRC='+TrataDadosFinanceiro(COD_REC_FRC)+
                      ' AND ANO_FRC='+TrataDadosFinanceiro(ANO_FRC)+
                      ' AND SITUACAO_FRC='+TrataDadosFinanceiro(SITUACAO_FRC)+
                      ' AND CODORIGEM_FRC='+TrataDadosFinanceiro(CODORIGEM_FRC)+
                      ' AND CODULTORI_FRC='+TrataDadosFinanceiro(CODULTORI_FRC);
    qrx.ExecSQL;

    qrx.Close;
    qrx.Free;
    Result := 0;
 except
   on E: Exception do begin
    ShowMessage(E.Message);
    qrx.Close;
    qrx.Free;
    Result := 1;
   end;
 end;
End;


Function TFPrincipal.AlteraFinanceiroBaixa_FI_PARCELA(COD_EMP_PAR, COD_DIV_PAR, PARCELA_PAR, TP_PAR,
                                     DATAPAGTO_PAR, DATAMOVIM_PAR, LOTE_PAR, COD_BCO_PAR,
                                     LOGIN_ALT_PAR,
                                     DTA_ALT_PAR, usu_baixa, codcxa : Variant ): Integer;
Var qrx: TSQLQuery;
Begin
 try
    qrx := TSQLQuery.Create(Application.Owner);
    qrx.SQLConnection := Conexao;
    qrx.sql.text := 'UPDATE FI_PARCELA SET '+
                      ' DATAPAGTO_PAR = '+ TrataDadosFinanceiro(DATAPAGTO_PAR)  +','+
                      ' DATAMOVIM_PAR = '+ TrataDadosFinanceiro(DATAMOVIM_PAR)  +','+
                      ' LOTE_PAR = '+ TrataDadosFinanceiro(LOTE_PAR)       +','+
                      ' COD_BCO_PAR = '+ TrataDadosFinanceiro(COD_BCO_PAR)    +','+
                      ' LOGIN_INC_PAR = '+ TrataDadosFinanceiro(usu_baixa)  +','+
                      ' DTA_INC_PAR = '+ TrataDadosFinanceiro(DTA_ALT_PAR) +','+
                      ' LOGIN_ALT_PAR = '+ TrataDadosFinanceiro(usu_baixa)  +','+
                      ' DTA_ALT_PAR = '+ TrataDadosFinanceiro(DTA_ALT_PAR)  +','+
                      ' COD_CXA_PAR = '+ TrataDadosFinanceiro(codcxa) +
                    ' WHERE COD_EMP_PAR = '+TrataDadosFinanceiro(COD_EMP_PAR)+
                      ' AND COD_DIV_PAR = '+TrataDadosFinanceiro(COD_DIV_PAR)+
                      ' AND PARCELA_PAR = '+TrataDadosFinanceiro(PARCELA_PAR)+
                      ' AND TP_PAR = '+TrataDadosFinanceiro(TP_PAR);

    qrx.ExecSQL;

    qrx.Close;
    qrx.Free;
    Result := 0;
 except
   on E: Exception do begin
    ShowMessage(E.Message);
    qrx.Close;
    qrx.Free;
    Result := -1;
   end;
 end;
End;




procedure TFPrincipal.AcertaContribuintes;
var cadastro:String;
begin
    QOrigem.close;
    QOrigem.sql.clear;
    QOrigem.sql.add('select * from cadastro where cdtipocadastro=2 AND nrcgcCpf<>0');
    QOrigem.open;

    while not QOrigem.eof do
    begin

     QDestino.close;
     QDestino.sql.clear;
     QDestino.sql.add(' SELECT COD_CNT,CNPJ_CNT,COD_MBL FROM LI_MOBIL '+
     ' INNER JOIN GR_CONTRIBUINTES ON COD_EMP_CNT=COD_EMP_MBL AND COD_CNT=COD_CNT_MBL '+
     ' WHERE COD_EMP_MBL=1 AND COD_MBL='''+ZeraEsquerda(11,QOrigem.fieldByName('nrCadastro').AsString)+'''');
     QDestino.open;
     if not QDestino.IsEmpty then
     begin

          if (length(trim(QOrigem.fieldByName('nrcgcCpf').AsString))>=12 ) then
          begin
           QVerifica.close;
           QVerifica.sql.clear;
           QVerifica.sql.add('UPDATE GR_CONTRIBUINTES SET LOGIN_INC_CNT=''CSA1'',CNPJ_CNT='''+ZeraEsquerda(14,QOrigem.fieldByName('nrcgcCpf').AsString)+''' WHERE COD_EMP_CNT=1 AND COD_CNT='''+QDestino.fieldByName('COD_CNT').AsString+'''');
           QVerifica.execsql;
          end
          else
          begin
           QVerifica.close;
           QVerifica.sql.clear;
           QVerifica.sql.add('UPDATE GR_CONTRIBUINTES SET LOGIN_INC_CNT=''CSA1'',CNPJ_CNT='''+ZeraEsquerda(11,QOrigem.fieldByName('nrcgcCpf').AsString)+''' WHERE COD_EMP_CNT=1 AND COD_CNT='''+QDestino.fieldByName('COD_CNT').AsString+'''');
           QVerifica.execsql;
          end;


     end;




     QOrigem.next;
    end;
end;



procedure TFPrincipal.AcertaContribuintes1;
var cadastro:String;
    cont:Integer;
begin
    QOrigem.close;
    QOrigem.sql.clear;
    QOrigem.sql.add('select * from cadastro where cdtipocadastro=4 AND nrcgcCpf<>0');
    QOrigem.open;
    cont:=1;

    while not QOrigem.eof do
    begin
     cont:=cont+1;
     label5.caption:=QOrigem.fieldByname('nrCadastro').AsString;
     label5.update;
     QDestino.close;
     QDestino.sql.clear;
     QDestino.sql.add('SELECT * FROM GR_CONTRIBUINTES WHERE COD_EMP_CNT=1 AND NOME_CNT='''+RetiraChar(trim(QOrigem.fieldByName('nmProprietRazao').AsString),'''')+'''');
     QDestino.open;
     if not QDestino.IsEmpty then
     begin

          if (length(trim(QOrigem.fieldByName('nrcgcCpf').AsString))>=12 ) then
          begin
           QVerifica.close;
           QVerifica.sql.clear;
           QVerifica.sql.add('UPDATE GR_CONTRIBUINTES SET LOGIN_INC_CNT=''CSA2'',CNPJ_CNT='''+ZeraEsquerda(14,QOrigem.fieldByName('nrcgcCpf').AsString)+''' WHERE COD_EMP_CNT=1 AND COD_CNT='''+QDestino.fieldByName('COD_CNT').AsString+'''');
           QVerifica.execsql;
          end
          else
          begin
           QVerifica.close;
           QVerifica.sql.clear;
           QVerifica.sql.add('UPDATE GR_CONTRIBUINTES SET LOGIN_INC_CNT=''CSA2'',CNPJ_CNT='''+ZeraEsquerda(11,QOrigem.fieldByName('nrcgcCpf').AsString)+''' WHERE COD_EMP_CNT=1 AND COD_CNT='''+QDestino.fieldByName('COD_CNT').AsString+'''');
           QVerifica.execsql;
          end;


     end;




     QOrigem.next;
    end;
end;



procedure TFPrincipal.AcertaHistorico;
var cadastro:String;
    Erros:Integer;
begin
    QOrigem.close;
    QOrigem.sql.clear;
    QOrigem.sql.add('select * from AVERBACAO where (cdtipocadastro=1 or cdtipocadastro=2 ) and (not dsAverbacao is null) ');
    QOrigem.open;

    while not QOrigem.eof do
    begin
      label5.caption:=QOrigem.fieldByName('nrCadastro').AsString;
      label5.update;
      if QOrigem.fieldByName('cdTipoCadastro').AsStrinG='1' then
      begin
         cdsdestino.close;
         sqlDestino.commandText:='SELECT * FROM IP_CAD_IPTU WHERE COD_EMP_IPT=1 AND COD_IPT='''+ZeraEsquerda(8,QOrigem.fieldByName('nrCadastro').AsString)+'''';
         cdsdestino.open;
         if not cdsDestino.IsEmpty then
         begin
          cdsdestino.edit;
          cdsdestino.fieldByName('histo_ipt').value:=QOrigem.fieldByName('dsAverbacao').value;
          Erros:=0;
          if not Conexao.InTransaction then Conexao.StartTransaction(TD);
          if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
          if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);
          if Erros = 0 then Conexao.Commit(TD)
          else begin
             Conexao.Rollback(TD);
          end;
         end;

      end
      else
      if QOrigem.fieldByName('cdTipoCadastro').AsString='2' then
      begin
         cdsdestino.close;
         sqlDestino.commandText:='SELECT * FROM LI_MOBIL WHERE COD_EMP_MBL=1 AND COD_MBL='''+ZeraEsquerda(11,QOrigem.fieldByName('nrCadastro').AsString)+'''';
         cdsdestino.open;
         if not cdsDestino.IsEmpty then
         begin
          cdsdestino.edit;
          cdsdestino.fieldByName('histo1_mbl').value:=QOrigem.fieldByName('dsAverbacao').value;
          Erros:=0;
          if not Conexao.InTransaction then Conexao.StartTransaction(TD);
          if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
          if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);
          if Erros = 0 then Conexao.Commit(TD)
          else begin
             Conexao.Rollback(TD);
          end;
         end;

      end;






     QOrigem.next;
    end;
end;



procedure TFPrincipal.Graficas;
var cadastro:String;
    Erros,cont:Integer;
begin
    QOrigem.close;
    QOrigem.sql.clear;
    QOrigem.sql.add('select * from grafica ');
    QOrigem.open;
    cont:=1;

    cdsdestino.close;
    sqlDestino.commandText:='SELECT * FROM LI_GRAFICAS ';
    cdsdestino.open;

    while not QOrigem.eof do
    begin
      label5.caption:=QOrigem.fieldByName('nrCGCGrafica').AsString;
      label5.update;

          cont:=cont+1;

          cdsdestino.append;
          cdsdestino.fieldByName('COD_EMP_GRA').value:=1;
          cdsdestino.fieldByName('COD_GRA').value:=cont;
          cdsdestino.fieldByName('inscrm_gra').value:=QOrigem.fieldByName('nrInscricaoMunicipal').AsString;
          cdsdestino.fieldByName('inscre_gra').value:=QOrigem.fieldByName('nrInscricaoEstadual').AsString;

          cdsdestino.fieldByName('COD_CNT_GRA').value:=ContribuintesNota(copy(trim(QOrigem.fieldByName('nmGrafica').AsString),1,60),
                                                                        '',//rg
                                                                        ZeraEsquerda(14,TiraCaracter(trim(QOrigem.fieldByName('nrCGCGrafica').AsString))),//cnpj
                                                                        '',//fone
                                                                        '',//fax
                                                                        '',//email
                                                                        copy(trim(QOrigem.fieldByName('nmCidade').AsString),1,60),//cidade
                                                                        trim(QOrigem.fieldByName('sgEstado').AsString),//estado
                                                                        QOrigem.fieldByName('dsEndereco').AsString,//logradouro
                                                                        '',//numero
                                                                        trim(QOrigem.fieldByName('dsComplemento').AsString),//complemento
                                                                        QOrigem.fieldByName('nmBairro').AsString,//bairro
                                                                        trim(QOrigem.fieldByName('cdCep').AsString));//cep

          cdsdestino.post;

     QOrigem.next;
    end;

          Erros:=0;
          if not Conexao.InTransaction then Conexao.StartTransaction(TD);
          if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
          if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);
          if Erros = 0 then Conexao.Commit(TD)
          else begin
             Conexao.Rollback(TD);
          end;

end;


procedure TFPrincipal.fiscais;
var cadastro:String;
    Erros,cont:Integer;
begin
    QOrigem.close;
    QOrigem.sql.clear;
    QOrigem.sql.add('SELECT * FROM AUDITORFISCAL');
    QOrigem.open;
    cont:=1;
    cdsdestino.close;
    sqlDestino.commandText:='SELECT * FROM OU_FISCAIS ';
    cdsdestino.open;

    while not QOrigem.eof do
    begin
          cont:=cont+1;
          cdsdestino.append;
          cdsdestino.fieldByName('COD_EMP_OFS').value:=1;
          cdsdestino.fieldByName('NOME_OFS').value:=QOrigem.fieldByName('nmFiscal').value;
          cdsdestino.fieldByName('COD_OFS').value:=cont;
          cdsdestino.fieldByName('REGISTROFUNC_OFS').value:=QOrigem.fieldByName('cdMatricula').value;

          if QOrigem.fieldByName('cdFuncao').AsString='1' then
          cdsdestino.fieldByName('AREA_ATU_OFS').value:='CHEFE DA DIVISAO DE FISCALIZAÇÃO'
          else
          if QOrigem.fieldByName('cdFuncao').AsString='2' then
          cdsdestino.fieldByName('AREA_ATU_OFS').value:='AUDITOR FISCAL'
          else
          if QOrigem.fieldByName('cdFuncao').AsString='3' then
          cdsdestino.fieldByName('AREA_ATU_OFS').value:='FISCAL DE TRIBUTOS'
          else
          if QOrigem.fieldByName('cdFuncao').AsString='4' then
          cdsdestino.fieldByName('AREA_ATU_OFS').value:='CHEFE DA DIVISAO DE ISS'
          else
          if QOrigem.fieldByName('cdFuncao').AsString='5' then
          cdsdestino.fieldByName('AREA_ATU_OFS').value:='CHEFE DA DIVISAO DE RECEITAS'
          else
          if QOrigem.fieldByName('cdFuncao').AsString='6' then
          cdsdestino.fieldByName('AREA_ATU_OFS').value:='CHEFE DA DIVISAO DE DIVIDA ATIVA'
          else
          if QOrigem.fieldByName('cdFuncao').AsString='7' then
          cdsdestino.fieldByName('AREA_ATU_OFS').value:='DIRETOR DTA';








          cdsdestino.post;

     QOrigem.next;
    end;

          Erros:=0;
          if not Conexao.InTransaction then Conexao.StartTransaction(TD);
          if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
          if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);
          if Erros = 0 then Conexao.Commit(TD)
          else begin
             Conexao.Rollback(TD);
          end;

end;




procedure TFPrincipal.aidf;
var cadastro:String;
    Erros,cont:Integer;
begin
    QOrigem.close;
    QOrigem.sql.clear;
    QOrigem.sql.add('SELECT * FROM AUTORIZACAOIMPRESSAO A '+
                    'INNER JOIN DOCUMENTOAUTORIZACAO B ON  A.NRAUTORIZACAO=B.NRAUTORIZACAO  '
                    );
    QOrigem.open;
    cont:=0;
    cdsdestino.close;
    sqlDestino.commandText:='SELECT * FROM LI_TALOES ';
    cdsdestino.open;

    while not QOrigem.eof do
    begin
      label5.caption:=QOrigem.fieldByName('nrAutorizacao').AsString;
      label5.update;

      QVerifica.close;
      QVerifica.sql.clear;
      QVerifica.sql.Add('SELECT * FROM LI_MOBIL WHERE COD_EMP_MBL=1 AND COD_MBL='''+ZeraEsquerda(11,QOrigem.fieldByName('nrCadastro').AsString)+'''');
      QVerifica.Open;

      IF NOT QVERIFICA.IsEmpty THEN
      BEGIN

          cont:=cont+1;
          cdsdestino.append;
          cdsdestino.fieldByName('COD_EMP_TLS').value:=1;
          cdsdestino.fieldByName('COD_MBL_TLS').value:=ZeraEsquerda(11,QOrigem.fieldByName('nrCadastro').AsString);
          cdsdestino.fieldByName('NAUTORI_TLS').value:=ZeraEsquerda(10,IntToStr(cont));
          cdsdestino.fieldByName('DATA_TLS').AsString:=QOrigem.fieldByName('dtautorizacao').AsString;
          cdsdestino.fieldByName('ESPECIE_TLS').AsString:=QOrigem.fieldByName('dtautorizacao').AsString;
          if QOrigem.fieldByName('cdSerie').AsString='1' then
          cdsdestino.fieldByName('SERIE_TLS').AsString:='ÚNICA'
          else
          if QOrigem.fieldByName('cdSerie').AsString='2' then
          cdsdestino.fieldByName('SERIE_TLS').AsString:='A'
          else
          if QOrigem.fieldByName('cdSerie').AsString='3' then
          cdsdestino.fieldByName('SERIE_TLS').AsString:='D 04'
          else
          if QOrigem.fieldByName('cdSerie').AsString='4' then
          cdsdestino.fieldByName('SERIE_TLS').AsString:='A 01'
          else
          if QOrigem.fieldByName('cdSerie').AsString='5' then
          cdsdestino.fieldByName('SERIE_TLS').AsString:='B 02'
          else
          if QOrigem.fieldByName('cdSerie').AsString='6' then
          cdsdestino.fieldByName('SERIE_TLS').AsString:='C 03'
          else
          if QOrigem.fieldByName('cdSerie').AsString='7' then
          cdsdestino.fieldByName('SERIE_TLS').AsString:='UNICA 05'
          else
          if QOrigem.fieldByName('cdSerie').AsString='8' then
          cdsdestino.fieldByName('SERIE_TLS').AsString:='FORM CONTINUO'
          else
          if QOrigem.fieldByName('cdSerie').AsString='9' then
          cdsdestino.fieldByName('SERIE_TLS').AsString:='A D 1463/03';

          cdsdestino.fieldByName('NVIAS_TLS').AsString:=QOrigem.fieldByName('qtVias').AsString;
          cdsdestino.fieldByName('NUMEROI_TLS').AsString:=QOrigem.fieldByName('nrInicial').AsString;
          cdsdestino.fieldByName('NUMEROF_TLS').AsString:=QOrigem.fieldByName('nrFinal').AsString;
          cdsdestino.fieldByName('TIPO_TLS').AsString:=QOrigem.fieldByName('nrAutorizacao').AsString;
          cdsdestino.fieldByName('NTALOES_TLS').AsString:=QOrigem.fieldByName('qtTaloes').AsString;
          cdsdestino.fieldByName('NUMERONOTAS_TLS').AsInteger:=(cdsdestino.fieldByName('NUMEROF_TLS').AsInteger-cdsdestino.fieldByName('NUMEROi_TLS').AsInteger)+1;
          cdsdestino.fieldByName('AUTORIZADO_TLS').AsString:='S';
          cdsdestino.fieldByName('DTDESPACHO_TLS').AsString:=QOrigem.fieldByName('dthomologacao').AsString;

          QVerifica.close;
          QVerifica.sql.clear;
          QVerifica.sql.add('SELECT COD_GRA FROM LI_GRAFICAS '+
          ' INNER JOIN GR_CONTRIBUINTES ON COD_EMP_CNT=COD_EMP_GRA AND COD_CNT=COD_CNT_GRA '+
          ' WHERE COD_EMP_GRA=1 AND CNPJ_CNT='''+ZeraEsquerda(14,QOrigem.fieldByName('nrCGCGrafica').AsString)+'''');
          QVerifica.open;
          if not QVerifica.IsEmpty then
          cdsdestino.fieldByName('COD_GRA_TLS').AsString:=QVerifica.fieldByName('COD_GRA').AsString
          else
          cdsdestino.fieldByName('COD_GRA_TLS').AsString:='0';

          cdsdestino.post;
      END;
     QOrigem.next;
    end;

          Erros:=0;
          if not Conexao.InTransaction then Conexao.StartTransaction(TD);
          if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
          if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);
          if Erros = 0 then Conexao.Commit(TD)
          else begin
             Conexao.Rollback(TD);
          end;

end;









procedure TFPrincipal.NotasFiscaisAvulsa;
var cont,Erros,coddiv:Integer;
cod_cntp,cod_cntt:String;
begin
   QVerifica.close;
   QVerifica.sql.clear;
   QVerifica.sql.add('DELETE FROM LI_NOTAS');
   QVerifica.EXECSQL;


  QOrigem.close;
  QOrigem.sql.clear;
  QOrigem.sql.add(' select * from ASP02_NOTAFISCAL A '+
                  ' INNER JOIN CNTI_CONTRIBUINTES B ON A.CNTI_I_CON=B.CNTI_I_CON '+
                  ' LEFT JOIN CNTI_MUNICIPIOS c on b.CNTI_I_IBGER=c.CNTI_I_IBGE '+
                  ' order by A.NF_I_SEQ '
                  );
  QOrigem.open;

  cont:=1;
  //ProgressBar1.max:=QOrigem.recordcount;

  while not QOrigem.Eof do
  begin
     cont:=cont+1;
     ProgressBar1.position:=cont;
     label5.caption:=QOrigem.fieldByName('CON_I_ISSQN').AsString;
     label5.update;

     QVerifica.close;
     QVerifica.sql.clear;
     QVerifica.sql.add('SELECT COD_MBL,COD_CNT_MBL FROM LI_MOBIL WHERE COD_EMP_MBL=1 AND COD_MBL='''+ZeraEsquerda(9,QOrigem.fieldByName('CON_I_ISSQN').AsString)+'''');
     QVerifica.open;
     if not QVerifica.IsEmpty then
     begin
         cod_cntp:=QVerifica.fieldByName('cod_cnt_mbl').AsString;

         IF trim(QOrigem.fieldByName('PAR_N_SEQ').AsString)<>'' then
         coddiv:=QOrigem.fieldByName('PAR_N_SEQ').AsInteger
         else
         coddiv:=0;

         cod_cntt:=ContribuintesNota(copy(trim(QOrigem.fieldByName('CNTI_A_NOM').AsString),1,60),
                                TiraCaracter(trim(QOrigem.fieldByName('CNTI_A_RGIE').AsString)),//rg
                                TiraCaracter(trim(QOrigem.fieldByName('CNTI_A_CPFCGC').AsString)),//cnpj
                                '',//fone
                                '',//fax
                                '',//email
                                copy(trim(QOrigem.fieldByName('CNTI_A_MUN').AsString),1,60),//cidade
                                trim(QOrigem.fieldByName('CNTI_A_UF').AsString),//estado
                                QOrigem.fieldByName('CNTI_A_LOGR').AsString,//logradouro
                                trim(QOrigem.fieldByName('CNTI_A_NUMR').AsString),//numero
                                QOrigem.fieldByName('CNTI_A_COMR').AsString,//complemento
                                QOrigem.fieldByName('CNTI_A_BAIR').AsString,//bairro
                                trim(QOrigem.fieldByName('CNTI_A_CEPR').AsString));//cep


         try
         QDestino.close;
         QDestino.sql.Clear;
         QDestino.sql.add('INSERT INTO LI_NOTAS (COD_EMP_NTS,LANCA_NTS,COD_CNTP_NTS,COD_CNTT_NTS, '+
                           'LINRNOTA_NTS,DTNOTA_NTS,DTLANCA_NTS,SERIE_NTS,CONDPAGTO_NTS,NATOPER_NTS, '+
                           'INSCRIM_NTS,PARCELA_NTS,COD_DIV_NTS,IMPOSTO_NTS,TOTAL_NOTA_NTS,NFCANCELADA_NTS, '+
                           'INCIDE_PIS_NTS,INCIDE_COFINS_NTS,INCIDE_CSLL_NTS,INCIDE_INSS_NTS,INCIDE_IRRF_NTS,'+
                           'VALORINSS_NTS,VALORIRRF_NTS,'+
                           'LOGIN_INC_NTS,DTA_INC_NTS) '+
                           ' VALUES ('+
                           '1,'+
                           ''''+QOrigem.fieldByName('NF_I_SEQ').AsString+''','+
                           ''''+cod_cntp+''','+
                           ''''+cod_cntt+''','+
                           ''''+QOrigem.fieldByName('NF_A_NUM').AsString+''','+
                           ''''+InverteData(QOrigem.fieldByName('NF_D_EMI').AsString)+''','+
                           ''''+InverteData(QOrigem.fieldByName('NF_D_EMI').AsString)+''','+
                           '''AVULSA'','+
                           '''A VISTA'','+
                           '''PRESTAÇÃO DE SERVIÇO'','+
                           ''''+ZeraEsquerda(9,QOrigem.fieldByName('CON_I_ISSQN').AsString)+''','+
                           '1,'+
                           ''''+IntToStr(coddiv)+''','+
                           Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('NF_N_VALISSQN').AsCurrency))+','+
                           Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('NF_N_TOT').AsCurrency))+','+
                           '''N'','+
                           '''N'','+
                           '''N'','+
                           '''N'','+
                           ''''+QOrigem.fieldByName('NF_A_CALINSS').AsString+''','+
                           ''''+QOrigem.fieldByName('NF_A_CALIRRF').AsString+''','+
                           Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('NF_N_DEDINSS').AsCurrency))+','+
                           Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('NF_N_DEDIRRF').AsCurrency))+','+
                           '''CONVERSAO'','+
                           ''''+formatDateTime('mm/dd/YYYY',DATE)+''''+
                           ')');
         QDestino.execsql;
         except
         end;

     end;



   QOrigem.Next
  end;



end;


procedure TFPrincipal.NotasFiscaisAvulsaItens;
var cont,Erros:Integer;
cod_cntp,cod_cntt,codiv,aliquota,descricaoNota:String;
rtexto: TRichEdit;

begin

  QVerifica.close;
  QVerifica.sql.clear;
  QVerifica.sql.add('DELETE FROM LI_NOTAS_ITENS');
  QVerifica.EXECSQL;

  QOrigem.close;
  QOrigem.sql.clear;
  QOrigem.sql.add('select * from ASP02_ITENSNF order by NF_I_SEQ ');
  QOrigem.open;

  cont:=1;
  ProgressBar1.max:=QOrigem.recordcount;

  rtexto:=TRichEdit.create(self);

  while not QOrigem.Eof do
  begin


     descricaoNota:=DBRichEdit1.TEXT;
     cont:=cont+1;
     ProgressBar1.position:=cont;
     label5.caption:=QOrigem.fieldByName('NF_I_SEQ').AsString;
     label5.update;

     QEventos.close;
     QEventos.sql.clear;
     QEventos.sql.add('SELECT * FROM ASP02_NOTAFISCAL WHERE NF_I_SEQ='+QOrigem.fieldByName('NF_I_SEQ').AsString);
     QEventos.open;
     if not QEventos.IsEmpty then
     begin
         IF TRIM(QEventos.fieldByName('NF_N_ALIQISSQN').AsString)<>'' THEN
          aliquota:=QEventos.fieldByName('NF_N_ALIQISSQN').AsString
         ELSE
          aliquota:='3';

         try
         QDestino.close;
         QDestino.sql.Clear;
         QDestino.sql.add('INSERT INTO LI_NOTAS_ITENS (COD_EMP_LNI,COD_LNI,LANCA_LNI,ITEM_LNI, '+
                           'DESCRI_LNI,VALOR_LNI,ALIQUOTA_LNI,MEDIDA_LNI,VLR_UNITARIO_LNI,QUANTIDADE_LNI '+
                           ') '+
                           ' VALUES ('+
                           '1,'+
                           IntToStr(cont)+','+
                           ''''+QOrigem.fieldByName('NF_I_SEQ').AsString+''','+
                           ''''+ZeraEsquerda(4,QOrigem.fieldByName('ITEM_I_NUM').AsString)+''','+
                           ''''+RetiraChar(copy(trim(descricaoNota),1,512),'''')+''','+
                           Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('ITEM_N_TOTAL').AsCurrency))+','+
                           Subs_Virgula_por_Ponto(aliquota)+','+
                           ''''+QOrigem.fieldByName('ITEM_A_UNI').AsString+''','+
                           Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('ITEM_N_VUNI').AsCurrency))+','+
                           Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('ITEM_N_QTDE').AsCurrency))+
                           ')'
                           );
         QDestino.execsql;
         except
         end;

     end;


   QOrigem.Next
  end;

   rtexto:=nil;

end;




procedure TFPrincipal.Leituras;
var cont,Erros:Integer;
agente,ocorrencia:String;
begin
   QVerifica.close;
   QVerifica.sql.clear;
   QVerifica.sql.add('DELETE FROM AG_LEITURAS');
   QVerifica.EXECSQL;


  QOrigem.close;
  QOrigem.sql.clear;
  QOrigem.sql.add('select * from consumo order by nrCadastro ');
  QOrigem.open;

  cont:=1;
  ProgressBar1.max:=QOrigem.recordcount;

  while not QOrigem.Eof do
  begin
     cont:=cont+1;
     ProgressBar1.position:=cont;
     label5.caption:=QOrigem.fieldByName('nrCadastro').AsString;
     label5.update;

     QVerifica.close;
     QVerifica.sql.clear;
     QVerifica.sql.add('SELECT * FROM AG_AGUA '+
//     ' INNER JOIN GR_CONTRIBUINTES ON COD_EMP_CNT=COD_EMP_CAG AND COD_CNT=COD_CNT_CAG '+
     ' WHERE COD_EMP_CAG=1 AND INSTALACAO_CAG='''+ZeraEsquerda(6,QOrigem.fieldByName('nrCadastro').AsString)+'''');
     QVerifica.open;
     if not QVerifica.IsEmpty then
     begin

     agente:='0';
     if trim(QOrigem.fieldByName('nrMatriculaLeiturista').AsString)<>'' then
     begin
         QAuxiliar.close;
         QAuxiliar.sql.clear;
         QAuxiliar.sql.add('SELECT * FROM AG_AGENTESCAMPO WHERE COD_AGC='''+QOrigem.fieldByName('nrMatriculaLeiturista').AsString+'''');
         QAuxiliar.open;
         if not QAuxiliar.IsEmpty then
         agente:=QOrigem.fieldByName('nrMatriculaLeiturista').AsString;
     end;

     ocorrencia:='0000';
     if trim(QOrigem.fieldByName('cdOcorrencia').AsString)<>'' then
     begin
         QAuxiliar.close;
         QAuxiliar.sql.clear;
         QAuxiliar.sql.add('SELECT * FROM AG_ROCORR WHERE COD_AOC='''+ZeraEsquerda(4,QOrigem.fieldByName('cdOcorrencia').AsString)+'''');
         QAuxiliar.open;
         if not QAuxiliar.IsEmpty then
         ocorrencia:=ZeraEsquerda(4,QOrigem.fieldByName('cdOcorrencia').AsString);
     end;

     try
     QDestino.close;
     QDestino.sql.Clear;
     QDestino.sql.add('INSERT INTO AG_LEITURAS (COD_EMP_ALT,INSTALACAO_ALT,EXERCICIO_ALT,REFER_ALT, '+
                       'DATAREFER_ALT,SEQALTERN_ALT,COD_AGENTE_ALT,VAL_COCLEIT_ALT, '+
                       'COD_SETOR_ALT,COD_ROTA_ALT,SEQLEIT_ALT,COD_COB_ALT,COD_PRL_ALT, '+
                       'COD_TFT_ALT,VAL_LEIT_ALT,DTH_LEIT_ALT,VAL_CONSFAT_ALT,TOTDIAS_ALT, '+
                       'ECONOMIAS_ALT,COD_STR_ALT,VAL_CONSATU_ALT) '+
                       ' VALUES ('+
                       '1,'+
                       ''''+ZeraEsquerda(6,QOrigem.fieldByName('nrCadastro').AsString)+''','+
                       ''''+QOrigem.fieldByName('dtanoConsumo').AsString+''','+
                       ''''+QOrigem.fieldByName('dtMesConsumo').AsString+''','+
                       '''01.'+ZeraEsquerda(2,QOrigem.fieldByName('dtMesConsumo').AsString)+'.'+QOrigem.fieldByName('dtanoConsumo').AsString+''','+
                       ''''+QVerifica.fieldByName('SEQALTERN_CAG').AsString+''','+
                       ''''+agente+''','+
                       ''''+ocorrencia+''','+
                       ''''+QVerifica.fieldByName('COD_SETOR_CAG').AsString+''','+
                       ''''+QVerifica.fieldByName('COD_ROTA_CAG').AsString+''','+
                       ''''+QVerifica.fieldByName('SEQL_CAG').AsString+''','+
                       ''''+QVerifica.fieldByName('COD_COB_CAG').AsString+''','+
                       ''''+QVerifica.fieldByName('COD_PRL_CAG').AsString+''','+
                       ''''+QVerifica.fieldByName('COD_TFT_CAG').AsString+''','+
                     //  ''''+QVerifica.fieldByName('NOME_CNT').AsString+''','+
                       ''''+QOrigem.fieldByName('vlLeitura').AsString+''','+
                       ''''+InverteData(QOrigem.fieldByName('dtLeitura').AsString)+''','+
                       ''''+QOrigem.fieldByName('vlConsumo').AsString+''','+
                       '''30'','+
                       ''''+QVerifica.fieldByName('ECONOMIAS_CAG').AsString+''','+
                       ''''+QVerifica.fieldByName('COD_STR_CAG').AsString+''','+
                       ''''+QOrigem.fieldByName('vlConsumo').AsString+''''+
                      ')');
     QDestino.execsql;
     except
     end;

   end;



   QOrigem.Next
  end;



end;


procedure TFPrincipal.LeiturasCadastro;
var cont,Erros,i:Integer;
agente,ocorrencia:String;
begin


  QOrigem.close;
  QOrigem.sql.clear;
  QOrigem.sql.add('select * from variavel3 order by nrCadastro ');
  QOrigem.open;

  cont:=1;
  ProgressBar1.max:=QOrigem.recordcount;

  while not QOrigem.Eof do
  begin
     cont:=cont+1;
     ProgressBar1.position:=cont;
     label5.caption:=QOrigem.fieldByName('nrCadastro').AsString;
     label5.update;



     ///////////////////////////janeiro////////////////////////////////
     QDestino.close;
     QDestino.sql.clear;
     QDestino.sql.add('UPDATE AG_LEITURAS SET '+
                      ' VAL_LEIT_ALT='+QOrigem.fieldByName('campo61').AsString+','+
                      ' DTH_LEIT_ALT='''+InverteData(QOrigem.fieldByName('campo63').AsString)+''','+
                      ' VAL_CONSFAT_ALT='+QOrigem.fieldByName('campo60').AsString+','+
                      ' VAL_CONSATU_ALT='+QOrigem.fieldByName('campo60').AsString+
                      ' WHERE COD_EMP_ALT=1 AND INSTALACAO_ALT='''+ZeraEsquerda(8,QOrigem.fieldByName('nrCadastro').AsString)+''' AND EXERCICIO_ALT=2008 AND REFER_ALT=1'
                      );
     QDestino.execsql;

     QDestino.close;
     QDestino.sql.clear;
     QDestino.sql.add('UPDATE AG_LEITURAS SET '+
                      ' VAL_LANT_ALT='+QOrigem.fieldByName('campo61').AsString+
                      ' WHERE COD_EMP_ALT=1 AND INSTALACAO_ALT='''+ZeraEsquerda(8,QOrigem.fieldByName('nrCadastro').AsString)+''' AND EXERCICIO_ALT=2008 AND REFER_ALT=2'
                      );
     QDestino.execsql;


     ///////////////////////////Fevereiro////////////////////////////////
     QDestino.close;
     QDestino.sql.clear;
     QDestino.sql.add('UPDATE AG_LEITURAS SET '+
                      ' VAL_LEIT_ALT='+QOrigem.fieldByName('campo65').AsString+','+
                      ' DTH_LEIT_ALT='''+InverteData(QOrigem.fieldByName('campo67').AsString)+''','+
                      ' VAL_CONSFAT_ALT='+QOrigem.fieldByName('campo64').AsString+','+
                      ' VAL_CONSATU_ALT='+QOrigem.fieldByName('campo64').AsString+
                      ' WHERE COD_EMP_ALT=1 AND INSTALACAO_ALT='''+ZeraEsquerda(8,QOrigem.fieldByName('nrCadastro').AsString)+''' AND EXERCICIO_ALT=2008 AND REFER_ALT=2'
                      );
     QDestino.execsql;

     QDestino.close;
     QDestino.sql.clear;
     QDestino.sql.add('UPDATE AG_LEITURAS SET '+
                      ' VAL_LANT_ALT='+QOrigem.fieldByName('campo65').AsString+
                      ' WHERE COD_EMP_ALT=1 AND INSTALACAO_ALT='''+ZeraEsquerda(8,QOrigem.fieldByName('nrCadastro').AsString)+''' AND EXERCICIO_ALT=2008 AND REFER_ALT=3'
                      );
     QDestino.execsql;


     ///////////////////////////Março////////////////////////////////
     QDestino.close;
     QDestino.sql.clear;
     QDestino.sql.add('UPDATE AG_LEITURAS SET '+
                      ' VAL_LEIT_ALT='+QOrigem.fieldByName('campo69').AsString+','+
                      ' DTH_LEIT_ALT='''+InverteData(QOrigem.fieldByName('campo71').AsString)+''','+
                      ' VAL_CONSFAT_ALT='+QOrigem.fieldByName('campo68').AsString+','+
                      ' VAL_CONSATU_ALT='+QOrigem.fieldByName('campo68').AsString+
                      ' WHERE COD_EMP_ALT=1 AND INSTALACAO_ALT='''+ZeraEsquerda(8,QOrigem.fieldByName('nrCadastro').AsString)+''' AND EXERCICIO_ALT=2008 AND REFER_ALT=3'
                      );
     QDestino.execsql;

     QDestino.close;
     QDestino.sql.clear;
     QDestino.sql.add('UPDATE AG_LEITURAS SET '+
                      ' VAL_LANT_ALT='+QOrigem.fieldByName('campo69').AsString+
                      ' WHERE COD_EMP_ALT=1 AND INSTALACAO_ALT='''+ZeraEsquerda(8,QOrigem.fieldByName('nrCadastro').AsString)+''' AND EXERCICIO_ALT=2008 AND REFER_ALT=4'
                      );
     QDestino.execsql;

     ///////////////////////////Abril////////////////////////////////
     QDestino.close;
     QDestino.sql.clear;
     QDestino.sql.add('UPDATE AG_LEITURAS SET '+
                      ' VAL_LEIT_ALT='+QOrigem.fieldByName('campo73').AsString+','+
                      ' DTH_LEIT_ALT='''+InverteData(QOrigem.fieldByName('campo75').AsString)+''','+
                      ' VAL_CONSFAT_ALT='+QOrigem.fieldByName('campo72').AsString+','+
                      ' VAL_CONSATU_ALT='+QOrigem.fieldByName('campo72').AsString+
                      ' WHERE COD_EMP_ALT=1 AND INSTALACAO_ALT='''+ZeraEsquerda(8,QOrigem.fieldByName('nrCadastro').AsString)+''' AND EXERCICIO_ALT=2008 AND REFER_ALT=4'
                      );
     QDestino.execsql;

     QDestino.close;
     QDestino.sql.clear;
     QDestino.sql.add('UPDATE AG_LEITURAS SET '+
                      ' VAL_LANT_ALT='+QOrigem.fieldByName('campo73').AsString+
                      ' WHERE COD_EMP_ALT=1 AND INSTALACAO_ALT='''+ZeraEsquerda(8,QOrigem.fieldByName('nrCadastro').AsString)+''' AND EXERCICIO_ALT=2008 AND REFER_ALT=5'
                      );
     QDestino.execsql;



   QOrigem.Next
  end;



end;



procedure TFPrincipal.AcertaMobiliario;
var cont,Erros:Integer;
bairro,logradouro,cidade,uf:String;
begin

  QOrigem.close;
  QOrigem.sql.clear;
  QOrigem.sql.add('select * from cadastro where cdTipoCadastro=2 ');
  QOrigem.open;



  cont:=1;
  while not QOrigem.Eof do
  begin

  label1.caption:=intToStr(cont);
  label1.Update;

   if cont>43600 then
   begin
        TRY
            cdsdestino.close;
            sqlDestino.commandText:='SELECT * FROM LI_MOBIL WHERE COD_EMP_MBL=1 AND COD_MBL='''+ZeraEsquerda(11,QOrigem.fieldByName('nrCadastro').AsString)+''' AND COD_CNT_MBL IS NULL ';
            cdsdestino.open;
            if NOT cdsDestino.IsEmpty then
            BEGIN

                cdsDestino.edit;

                QVerifica.close;
                QVerifica.sql.clear;
                QVerifica.sql.add('SELECT * FROM GR_LOGRA WHERE COD_EMP_LOG=1 AND COD_LOG='+QOrigem.fieldByName('cdLogradouro').AsString);
                QVerifica.open;
                if not QVerifica.IsEmpty then
                cdsDestino.fieldByName('COD_LOG_MBL').AsString:=QOrigem.fieldByName('cdLogradouro').AsString
                else
                cdsDestino.fieldByName('COD_LOG_MBL').AsString:='0';

                QVerifica.close;
                QVerifica.sql.clear;
                QVerifica.sql.add('SELECT * FROM GR_LOGRA WHERE COD_EMP_LOG=1 AND COD_LOG='+cdsDestino.fieldByName('COD_LOG_MBL').AsString);
                QVerifica.open;
                logradouro:=QVerifica.fieldByName('nome_log').AsString;


                QVerifica.close;
                QVerifica.sql.clear;
                QVerifica.sql.add('SELECT * FROM GR_BAIRRO WHERE COD_EMP_BAI=1 AND COD_BAI='+QOrigem.fieldByName('cdBairro').AsString);
                QVerifica.open;
                if not QVerifica.IsEmpty then
                cdsDestino.fieldByName('COD_BAI_MBL').AsString:=QOrigem.fieldByName('cdBairro').AsString
                else
                cdsDestino.fieldByName('COD_BAI_MBL').AsString:='0';

                QVerifica.close;
                QVerifica.sql.clear;
                QVerifica.sql.add('SELECT * FROM GR_BAIRRO WHERE COD_EMP_BAI=1 AND COD_BAI='+cdsDestino.fieldByName('COD_BAI_MBL').AsString);
                QVerifica.open;
                bairro:=QVerifica.fieldByName('nome_bai').AsString;


                QEventos.close;
                QEventos.sql.clear;
                QEventos.sql.add('SELECT * FROM VARIAVEL2 WHERE CDTIPOCADASTRO=2 AND NRCADASTRO='''+QOrigem.fieldByName('nrCadastro').AsString+'''');
                QEventos.open;

                cdsDestino.fieldByName('REGIAO_MBL').value:=QEventos.fieldByName('campo12').value;
                cdsDestino.fieldByName('DTENCE_MBL').value:=QEventos.fieldByName('campo68').value;

                if trim(cdsDestino.fieldByName('DTENCE_MBL').AsString)<>'' then
                cdsDestino.fieldByName('SITUACAO_MBL').AsString:='03 - Baixado';

                if (TRIM(QEventos.fieldByName('campo14').AsString)<>'0') AND (TRIM(QEventos.fieldByName('campo14').AsString)<>'') THEN
                BEGIN
                 cdsdestino.fieldByName('LOGRA_MBL').AsString:=QEventos.fieldByName('campo14').AsString;
                END
                else
                begin

                    cdsdestino.fieldByName('NUMEROE_MBL').AsString:=cdsdestino.fieldByName('NUMERO_MBL').AsString;
                    cdsdestino.fieldByName('COMPLE_MBL').AsString:=cdsdestino.fieldByName('COMPLEE_MBL').AsString;
                    cdsdestino.fieldByName('CEPE_MBL').AsString:=cdsdestino.fieldByName('CEPi_MBL').AsString;

                    QVerifica.close;
                    QVerifica.sql.clear;
                    QVerifica.sql.add('select * from GR_LOGRA where COD_EMP_LOG=1 AND COD_LOG='''+cdsDestino.fieldByName('COD_LOG_MBL').AsString+'''');
                    QVerifica.open;
                    if not QVerifica.IsEmpty then
                    begin
                     cdsdestino.fieldByName('COD_LOGE_MBL').AsString:=QVerifica.fieldByName('cod_log').AsString;
                     cdsdestino.fieldByName('LOGRA_MBL').AsString:=QVerifica.fieldByName('NOME_LOG').AsString;
                    end;

                    QVerifica.close;
                    QVerifica.sql.clear;
                    QVerifica.sql.add('select * from GR_BAIRRO where COD_EMP_BAI=1 AND COD_BAI='''+cdsDestino.fieldByName('COD_BAI_MBL').AsString+'''');
                    QVerifica.open;
                    if not QVerifica.IsEmpty then
                    begin
                     cdsdestino.fieldByName('COD_BAIE_MBL').AsString:=QVerifica.fieldByName('cod_bai').AsString;
                     cdsdestino.fieldByName('BAIRRO_MBL').AsString:=QVerifica.fieldByName('NOME_BAI').AsString;
                    end;



                end;


             cdsDestino.fieldByName('cod_cnt_mbl').AsString:=Contribuintes(QOrigem.fieldByName('nmProprietRazao').AsString,
                                                              '',//rg
                                                            TiraCaracter(QOrigem.fieldByName('nrCGCCPF').AsString),
                                                            '',//fone
                                                            '',//fax
                                                            '',//email
                                                            cdsDestino.fieldByName('cidad').AsString,
                                                            '',
                                                            logradouro,
                                                            QOrigem.fieldByName('nrImovel').AsString,
                                                            QOrigem.fieldByName('dsComplnome').AsString,
                                                            bairro,
                                                            cdsDestino.fieldByName('CEPi_MBL').AsString);


                Erros:=0;

                if not Conexao.InTransaction then Conexao.StartTransaction(TD);

                if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
                if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

                if Erros = 0 then Conexao.Commit(TD)
                else begin
                  Conexao.Rollback(TD);
                end;
            END;

        EXCEPT
        END;
   end;

   cont:=cont+1;


   QOrigem.Next
  end;



end;


procedure TFPrincipal.acertaLogradouro;
var cont,Erros:Integer;
begin

  QOrigem.close;
  QOrigem.sql.clear;
  QOrigem.sql.add('select * from posicaologradouro');
  QOrigem.open;



  cont:=1;
  while not QOrigem.Eof do
  begin
        TRY
            cdsdestino.close;
            sqlDestino.commandText:='SELECT * FROM GR_LOGRA WHERE COD_EMP_LOG=1 AND COD_LOG='+QOrigem.fieldByName('cdLogradouro').AsString;
            cdsdestino.open;
            if NOT cdsDestino.IsEmpty then
            BEGIN

                cdsDestino.edit;

                cdsDestino.fieldByName('COD_TPL_LOG').AsString:=QOrigem.fieldByName('cdTipoLograd').value;
                cdsDestino.fieldByName('CEP_LOG').value:=QOrigem.fieldByName('cdcep').value;
//                cdsDestino.fieldByName('COD_BAIR_LOG').value:=QOrigem.fieldByName('cdBairro').value;

                cont:=cont+1;

                Erros:=0;

                if not Conexao.InTransaction then Conexao.StartTransaction(TD);

                if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
                if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

                if Erros = 0 then Conexao.Commit(TD)
                else begin
                  Conexao.Rollback(TD);
                end;
            END;

        EXCEPT
        END;
   QOrigem.Next
  end;



end;



procedure TFPrincipal.tipologia;
var cont,Erros:Integer;
begin

  QOrigem.close;
  QOrigem.sql.clear;
  QOrigem.sql.add('select * from tipologradouro');
  QOrigem.open;



  cont:=1;
  while not QOrigem.Eof do
  begin

            cdsdestino.close;
            sqlDestino.commandText:='SELECT * FROM CEP_TIPOLOGIA WHERE COD_TIP_CEP='+QOrigem.fieldByName('cdTpLogradouro').AsString;
            cdsdestino.open;
            if cdsDestino.IsEmpty then
            cdsDestino.append
            else
            cdsDestino.edit;

                cdsDestino.fieldByName('COD_TIP_CEP').AsString:=QOrigem.fieldByName('cdTpLogradouro').value;
                cdsDestino.fieldByName('NOM_TIP_CEP').value:=QOrigem.fieldByName('nmTpLogradouro').value;
                cdsDestino.fieldByName('ABRE_TIP_CEP').value:=QOrigem.fieldByName('naTpLogradouro').value;

                cont:=cont+1;

                Erros:=0;

                if not Conexao.InTransaction then Conexao.StartTransaction(TD);

                if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
                if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

                if Erros = 0 then Conexao.Commit(TD)
                else begin
                  Conexao.Rollback(TD);
                  exit;
                end;

   QOrigem.Next
  end;



end;



procedure TFPrincipal.GeraSecao;
var cont,Erros:Integer;
begin

  QOrigem.close;
  QOrigem.sql.clear;
  QOrigem.sql.add(' select * from ValorPlanta where cdtipocadastro=1 and nrChavePlanta=4 and cdsecao<>''''');
  QOrigem.open;


  cdsdestino.close;
  sqlDestino.commandText:='SELECT * FROM IP_SECAO WHERE COD_EMP_sco IS NULL ';
  cdsdestino.open;

  cont:=1;
  while not QOrigem.Eof do
  begin

          QAuxiliar.close;
          QAuxiliar.sql.clear;
          QAuxiliar.sql.add('SELECT * FROM GR_LOGRA WHERE COD_EMP_LOG=1 AND COD_LOG='+trim(copy(QOrigem.fieldByName('cdSecao').AsString,9,6)));
          QAuxiliar.open;
          IF  not QAuxiliar.IsEmpty then
          begin
                cdsDestino.append;
                cdsDestino.fieldByName('COD_EMP_SCO').AsString:='1';
                cdsDestino.fieldByName('COD_SCO').AsInteger:=cont;
                cdsDestino.fieldByName('CODD_SCO').value:=QOrigem.fieldByName('cdSecao').value;
                cdsDestino.fieldByName('VALOR_SCO').AsString:=QOrigem.fieldByName('vlMetroQuadrado').AsString;
                cdsDestino.fieldByName('SETOR_SCO').value:=ZeraEsquerda(5,copy(QOrigem.fieldByName('cdSecao').AsString,3,3));
                cdsDestino.fieldByName('ANO_STR_SCO').value:=QOrigem.fieldByName('dtanoValorPlanta').value;
                cdsDestino.fieldByName('QUADRA_SCO').value:=ZeraEsquerda(5,copy(QOrigem.fieldByName('cdSecao').AsString,6,3));
                cdsDestino.fieldByName('COD_LOG_SCO').value:=copy(QOrigem.fieldByName('cdSecao').AsString,10,6);
                cdsDestino.fieldByName('COD_ZNA_SCO').value:=ZeraEsquerda(5,copy(QOrigem.fieldByName('cdSecao').AsString,1,2));
                cdsDestino.fieldByName('TP_ZNA_SCO').value:='02 - Zoneamento';

                cont:=cont+1;

                Erros:=0;

                if not Conexao.InTransaction then Conexao.StartTransaction(TD);

                if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
                if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

                if Erros = 0 then Conexao.Commit(TD)
                else begin
                  Conexao.Rollback(TD);
                  exit;
                end;
          end;
   QOrigem.Next
  end;



end;

procedure TFPrincipal.renumeraContribuintes;
var cont:Integer;
begin

 QAuxiliar.close;
 QAuxiliar.sql.clear;
 QAuxiliar.sql.add('select * from gr_contribuintes');
 QAuxiliar.open;

 cont:=1;
 while not QAuxiliar.eof do
 begin
  TRY
  QVerifica.close;
  QVerifica.sql.clear;
  QVerifica.sql.add('UPDATE GR_CONTRIBUINTES SET COD_CNT='''+ZeraEsquerda(6,IntToStr(cont))+''' where cod_emp_cnt=1 and cod_cnt='''+QAuxiliar.fieldByName('cod_cnt').AsString+''' ');
  QVerifica.execsql;
  EXCEPT
  ShowMessage(QAuxiliar.fieldByName('cod_cnt').AsString);
  END;
  cont:=cont+1;

  QAuxiliar.next;
 end;

end;



procedure TFPrincipal.renumeraMobiliario;
var cont:Integer;
begin

 QAuxiliar.close;
 QAuxiliar.sql.clear;
 QAuxiliar.sql.add('select * from li_mobil');
 QAuxiliar.open;

 cont:=1;
 while not QAuxiliar.eof do
 begin
  TRY
  QVerifica.close;
  QVerifica.sql.clear;
  QVerifica.sql.add('UPDATE LI_MOBIL SET COD_MBL='''+ZeraEsquerda(6,IntToStr(cont))+''' where cod_emp_MBL=1 and cod_MBL='''+QAuxiliar.fieldByName('cod_MBL').AsString+''' ');
  QVerifica.execsql;

  QVerifica.close;
  QVerifica.sql.clear;
  QVerifica.sql.add('UPDATE FI_DIVIDA SET COD_CAD_DIV='''+ZeraEsquerda(6,IntToStr(cont))+''' where cod_emp_DIV=1 AND COD_MOD_DIV=2 and cod_CAD_DIV='''+QAuxiliar.fieldByName('cod_MBL').AsString+''' ');
  QVerifica.execsql;

  QVerifica.close;
  QVerifica.sql.clear;
  QVerifica.sql.add('UPDATE FI_LANCAMENTO SET COD_CAD_LAN='''+ZeraEsquerda(6,IntToStr(cont))+''' where cod_emp_LAN=1 AND COD_MOD_LAN=2 and cod_CAD_LAN='''+QAuxiliar.fieldByName('cod_MBL').AsString+''' ');
  QVerifica.execsql;



  EXCEPT
  ShowMessage(QAuxiliar.fieldByName('cod_MBL').AsString);
  END;
  cont:=cont+1;

  QAuxiliar.next;
 end;

end;



procedure TFPrincipal.BuscaContribuinteDiversos;
var
codcontrib,cpf,tipocadastro:String;
begin

    QDestino.close;
    QDestino.sql.clear;
    QDestino.sql.add('SELECT * FROM FI_DIVIDA WHERE COD_EMP_DIV=1 AND COD_MOD_DIV<>1 AND COD_MOD_DIV<>2 ');
    QDestino.open;

    while not QDestino.eof do
    begin
            tipocadastro:=QDestino.fieldByName('cod_mod_div').AsString;

            QOrigem.close;
            QOrigem.sql.clear;
            QOrigem.sql.add('select * from cadastro where cdTipoCadastro='+tipocadastro+' and nrCadastro='''+QDestino.fieldByName('cod_cad_div').AsString+'''');
            Qorigem.open;
            if not QOrigem.IsEmpty then
            begin

             if length(QOrigem.fieldByName('nrcgccpf').AsString)<=11 then
             cpf:=ZeraEsquerda(11,QOrigem.fieldByName('nrcgccpf').AsString)
             else
             cpf:=ZeraEsquerda(14,QOrigem.fieldByName('nrcgccpf').AsString);

             QEventos.close;
             QEventos.sql.clear;
             QEventos.sql.add('select * from endercorr where cdTipoCadastro='+tipocadastro+' and nrCadastro='''+QDestino.fieldByName('cod_cad_div').AsString+'''');
             QEventos.open;

             codcontrib:=Contribuintes(Qorigem.fieldByName('nmProprietRazao').AsString,
                                        '',//rg
                                      cpf,
                                      '',//fone
                                      '',//fax
                                      '',//email
                                      QEventos.fieldByName('nmCidade').AsString,
                                      QEventos.fieldByName('sgEstado').AsString,
                                      QEventos.fieldByName('dsEndereco').AsString,
                                      QEventos.fieldByName('nrImovel').AsString,
                                      QEventos.fieldByName('dsComplemento').AsString,
                                      QEventos.fieldByName('nmBairro').AsString,
                                      QEventos.fieldByName('cdcep').AsString);

            QVerifica.close;
            QVerifica.sql.clear;
            QVerifica.sql.add('UPDATE FI_DIVIDA SET COD_CNT_DIV='''+codcontrib+''' '+
            ' WHERE COD_EMP_DIV=1 AND COD_DIV='+QDestino.fieldByName('cod_div').AsString);
            QVerifica.execsql;

            end;


     QDestino.next;
    end;
end;



procedure TFPrincipal.Contabilizacao;
var erros:Integer;
begin

   QOrigem.close;
   QOrigem.sql.clear;
   QOrigem.sql.add(' select * from planodivTributo a '+
                    ' inner join PlanoContas b on a.dtexercicio=b.dtexercicio and a.cdReceita=b.cdReceita '+
                    ' where a.dtexercicio=''2008'' and b.inAceitaLancamento=''S'' '
                    );
   QOrigem.open;

  while not QOrigem.eof do
  begin
   cdsDestino.close;
   sqlDestino.commandText:='SELECT * FROM GR_RECEITA where cod_emp_rec=1 and cod_rec='+QOrigem.fieldByName('cdTipoCadastro').AsString+QOrigem.fieldByName('cdtributo').AsString;
   cdsDestino.open;
   if not cdsDestino.IsEmpty then
   begin
   erros:=0;
   cdsDestino.edit;
       if QOrigem.fieldByName('inSituacaoDebito').AsString='C' then
       begin
        if QOrigem.fieldByName('inOrigemValor').AsString='P' then
        cdsDestino.fieldByName('anoreceita_rec').AsString:=QOrigem.fieldByName('cdRecReduzida').AsString;
        if QOrigem.fieldByName('inOrigemValor').AsString='C' then
        cdsDestino.fieldByName('anocorre_rec').AsString:=QOrigem.fieldByName('cdRecReduzida').AsString;
        if QOrigem.fieldByName('inOrigemValor').AsString='M' then
        cdsDestino.fieldByName('anomulta_rec').AsString:=QOrigem.fieldByName('cdRecReduzida').AsString;
        if QOrigem.fieldByName('inOrigemValor').AsString='J' then
        cdsDestino.fieldByName('anojuros_rec').AsString:=QOrigem.fieldByName('cdRecReduzida').AsString;
       end
       else
       if QOrigem.fieldByName('inSituacaoDebito').AsString='A' then
       begin
        if QOrigem.fieldByName('inOrigemValor').AsString='P' then
        cdsDestino.fieldByName('dividarec_rec').AsString:=QOrigem.fieldByName('cdRecReduzida').AsString;
        if QOrigem.fieldByName('inOrigemValor').AsString='C' then
        cdsDestino.fieldByName('dividacorre_rec').AsString:=QOrigem.fieldByName('cdRecReduzida').AsString;
        if QOrigem.fieldByName('inOrigemValor').AsString='M' then
        cdsDestino.fieldByName('dividamulta_rec').AsString:=QOrigem.fieldByName('cdRecReduzida').AsString;
        if QOrigem.fieldByName('inOrigemValor').AsString='J' then
        cdsDestino.fieldByName('dividajuros_rec').AsString:=QOrigem.fieldByName('cdRecReduzida').AsString;
       end;

    Erros:=0;
    if not Conexao.InTransaction then Conexao.StartTransaction(TD);

    if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
    if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

    if Erros = 0 then Conexao.Commit(TD)
    else begin
      Conexao.Rollback(TD);
      exit;
    end;


   end;


   QOrigem.next
  end;


end;

procedure TFPrincipal.Fichasreceitas;
 var cont,modulo,erros:Integer;
begin

 QOrigem.close;
 QOrigem.sql.clear;
 QOrigem.sql.add('select * from planocontas where  dtexercicio=''2008'' and inAceitaLancamento=''S'' ');
 QOrigem.open;

 cont:=1;
  while not QOrigem.eof do
  begin

    cdsdestino.close;
    sqlDestino.commandText:='select * from GR_FICHAS_RECEITA where FICHA_FRC='+QOrigem.fieldByName('cdrecReduzida').AsString;
    cdsdestino.open;

    if cdsdestino.IsEmpty then
    cdsdestino.append
    else
    cdsdestino.edit;

    cdsdestino.FieldByName('cod_emp_frc').AsInteger:=1;
    cdsdestino.FieldByName('ficha_frc').AsString:=QOrigem.fieldByName('cdrecReduzida').AsString;
    cdsdestino.FieldByName('nomre_frc').AsString:=QOrigem.FieldByName('dsreceita').AsString;
    cdsdestino.FieldByName('codre_frc').AsString:=QOrigem.FieldByName('cdReceita').AsString;


    Erros:=0;
    if not Conexao.InTransaction then Conexao.StartTransaction(TD);

    if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
    if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

    if Erros = 0 then Conexao.Commit(TD)
    else begin
      Conexao.Rollback(TD);
      exit;
    end;

   cont:=cont+1;
   QOrigem.next;
  end;







end;



function TFPrincipal.OrigemDivida(modulo:Integer;divida:Integer):String;
begin

     if modulo=1 then
     begin
       IF divida in [24] then
       result:='S'
       else
       result:='N';
     end
     else
     if modulo=2 then
     begin
       IF divida in [24] then
       result:='S'
       else
       result:='N';
      end
     else
     if modulo=3 then
     begin
       IF divida in [17,18] then
       result:='S'
       else
       result:='N';
      end
     else
     if modulo=4 then
     begin
       IF divida in [24] then
       result:='S'
       else
       result:='N';
      end
     else
     result:='N';

end;

procedure TFPrincipal.AcertaTestada;
var cadastro:String;
begin


     QOrigem.close;
     QOrigem.sql.clear;
     QOrigem.sql.add('SELECT * FROM VARIAVEL1 WHERE CDTIPOCADASTRO=1');
     Qorigem.Open;

     while not QOrigem.Eof do
     begin
      cadastro:=ZeraEsquerda(8,QOrigem.fieldByName('nrcadastro').AsString);
      cadastro:=copy(cadastro,1,2)+'-'+copy(cadastro,3,4)+'-'+copy(cadastro,7,2);

      QVerifica.close;
      QVerifica.sql.clear;
      QVerifica.sql.add('UPDATE IP_CAD_AREAS SET '+
      ' MTESTADA_ARE='+Subs_Virgula_por_Ponto(Qorigem.fieldByName('campo16').AsString)+', '+
      ' MTESTATAXA_ARE='+Subs_Virgula_por_Ponto(Qorigem.fieldByName('campo16').AsString)+','+
      ' PROFUND_ARE='+Subs_Virgula_por_Ponto(Qorigem.fieldByName('campo15').AsString)+
      ' WHERE COD_EMP_ARE=1 AND COD_IPT_ARE='''+cadastro+''' AND TP_ARE=''T''');
      QVerifica.execsql;


      QOrigem.next;
     end;

end;


procedure TFPrincipal.AcertaCadastroLancamento;
var cadastro:String;
begin
    QDestino.close;
    QDestino.sql.clear;
    QDestino.sql.add('SELECT * FROM FI_LANCAMENTO ');
    QDestino.open;

    while not QDestino.eof do
    begin
     if QDestino.fieldByName('cod_mod_lan').AsInteger=1 then
     cadastro:=ZeraEsquerda(8,QDestino.fieldByName('cod_cad_lan').AsString)
     else
     if QDestino.fieldByName('cod_mod_lan').AsInteger=2 then
     cadastro:=ZeraEsquerda(11,QDestino.fieldByName('cod_cad_lan').AsString)
     else
     cadastro:=ZeraEsquerda(9,QDestino.fieldByName('cod_cad_lan').AsString);





     QVerifica.close;
     QVerifica.sql.clear;
     QVerifica.sql.add('UPDATE FI_LANCAMENTO SET COD_CAD_LAN='''+CADASTRO+''' WHERE COD_EMP_LAN=1 AND COD_LAN='+QDestino.fieldByName('cod_LAN').AsString+' AND TP_LAN='+QDestino.fieldByName('TP_LAN').AsString );
     QVerifica.execsql;


     QDestino.next;
    end;
end;

procedure TFPrincipal.AcertaCadastro;
var cadastro:String;
begin
    QDestino.close;
    QDestino.sql.clear;
    QDestino.sql.add('SELECT * FROM FI_DIVIDA ');
    QDestino.open;

    while not QDestino.eof do
    begin
     if QDestino.fieldByName('cod_mod_div').AsInteger=1 then
     cadastro:=ZeraEsquerda(8,QDestino.fieldByName('cod_cad_div').AsString)
     else
     if QDestino.fieldByName('cod_mod_div').AsInteger=2 then
     cadastro:=ZeraEsquerda(11,QDestino.fieldByName('cod_cad_div').AsString)
     else
     cadastro:=ZeraEsquerda(9,QDestino.fieldByName('cod_cad_div').AsString);





     QVerifica.close;
     QVerifica.sql.clear;
     QVerifica.sql.add('UPDATE FI_DIVIDA SET COD_CAD_DIV='''+CADASTRO+''' WHERE COD_EMP_DIV=1 AND COD_DIV='+QDestino.fieldByName('cod_div').AsString);
     QVerifica.execsql;


     QDestino.next;
    end;
end;



procedure TFPrincipal.gleba;
 var cont,erros:Integer;
 linha,arquivo:String;
 F:TextFile;
begin

{$I-}
try
   Arquivo:='c:\gleba.txt';
   assignFile(F,Arquivo);

  if not FileExists(Arquivo) then
     rewrite(F);
    cont:=0;

  cont:=1;
  reset(F);
  QVerifica.close;
  QVerifica.sql.clear;
  QVerifica.sql.add('SELECT cast(MAX(COD_CVR) as integer) AS COD FROM IP_VALORCRT');
  QVerifica.open;
  CONT:=QVerifica.fieldByName('cod').AsInteger;

  Readln(F,linha);
  while (not EOF(F)) do
  begin

   if trim(copy(linha,1,100))<>'' then
   begin
    cdsdestino.close;
    sqlDestino.commandText:='select * from IP_VALORCRT';
    cdsdestino.open;

    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('COD_EMP_CVR').AsInteger:=1;
    cdsdestino.FieldByName('COD_CVR').AsInteger:=cont;
    cdsdestino.FieldByName('ANO_CVR').AsInteger:=2006;
    cdsdestino.FieldByName('COD_DCR_CVR').AsString:='0001';
    cdsdestino.FieldByName('COD_CRT_CVR').AsString:='0001';
    cdsdestino.FieldByName('COD_ZNA_CVR').AsString:='00001';
    cdsdestino.FieldByName('TP_ZNA_CVR').AsString:='02 - Zoneamento';
    cdsdestino.FieldByName('TIPO_CVR').AsString:='02 - FATOR DE CORR. TERRIT.';
    cdsdestino.FieldByName('LIMITEI_CVR').AsString:=Subs_Ponto_por_Virgula(trim(copy(linha,55,10)));
    cdsdestino.FieldByName('LIMITEF_CVR').AsString:=Subs_Ponto_por_Virgula(trim(copy(linha,109,10)));
    cdsdestino.FieldByName('VALOR_CVR').AsString:=Subs_Ponto_por_Virgula(trim(copy(linha,163,10)));
    cdsdestino.FieldByName('VALOR_CVR').AsCurrency:=cdsdestino.FieldByName('VALOR_CVR').AsCurrency/1000;
    cdsdestino.FieldByName('TPCALULO_CVR').AsString:='01 - MULTIPLICA FATORES';
    Erros:=0;

    if not Conexao.InTransaction then Conexao.StartTransaction(TD);

    if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
    if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

    if Erros = 0 then Conexao.Commit(TD)
    else begin
      Conexao.Rollback(TD);
      exit;
    end;
   end;


   readln(F,Linha);
  end;
 finally
  CloseFile(F);
 end;

{$I+}

end;

procedure TFPrincipal.Agrupamento;
 var cont,erros,i:Integer;
 linha,arquivo,zona:String;
 valor:Currency;
 F:TextFile;
begin

{$I-}
try
   Arquivo:='c:\agrupamento.txt';
   assignFile(F,Arquivo);
   zona:='00007';

  if not FileExists(Arquivo) then
     rewrite(F);
    cont:=0;


  reset(F);

  QVerifica.close;
  QVerifica.sql.clear;
  QVerifica.sql.add('SELECT cast(MAX(COD_ZDC) as integer) AS COD FROM IP_REL_CZONADCRT');
  QVerifica.open;
  CONT:=QVerifica.fieldByName('cod').AsInteger;

  QVerifica.close;
  QVerifica.sql.clear;
  QVerifica.sql.add('SELECT cast(MAX(COD_ID_ZIC) as integer) AS COD FROM IP_REL_IZONADCRT');
  QVerifica.open;
  i:=QVerifica.fieldByName('cod').AsInteger;

  Readln(F,linha);
  while (not EOF(F)) do
  begin

   if trim(copy(linha,1,100))<>'' then
   begin


    valor:=Arredonda(StrToCurr(Subs_Ponto_por_Virgula(trim(copy(linha,218,10)))),2);
    if (valor<>1) and (valor<>0) then
    begin
      cdsdestino.close;
      sqlDestino.commandText:='select * from IP_REL_CZONADCRT';
      cdsdestino.open;
      cont:=cont+1;
      cdsdestino.append;
      cdsdestino.FieldByName('COD_EMP_ZDC').AsInteger:=1;
      cdsdestino.FieldByName('COD_ZDC').AsInteger:=cont;
      cdsdestino.FieldByName('ANO_ZDC').AsInteger:=2006;
      cdsdestino.FieldByName('DESCRI_ZDC').AsString:='';
      cdsdestino.FieldByName('VALORM_ZDC').AsCurrency:=valor;
      cdsdestino.FieldByName('VALORK_ZDC').AsCurrency:=valor;
      cdsdestino.FieldByName('COD_ZNA_ZDC').AsString:=zona;
      cdsdestino.FieldByName('TP_ZNA_ZDC').AsString:='01 - Edificado';
      cdsdestino.FieldByName('TIPO_ZDC').AsString:='01 - FATOR DE CORR. PREDIAL';
      cdsdestino.FieldByName('DESCRI_ZNA_ZDC').AsString:='';
      cdsdestino.FieldByName('TPCALULO_ZDC').AsString:='01 - Multiplica Fatores';
      Erros:=0;

        if not Conexao.InTransaction then Conexao.StartTransaction(TD);

        if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
        if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

        if Erros = 0 then Conexao.Commit(TD)
        else begin
          Conexao.Rollback(TD);
          exit;
        end;




      cdsdestino.close;
      sqlDestino.commandText:='select * from IP_REL_IZONADCRT';
      cdsdestino.open;
      i:=i+1;
      cdsdestino.append;
      cdsdestino.FieldByName('COD_EMP_ZIC').AsInteger:=1;
      cdsdestino.FieldByName('COD_ID_ZIC').AsInteger:=i;
      cdsdestino.FieldByName('COD_ZIC').AsInteger:=cont;
      cdsdestino.FieldByName('ANO_ZIC').AsString:='2006';
      cdsdestino.FieldByName('COD_ZNA_ZIC').AsString:=zona;
      cdsdestino.FieldByName('TP_ZNA_ZIC').AsString:='01 - Edificado';

      cdsdestino.FieldByName('COD_CRT_ZIC').AsString:=ZeraEsquerda(4,trim(copy(linha,28,2)));
      cdsdestino.FieldByName('COD_DCR_ZIC').AsString:=ZeraEsquerda(4,trim(copy(linha,45,2)));

      cdsdestino.FieldByName('DESCRI_DCR_ZIC').AsString:='';
      cdsdestino.FieldByName('ORDEM_DCR_ZIC').AsInteger:=cont;
      cdsdestino.FieldByName('DESCRI_ZNA_ZIC').AsString:='';


      i:=i+1;
      cdsdestino.append;
      cdsdestino.FieldByName('COD_EMP_ZIC').AsInteger:=1;
      cdsdestino.FieldByName('COD_ID_ZIC').AsInteger:=i;
      cdsdestino.FieldByName('COD_ZIC').AsInteger:=cont;
      cdsdestino.FieldByName('ANO_ZIC').AsString:='2006';
      cdsdestino.FieldByName('COD_ZNA_ZIC').AsString:=zona;
      cdsdestino.FieldByName('TP_ZNA_ZIC').AsString:='01 - Edificado';

      cdsdestino.FieldByName('COD_CRT_ZIC').AsString:=ZeraEsquerda(4,trim(copy(linha,63,2)));
      cdsdestino.FieldByName('COD_DCR_ZIC').AsString:=ZeraEsquerda(4,trim(copy(linha,80,2)));

      cdsdestino.FieldByName('DESCRI_DCR_ZIC').AsString:='';
      cdsdestino.FieldByName('ORDEM_DCR_ZIC').AsInteger:=cont;
      cdsdestino.FieldByName('DESCRI_ZNA_ZIC').AsString:='';

      Erros:=0;

        if not Conexao.InTransaction then Conexao.StartTransaction(TD);

        if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
        if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

        if Erros = 0 then Conexao.Commit(TD)
        else begin
          Conexao.Rollback(TD);
          exit;
        end;








    end;

   end;


   readln(F,Linha);
  end;
 finally
  CloseFile(F);
 end;

{$I+}

end;




procedure TFPrincipal.dividaativa;
var cont,coddiv:Integer;
datainscricao:String;
begin
  QOrigem.close;
  QOrigem.sql.clear;
  QOrigem.sql.add('select * from inscricao ');
  QOrigem.open;
 progressBar1.Max:=QOrigem.RecordCount;

 label4.Caption:=IntToStr(ProgressBar1.max);
 label4.Update;



  cont:=1;
  while not QOrigem.eof do
  begin

   label1.Caption:=IntToStr(cont);
   label1.Update;

   ProgressBar1.Position:=cont;
   cont:=cont+1;

   label5.Caption:=QOrigem.fieldByName('nrcadastro').value;
   label5.Update;

   if trim(QOrigem.fieldByName('dtInscricao').AsString)<>'' then
   datainscricao:=QOrigem.fieldByName('dtInscricao').AsString
   else
   datainscricao:='01/01/'+IntToStr(QOrigem.fieldByName('dtAnoDebito').AsInteger+1);

   coddiv:=verificacodigodadivida(QOrigem.fieldByName('nrCadastro').AsString,QOrigem.fieldByName('dtanoDebito').AsString,QOrigem.fieldByName('cdDivida').AsString,QOrigem.fieldByName('cdSubDivida').AsString,QOrigem.fieldByName('cdTipoCadastro').AsString);

   QDestino.close;
   QDestino.sql.clear;
   QDestino.sql.add('UPDATE FI_PARCELA SET '+
   ' LIVRO_PAR='+QOrigem.fieldByName('nrlivro').AsString+','+
   ' FOLHA_PAR='+QOrigem.fieldByName('nrFolha').AsString+','+
   ' INSCRI_PAR='+QOrigem.fieldByName('nrInscricao').AsString+','+
   ' DATAINSCRI_PAR='''+FORMATDATETIME('MM/DD/YYYY',StrToDate(datainscricao))+''''+
   ' WHERE COD_EMP_PAR=1 AND COD_DIV_PAR='+IntToStr(coddiv)+
   ' AND TP_PAR='+QOrigem.fieldByName('cdSubDivida').AsString+
   ' AND PARCELA_PAR='+QOrigem.fieldByName('nrparcela').AsString
   );
   QDestino.ExecSQL();


  QOrigem.next;
  end;

end;


procedure TFPrincipal.Generators;
var
  valor:Integer;
  cod:String;
begin


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_REC) AS INTEGER) AS VALOR FROM GR_RECEITA');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_RECEITAS TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_GVR) AS INTEGER) AS VALOR FROM GR_VALORCERTIDAO');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_GR_VLRCERT TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_LOG) AS INTEGER) AS VALOR FROM GR_LOGRA');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_LOGRA TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_BAI) AS INTEGER) AS VALOR FROM GR_BAIRRO');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_BAIRROS TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_CNT) AS INTEGER) AS VALOR FROM GR_CONTRIBUINTES');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_GR_CONTRIBUINTES TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_CID) AS INTEGER) AS VALOR FROM GR_CIDADE');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_CIDADES TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_BCO) AS INTEGER) AS VALOR FROM GR_BANCO');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_BANCO TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_REC) AS INTEGER) AS VALOR FROM GR_RECEITA');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_RECEITAS TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_BCO) AS INTEGER) AS VALOR FROM GR_BANCO');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_BANCO TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_DIV) AS INTEGER) AS VALOR FROM FI_DIVIDA');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_CODDIV TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_LAN) AS INTEGER) AS VALOR FROM FI_LANCAMENTO WHERE TP_LAN=1');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_CODLANG TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_LAN) AS INTEGER) AS VALOR FROM FI_LANCAMENTO WHERE TP_LAN=2');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_CODLANP TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(NNUMERO_PAR) AS INTEGER) AS VALOR FROM FI_PARCELA ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_FINNUMERO TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_ATV) AS INTEGER) AS VALOR FROM LI_ATIVIDADE ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_ATIVIDADE TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_CAR) AS INTEGER) AS VALOR FROM GR_CARTORIOS ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_CARTORIOS TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_COB) AS INTEGER) AS VALOR FROM LI_COBRANCA ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_LI_COBRANCA TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_ESC) AS INTEGER) AS VALOR FROM LI_ESCRITORIO ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_ESCRITORIO TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_GRA) AS INTEGER) AS VALOR FROM LI_GRAFICAS ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_GRAFICAS TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_DPR) AS INTEGER) AS VALOR FROM LI_DECLARACAO ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_LI_DECLARACAO TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  {QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_MBL) AS INTEGER) AS VALOR FROM LI_MOBIL ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_LI_MOBIL TO '+INTTOSTR(VALOR));
  QDestino.execsql;
   }

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(NAUTORI_TLS) AS INTEGER) AS VALOR FROM LI_TALOES ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_LI_TALOES TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(NAUTORI_TLS) AS INTEGER) AS VALOR FROM LI_TALOES ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_LI_TALOES TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_SEQ_VRA) AS INTEGER) AS VALOR FROM LI_VALORATIVIDADE ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_LI_VALORATIVIDADE TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_SEQ_VRC) AS INTEGER) AS VALOR FROM LI_VALORCALCULO ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_LI_VALORCALCULO TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_TXT) AS INTEGER) AS VALOR FROM GR_TEXTO ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_MENSAGEM TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_TXT) AS INTEGER) AS VALOR FROM GR_TEXTO ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_MENSAGEM TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_HEA) AS INTEGER) AS VALOR FROM DA_HEADER ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_HEADER TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_RET) AS INTEGER) AS VALOR FROM DA_RETORNO ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_RETORNO TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_TPB) AS INTEGER) AS VALOR FROM DA_RETORNOTIPOB ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_RETORNOTIPOB TO '+INTTOSTR(VALOR));
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_TPB) AS INTEGER) AS VALOR FROM DA_RETORNOTIPOB ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_RETORNOTIPOB TO '+INTTOSTR(VALOR));
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SELECT CAST(MAX(COD_EMP) AS INTEGER) AS VALOR FROM GR_CAD_EMPRESA ');
  QDestino.open;
  Valor:=QDestino.fieldByName('valor').AsInteger;
  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('SET GENERATOR GEN_EMPRESA TO '+INTTOSTR(VALOR));
  QDestino.execsql;



end;


procedure TFPrincipal.AtualizaDados;
var cont:Integer;

begin

      cdsDestino.close;
      sqlDestino.commandText:='SELECT * FROM FI_DIVIDA WHERE COD_EMP_DIV=1 AND COD_CNT_DIV=''1'' ';
      cdsDestino.open;

      ProgressBar1.Max:=cdsDestino.recordcount;

      label4.caption:=IntToStr(ProgressBar1.Max);
      label4.update;

      cont:=0;
      while not cdsDestino.eof do
      begin
       TRY
       cont:=cont+1;
       ProgressBar1.position:=cont;
       label5.caption:=cdsDestino.fieldByName('cod_cad_div').AsString;
       label5.update;

       label1.caption:=IntToStr(cont);
       label1.update;

       if cdsDestino.fieldByName('cod_mod_div').AsInteger=1 then
       begin
        QAuxiliar.close;
        QAuxiliar.sql.clear;
        QAuxiliar.sql.add(' SELECT COD_EMP_IPT,COD_IPT,COD_BAI_IPT,COD_LOG_IPT,NUMERO_IPT,COMPLE_IPT,'+
                          ' CEP_IPT,SETOR_IPT,QUADRA_IPT,LOTES_IPT,UNIDADE_IPT,FACE_IPT,SECAO_IPT, '+
                          ' COD_CNT_IPT,COD_CNTC_IPT,MATRIC_IPT,COD_BAIE_IPT,BAIRRO_IPT,COD_LOGE_IPT,'+
                          ' LOGRA_IPT,NUMEROE_IPT,CEPE_IPT,COMPLEE_IPT,COD_CIDE_IPT,UFE_IPT '+
                          ' FROM IP_CAD_IPTU WHERE COD_EMP_IPT=1 AND COD_IPT='''+cdsDestino.fieldByName('cod_cad_div').AsString+'''');
        QAuxiliar.open;
        if not QAuxiliar.IsEmpty then
        begin                                 
               QVerifica.close;
               QVerifica.sql.clear;
               QVerifica.sql.add(' UPDATE FI_DIVIDA SET '+
                                 ' COD_CNT_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_CNT_IPT').Value)+','+
                                 ' COD_BAI_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_BAI_IPT').Value)+','+
                                 ' COD_LOG_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_LOG_IPT').Value)+','+
                                 ' NUMERO_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('NUMERO_IPT').Value)+','+
                                 ' COMPLE_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('COMPLE_IPT').AsString,''''))+','+
                                 ' CEPI_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('CEP_IPT').Value)+','+
                                 ' SETOR_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('SETOR_IPT').Value)+','+
                                 ' QUADRA_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('QUADRA_IPT').Value)+','+
                                 ' LOTE_DIV = '+TrataDadosFinanceiro(copy(QAuxiliar.fieldByName('LOTES_IPT').AsString,1,10))+','+
                                 ' UNIDADE_DIV = '+TrataDadosFinanceiro(copy(QAuxiliar.fieldByName('UNIDADE_IPT').AsString,1,10))+','+
                                 ' FACE_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('FACE_IPT').Value)+','+
                                 ' SECAO_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('SECAO_IPT').Value)+','+
                                 ' CODC_CNT_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_CNTC_IPT').Value)+','+
                                 ' COD_BAIE_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_BAIE_IPT').Value)+','+
                                 ' BAIRRO_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('BAIRRO_IPT').AsString,''''))+','+
                                 ' COD_LOGE_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_LOGE_IPT').Value)+','+
                                 ' LOGRA_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('LOGRA_IPT').AsString,''''))+','+
                                 ' NUMEROE_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('NUMEROE_IPT').Value)+','+
                                 ' CEPE_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('CEPE_IPT').Value)+','+
                                 ' COMPLEE_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('COMPLEE_IPT').AsString,''''))+','+
                                 ' COD_CID_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_CIDE_IPT').Value)+
                                 ' WHERE COD_EMP_DIV=1 AND COD_DIV='+cdsDestino.fieldByName('COD_DIV').AsString
                                 );
               QVerifica.ExecSQL();

        end;

       end
       else
       if cdsDestino.fieldByName('cod_mod_div').AsInteger=2 then
       begin

        QAuxiliar.close;
        QAuxiliar.sql.clear;
        QAuxiliar.sql.add(' SELECT COD_EMP_MBL,COD_MBL,COD_BAI_MBL,COD_LOG_MBL,NUMERO_MBL,COMPLE_MBL,'+
                          ' CEPI_MBL,COD_CNT_MBL,INSCRM_MBL,COD_BAIE_MBL,BAIRRO_MBL,COD_LOGE_MBL,'+
                          ' LOGRA_MBL,NUMEROE_MBL,CEPE_MBL,COMPLEE_MBL,COD_CID_MBL '+
                          ' FROM LI_MOBIL WHERE COD_EMP_MBL=1 AND COD_MBL='''+cdsDestino.fieldByName('cod_cad_div').AsString+'''');
        QAuxiliar.open;
        if not QAuxiliar.IsEmpty then
        begin
               QVerifica.close;
               QVerifica.sql.clear;
               QVerifica.sql.add(' UPDATE FI_DIVIDA SET '+
                                 ' COD_CNT_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_CNT_MBL').Value)+','+
                                 ' COD_BAI_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_BAI_MBL').Value)+','+
                                 ' COD_LOG_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_LOG_MBL').Value)+','+
                                 ' NUMERO_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('NUMERO_MBL').Value)+','+
                                 ' COMPLE_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('COMPLE_MBL').AsString,''''))+','+
                                 ' CEPI_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('CEPI_MBL').Value)+','+
                                 ' CODC_CNT_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_CNT_MBL').Value)+','+
                                 ' COD_BAIE_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_BAIE_MBL').Value)+','+
                                 ' BAIRRO_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('BAIRRO_MBL').AsString,''''))+','+
                                 ' COD_LOGE_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_LOGE_MBL').Value)+','+
                                 ' LOGRA_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('LOGRA_MBL').AsString,''''))+','+
                                 ' NUMEROE_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('NUMEROE_MBL').Value)+','+
                                 ' CEPE_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('CEPE_MBL').Value)+','+
                                 ' COMPLEE_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('COMPLEE_MBL').AsString,''''))+','+
                                 ' COD_CID_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_CID_MBL').Value)+
                                 ' WHERE COD_EMP_DIV=1 AND COD_DIV='+cdsDestino.fieldByName('COD_DIV').AsString
                                 );
               QVerifica.ExecSQL();

        end;


       end
       else
       if cdsDestino.fieldByName('cod_mod_div').AsInteger=5 then
       begin

        QAuxiliar.close;
        QAuxiliar.sql.clear;
        QAuxiliar.sql.add(' SELECT COD_EMP_cnt,COD_CNT,COD_BAI_CNT,COD_LOG_CNT,NUMERO_CNT,COMPLE_CNT,'+
                          ' CEP_CNT,RG_CNT,NOM_BAI_CNT,NOM_LOG_CNT,'+
                          ' COD_CID_CNT '+
                          ' FROM GR_CONTRIBUINTES WHERE COD_EMP_CNT=1 AND COD_CNT='''+cdsDestino.fieldByName('cod_cad_div').AsString+'''');
        QAuxiliar.open;
        if not QAuxiliar.IsEmpty then
        begin
               QVerifica.close;
               QVerifica.sql.clear;
               QVerifica.sql.add(' UPDATE FI_DIVIDA SET '+
                               //  ' COD_CNT_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_CNT').Value)+','+
                               //  ' COD_BAI_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_BAI_CNT').Value)+','+
                               //  ' COD_LOG_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_LOG_CNT').Value)+','+
                               //  ' NUMERO_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('NUMERO_CNT').Value)+','+
                               //  ' COMPLE_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COMPLE_CNT').Value)+','+
                               // ' CEPI_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('CEP_CNT').Value)+','+
                               // ' CODC_CNT_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_CNT').Value)+','+
                                 ' COD_BAIE_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_BAI_CNT').Value)+','+
                                 ' BAIRRO_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('NOM_BAI_CNT').AsString,''''))+','+
                                 ' COD_LOGE_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_LOG_CNT').Value)+','+
                                 ' LOGRA_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('NOM_LOG_CNT').AsString,''''))+','+
                                 ' NUMEROE_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('NUMERO_CNT').Value,''''))+','+
                                 ' CEPE_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('CEP_CNT').Value,''''))+','+
                                 ' COMPLEE_DIV = '+TrataDadosFinanceiro(RetiraChar(QAuxiliar.fieldByName('COMPLE_CNT').AsString,''''))+','+
                                 ' COD_CID_DIV = '+TrataDadosFinanceiro(QAuxiliar.fieldByName('COD_CID_CNT').Value)+
                                 ' WHERE COD_EMP_DIV=1 AND COD_DIV='+cdsDestino.fieldByName('COD_DIV').AsString
                                 );
               QVerifica.ExecSQL();

        end;


       end;


       EXCEPT
       END;

       cdsDestino.next;
      end;

end;


procedure TFPrincipal.refis;
var erros,cont:Integer;
begin

    QVerifica.Close;
    QVerifica.sql.Clear;
    QVerifica.SQL.add('DELETE FROM FI_DESCOACRESCI');
    QVerifica.execsql;

    QVerifica.Close;
    QVerifica.sql.Clear;
    QVerifica.SQL.add('SELECT * FROM FI_RECPRINCIPAL');
    QVerifica.open;

    cdsdestino.close;
    sqlDestino.commandText:='select * from FI_DESCOACRESCI ';
    cdsdestino.open;
    cont:=0;

    while not QVerifica.Eof do
    begin
    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_dsa').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('item_dsa').AsInteger:=cont;
    cdsdestino.FieldByName('cod_rfs_dsa').AsInteger:=10;
    cdsdestino.FieldByName('cod_mod_dsa').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_dsa').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('parcelai_dsa').AsString:='0';
    cdsdestino.FieldByName('parcelaf_dsa').AsString:='1';
    cdsdestino.FieldByName('receita_dsa').AsString:='S';
    cdsdestino.FieldByName('correcao_dsa').AsString:='N';
    cdsdestino.FieldByName('multa_dsa').AsString:='S';
    cdsdestino.FieldByName('juros_dsa').AsString:='S';
    cdsdestino.FieldByName('ano_dsa').AsString:='2008';

    cdsdestino.FieldByName('vrcorrecao_dsa').AsString:='0';
    cdsdestino.FieldByName('vrjuros_dsa').AsString:='90';
    cdsdestino.FieldByName('vrmulta_dsa').AsString:='90';
    cdsdestino.FieldByName('vrreceita_dsa').AsString:='10';

    cdsdestino.FieldByName('TIPO_DSA').AsString:='01 - Desconto';
    cdsdestino.FieldByName('TPCALCULO_DSA').AsString:='01 - Porcentagem Sobre Valor';


    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_dsa').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('item_dsa').AsInteger:=cont;
    cdsdestino.FieldByName('cod_rfs_dsa').AsInteger:=10;
    cdsdestino.FieldByName('cod_mod_dsa').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_dsa').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('parcelai_dsa').AsString:='2';
    cdsdestino.FieldByName('parcelaf_dsa').AsString:='10';
    cdsdestino.FieldByName('receita_dsa').AsString:='S';
    cdsdestino.FieldByName('correcao_dsa').AsString:='N';
    cdsdestino.FieldByName('multa_dsa').AsString:='S';
    cdsdestino.FieldByName('juros_dsa').AsString:='S';
    cdsdestino.FieldByName('ano_dsa').AsString:='2008';

    cdsdestino.FieldByName('vrcorrecao_dsa').AsString:='0';
    cdsdestino.FieldByName('vrjuros_dsa').AsString:='70';
    cdsdestino.FieldByName('vrmulta_dsa').AsString:='70';
    cdsdestino.FieldByName('vrreceita_dsa').AsString:='5';

    cdsdestino.FieldByName('TIPO_DSA').AsString:='01 - Desconto';
    cdsdestino.FieldByName('TPCALCULO_DSA').AsString:='01 - Porcentagem Sobre Valor';


    Erros:=0;

    if not Conexao.InTransaction then Conexao.StartTransaction(TD);

    if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
    if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

    if Erros = 0 then Conexao.Commit(TD)
    else begin
      Conexao.Rollback(TD);
      exit;
    end;


     QVerifica.Next;
    end;

end;


procedure TFPrincipal.multa;
var erros,cont:Integer;
begin

    QVerifica.Close;
    QVerifica.sql.Clear;
    QVerifica.SQL.add('DELETE FROM FI_MULTA');
    QVerifica.execsql;


    QVerifica.Close;
    QVerifica.sql.Clear;
    QVerifica.SQL.add('SELECT CAST(MAX(COD_MLT)AS INTEGER) AS COD FROM FI_MULTA');
    QVerifica.open;
    cont:=QVerifica.fieldByName('cod').AsInteger;

    QVerifica.Close;
    QVerifica.sql.Clear;
    QVerifica.SQL.add('SELECT * FROM FI_RECPRINCIPAL');
    QVerifica.open;

    cdsdestino.close;
    sqlDestino.commandText:='select * from FI_MULTA ';
    cdsdestino.open;


    while not QVerifica.Eof do
    begin
    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_mlt').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('cod_mlt').AsInteger:=cont;
    cdsdestino.FieldByName('cod_mod_mlt').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_mlt').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('dtinicial_mlt').AsString:='01/01/1900';
    cdsdestino.FieldByName('dtfinal_mlt').AsString:='31/12/2090';
    cdsdestino.FieldByName('limitei_mlt').AsString:='0';
    cdsdestino.FieldByName('limitef_mlt').AsString:='30';
    cdsdestino.FieldByName('qtde_mlt').AsString:='2';
//  cdsdestino.FieldByName('qtde_mlt').AsString:='2';
//  cdsdestino.FieldByName('limite_mlt').AsString:='2';
//  cdsdestino.FieldByName('tpcalculo_mlt').AsString:='03 - Diaria e com Limite';
    cdsdestino.FieldByName('tpcalculo_mlt').AsString:='01 - % Porcentagem';

    cdsdestino.FieldByName('LOGIN_INC_MLT').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_MLT').value:=date;

    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_mlt').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('cod_mlt').AsInteger:=cont;
    cdsdestino.FieldByName('cod_mod_mlt').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_mlt').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('dtinicial_mlt').AsString:='01/01/1900';
    cdsdestino.FieldByName('dtfinal_mlt').AsString:='31/12/2090';
    cdsdestino.FieldByName('limitei_mlt').AsString:='31';
    cdsdestino.FieldByName('limitef_mlt').AsString:='60';
    cdsdestino.FieldByName('qtde_mlt').AsString:='4';
//  cdsdestino.FieldByName('qtde_mlt').AsString:='2';
//  cdsdestino.FieldByName('limite_mlt').AsString:='2';
//  cdsdestino.FieldByName('tpcalculo_mlt').AsString:='03 - Diaria e com Limite';
    cdsdestino.FieldByName('tpcalculo_mlt').AsString:='01 - % Porcentagem';

    cdsdestino.FieldByName('LOGIN_INC_MLT').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_MLT').value:=date;

    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_mlt').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('cod_mlt').AsInteger:=cont;
    cdsdestino.FieldByName('cod_mod_mlt').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_mlt').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('dtinicial_mlt').AsString:='01/01/1900';
    cdsdestino.FieldByName('dtfinal_mlt').AsString:='31/12/2090';
    cdsdestino.FieldByName('limitei_mlt').AsString:='61';
    cdsdestino.FieldByName('limitef_mlt').AsString:='90';
    cdsdestino.FieldByName('qtde_mlt').AsString:='6';
//  cdsdestino.FieldByName('qtde_mlt').AsString:='2';
//  cdsdestino.FieldByName('limite_mlt').AsString:='2';
//  cdsdestino.FieldByName('tpcalculo_mlt').AsString:='03 - Diaria e com Limite';
    cdsdestino.FieldByName('tpcalculo_mlt').AsString:='01 - % Porcentagem';

    cdsdestino.FieldByName('LOGIN_INC_MLT').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_MLT').value:=date;


    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_mlt').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('cod_mlt').AsInteger:=cont;
    cdsdestino.FieldByName('cod_mod_mlt').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_mlt').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('dtinicial_mlt').AsString:='01/01/1900';
    cdsdestino.FieldByName('dtfinal_mlt').AsString:='31/12/2090';
    cdsdestino.FieldByName('limitei_mlt').AsString:='91';
    cdsdestino.FieldByName('limitef_mlt').AsString:='120';
    cdsdestino.FieldByName('qtde_mlt').AsString:='8';
//  cdsdestino.FieldByName('qtde_mlt').AsString:='2';
//  cdsdestino.FieldByName('limite_mlt').AsString:='2';
//  cdsdestino.FieldByName('tpcalculo_mlt').AsString:='03 - Diaria e com Limite';
    cdsdestino.FieldByName('tpcalculo_mlt').AsString:='01 - % Porcentagem';

    cdsdestino.FieldByName('LOGIN_INC_MLT').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_MLT').value:=date;

    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_mlt').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('cod_mlt').AsInteger:=cont;
    cdsdestino.FieldByName('cod_mod_mlt').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_mlt').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('dtinicial_mlt').AsString:='01/01/1900';
    cdsdestino.FieldByName('dtfinal_mlt').AsString:='31/12/2090';
    cdsdestino.FieldByName('limitei_mlt').AsString:='121';
    cdsdestino.FieldByName('limitef_mlt').AsString:='150';
    cdsdestino.FieldByName('qtde_mlt').AsString:='10';
//  cdsdestino.FieldByName('qtde_mlt').AsString:='2';
//  cdsdestino.FieldByName('limite_mlt').AsString:='2';
//  cdsdestino.FieldByName('tpcalculo_mlt').AsString:='03 - Diaria e com Limite';
    cdsdestino.FieldByName('tpcalculo_mlt').AsString:='01 - % Porcentagem';

    cdsdestino.FieldByName('LOGIN_INC_MLT').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_MLT').value:=date;


    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_mlt').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('cod_mlt').AsInteger:=cont;
    cdsdestino.FieldByName('cod_mod_mlt').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_mlt').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('dtinicial_mlt').AsString:='01/01/1900';
    cdsdestino.FieldByName('dtfinal_mlt').AsString:='31/12/2090';
    cdsdestino.FieldByName('limitei_mlt').AsString:='151';
    cdsdestino.FieldByName('limitef_mlt').AsString:='180';
    cdsdestino.FieldByName('qtde_mlt').AsString:='12';
//  cdsdestino.FieldByName('qtde_mlt').AsString:='2';
//  cdsdestino.FieldByName('limite_mlt').AsString:='2';
//  cdsdestino.FieldByName('tpcalculo_mlt').AsString:='03 - Diaria e com Limite';
    cdsdestino.FieldByName('tpcalculo_mlt').AsString:='01 - % Porcentagem';

    cdsdestino.FieldByName('LOGIN_INC_MLT').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_MLT').value:=date;


    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_mlt').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('cod_mlt').AsInteger:=cont;
    cdsdestino.FieldByName('cod_mod_mlt').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_mlt').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('dtinicial_mlt').AsString:='01/01/1900';
    cdsdestino.FieldByName('dtfinal_mlt').AsString:='31/12/2090';
    cdsdestino.FieldByName('limitei_mlt').AsString:='181';
    cdsdestino.FieldByName('limitef_mlt').AsString:='210';
    cdsdestino.FieldByName('qtde_mlt').AsString:='14';
//  cdsdestino.FieldByName('qtde_mlt').AsString:='2';
//  cdsdestino.FieldByName('limite_mlt').AsString:='2';
//  cdsdestino.FieldByName('tpcalculo_mlt').AsString:='03 - Diaria e com Limite';
    cdsdestino.FieldByName('tpcalculo_mlt').AsString:='01 - % Porcentagem';

    cdsdestino.FieldByName('LOGIN_INC_MLT').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_MLT').value:=date;




    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_mlt').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('cod_mlt').AsInteger:=cont;
    cdsdestino.FieldByName('cod_mod_mlt').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_mlt').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('dtinicial_mlt').AsString:='01/01/1900';
    cdsdestino.FieldByName('dtfinal_mlt').AsString:='31/12/2090';
    cdsdestino.FieldByName('limitei_mlt').AsString:='211';
    cdsdestino.FieldByName('limitef_mlt').AsString:='240';
    cdsdestino.FieldByName('qtde_mlt').AsString:='16';
//  cdsdestino.FieldByName('qtde_mlt').AsString:='2';
//  cdsdestino.FieldByName('limite_mlt').AsString:='2';
//  cdsdestino.FieldByName('tpcalculo_mlt').AsString:='03 - Diaria e com Limite';
    cdsdestino.FieldByName('tpcalculo_mlt').AsString:='01 - % Porcentagem';

    cdsdestino.FieldByName('LOGIN_INC_MLT').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_MLT').value:=date;


    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_mlt').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('cod_mlt').AsInteger:=cont;
    cdsdestino.FieldByName('cod_mod_mlt').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_mlt').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('dtinicial_mlt').AsString:='01/01/1900';
    cdsdestino.FieldByName('dtfinal_mlt').AsString:='31/12/2090';
    cdsdestino.FieldByName('limitei_mlt').AsString:='241';
    cdsdestino.FieldByName('limitef_mlt').AsString:='270';
    cdsdestino.FieldByName('qtde_mlt').AsString:='18';
//  cdsdestino.FieldByName('qtde_mlt').AsString:='2';
//  cdsdestino.FieldByName('limite_mlt').AsString:='2';
//  cdsdestino.FieldByName('tpcalculo_mlt').AsString:='03 - Diaria e com Limite';
    cdsdestino.FieldByName('tpcalculo_mlt').AsString:='01 - % Porcentagem';

    cdsdestino.FieldByName('LOGIN_INC_MLT').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_MLT').value:=date;


    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_mlt').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('cod_mlt').AsInteger:=cont;
    cdsdestino.FieldByName('cod_mod_mlt').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_mlt').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('dtinicial_mlt').AsString:='01/01/1900';
    cdsdestino.FieldByName('dtfinal_mlt').AsString:='31/12/2090';
    cdsdestino.FieldByName('limitei_mlt').AsString:='271';
    cdsdestino.FieldByName('limitef_mlt').AsString:='999999';
    cdsdestino.FieldByName('qtde_mlt').AsString:='20';
//  cdsdestino.FieldByName('qtde_mlt').AsString:='2';
//  cdsdestino.FieldByName('limite_mlt').AsString:='2';
//  cdsdestino.FieldByName('tpcalculo_mlt').AsString:='03 - Diaria e com Limite';
    cdsdestino.FieldByName('tpcalculo_mlt').AsString:='01 - % Porcentagem';

    cdsdestino.FieldByName('LOGIN_INC_MLT').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_MLT').value:=date;





    Erros:=0;

    if not Conexao.InTransaction then Conexao.StartTransaction(TD);

    if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
    if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

    if Erros = 0 then Conexao.Commit(TD)
    else begin
      Conexao.Rollback(TD);
      exit;
    end;


     QVerifica.Next;
    end;

end;

procedure TFPrincipal.juros;
var erros,cont:Integer;
begin

    QVerifica.Close;
    QVerifica.sql.Clear;
    QVerifica.SQL.add('DELETE FROM FI_JUROS');
    QVerifica.execsql;

    QVerifica.sql.Clear;
    QVerifica.SQL.add('SELECT CAST(MAX(COD_jur)AS INTEGER) AS COD FROM FI_juros');
    QVerifica.open;
    cont:=QVerifica.fieldByName('cod').AsInteger;


    QVerifica.Close;
    QVerifica.sql.Clear;
    QVerifica.SQL.add('SELECT * FROM FI_RECPRINCIPAL');
    QVerifica.open;

    cdsdestino.close;
    sqlDestino.commandText:='select * from FI_JUROS ';
    cdsdestino.open;

    while not QVerifica.Eof do
    begin
    cont:=cont+1;
    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_jur').AsInteger:=QVerifica.fieldByName('cod_emp_rep').AsInteger;
    cdsdestino.FieldByName('cod_jur').AsInteger:=cont;
    cdsdestino.FieldByName('cod_mod_jur').AsInteger:=QVerifica.fieldByName('cod_mod_rep').AsInteger;
    cdsdestino.FieldByName('cod_rep_jur').AsString:=QVerifica.fieldByName('cod_rep').AsString;
    cdsdestino.FieldByName('dtinicial_jur').AsString:='01/01/1900';
    cdsdestino.FieldByName('dtfinal_jur').AsString:='31/12/2080';
    cdsdestino.FieldByName('limitei_jur').AsString:='0';
    cdsdestino.FieldByName('limitef_jur').AsString:='99999999';
    cdsdestino.FieldByName('qtde_jur').AsString:='1';
    cdsdestino.FieldByName('tpcalculo_jur').AsString:='02 - Fração Integral';
    cdsdestino.FieldByName('LOGIN_INC_jur').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_jur').value:=date;



    Erros:=0;
    if not Conexao.InTransaction then Conexao.StartTransaction(TD);

    if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
    if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

    if Erros = 0 then Conexao.Commit(TD)
    else begin
      Conexao.Rollback(TD);
      exit;
    end;


     QVerifica.Next;
    end;

end;

function TFPrincipal.buscacadastro(codigodevedor,nome,tributo:String):String;
var nregistro:Integer;
begin

   IF TRIBUTO='01' THEN//IPTU
   BEGIN
    QCadastro.close;
    QCadastro.sql.clear;
    QCadastro.sql.add('SELECT CODIGO FROM IPTU WHERE NOME LIKE "%'+NOME+'%"');
    QCadastro.open;
   END
   ELSE
   IF TRIBUTO='02' THEN//ISS
   BEGIN
    QCadastro.close;
    QCadastro.sql.clear;
    QCadastro.sql.add('SELECT CODIGO FROM ISS WHERE NOME LIKE "%'+NOME+'%"');
    QCadastro.open;
   END
   ELSE
   IF TRIBUTO='03' THEN//TAXA
   BEGIN
    QCadastro.close;
    QCadastro.sql.clear;
    QCadastro.sql.add('SELECT CODIGO FROM TAXA WHERE NOME LIKE "%'+NOME+'%"');
    QCadastro.open;
   END
   ELSE
   IF TRIBUTO='04' THEN//AMBULANTE
   BEGIN
    QCadastro.close;
    QCadastro.sql.clear;
    QCadastro.sql.add('SELECT CODIGO FROM AMBULANTE WHERE NOME LIKE "%'+NOME+'%"');
    QCadastro.open;
   END
   ELSE
   IF TRIBUTO='08' THEN//TAXI
   BEGIN
    QCadastro.close;
    QCadastro.sql.clear;
    QCadastro.sql.add('SELECT CODIGO FROM TAXI WHERE NOME LIKE "%'+NOME+'%"');
    QCadastro.open;
   END
   ELSE
   IF TRIBUTO='09' THEN//TAXA2
   BEGIN
    QCadastro.close;
    QCadastro.sql.clear;
    QCadastro.sql.add('SELECT CODIGO FROM TAXA2 WHERE NOME LIKE "%'+NOME+'%"');
    QCadastro.open;
   END;

   IF QCadastro.IsEmpty then
   begin
    QCadastro.close;
    QCadastro.sql.clear;
    QCadastro.sql.add('SELECT ORIG_CODIGO  as CODIGO FROM CADDIVID WHERE ANO>="2001" AND CODTRIB="'+TRIBUTO+'" AND ORIG_NOME LIKE "%'+NOME+'%"');
    QCadastro.open;
   end;

   nregistro:=QCadastro.recordcount;

   IF nregistro=1 then
    result:=QCadastro.fieldByName('codigo').AsString
   Else
   IF nregistro>1 then
   begin
    result:='X';
    label6.caption:=IntToStr(StrToInt(label6.caption)+1);
    label6.update;
   end
   else
   begin
    label6.caption:=IntToStr(StrToInt(label6.caption)+1);
    label6.update;
    result:='X';
   end;


end;

function TFPrincipal.verificacodigodadivida(cadastro,ano,tributo,matricula,modulo:String):Integer;
begin
  QVerifica.close;
  QVerifica.sql.Clear;
  QVerifica.sql.add(' SELECT * FROM FI_DIVIDA '+
                    ' WHERE COD_EMP_DIV=1 AND COD_MOD_DIV='+modulo+' AND COD_CAD_DIV='''+cadastro+''' AND ANO_DIV='''+ano+''''+
                    ' AND COD_REP_DIV='+tributo+' AND MATRICULA_DIV='''+matricula+''' ');
  QVerifica.Open;
  result:=QVerifica.fieldByName('cod_div').AsInteger;

end;



function TFPrincipal.cidade(nome,Estado:String):String;
var codigo:Integer;
begin
  QVerifica.close;
  QVerifica.sql.Clear;
  QVerifica.sql.add('SELECT * FROM GR_CIDADE WHERE UPPER(NOME_CID) LIKE '''+UPPERCASE(NOME)+'''');
  QVerifica.Open;
  IF QVerifica.IsEmpty then
  begin
   QVerifica.close;
   QVerifica.sql.Clear;
   QVerifica.sql.add('SELECT COALESCE(MAX(COD_CID),0) AS CODIGO FROM GR_CIDADE ');
   QVerifica.Open;
   codigo:=QVerifica.fieldByName('CODIGO').AsInteger+1;

   QDestino.close;
   QDestino.sql.Clear;
   QDestino.sql.add('INSERT INTO GR_CIDADE (COD_CID,NOME_CID,LOGIN_INC_CID,DTA_INC_CID) VALUES ('+
                     ''''+ZeraEsquerda(7,IntToStr(codigo))+''','+
                     ''''+NOME+''','+
                     '''CONVERSAO'','+
                     ''''+FormatDateTime('mm/dd/yyyy',date)+''''+
                    ')');
   QDestino.execsql;
  end
  else
  begin
  codigo:=QVerifica.fieldByName('COD_CID').AsInteger;
  end;

  result:=ZeraEsquerda(7,IntToStr(codigo));

end;


function TFPrincipal.logradouro(nome,cep:String):String;
var codigo:Integer;
begin

  QVerifica.close;
  QVerifica.sql.Clear;
  QVerifica.sql.add('SELECT * FROM GR_LOGRA WHERE UPPER(NOME_LOG) LIKE ''%'+UPPERCASE(RETIRACHAR(NOME,''''))+'%''');
  QVerifica.Open;
  IF NOT QVerifica.IsEmpty then
  result:=QVerifica.fieldByName('COD_LOG').AsString
  else
  result:='';

end;

function TFPrincipal.bairro(nome:String):String;
var codigo:Integer;
begin

  QVerifica.close;
  QVerifica.sql.Clear;
  QVerifica.sql.add('SELECT * FROM GR_BAIRRO WHERE UPPER(NOME_BAI) LIKE ''%'+UPPERCASE(RETIRACHAR(NOME,''''))+'%''');
  QVerifica.Open;
  IF NOT QVerifica.IsEmpty then
  result:=QVerifica.fieldByName('COD_BAI').AsString
  ELSE
  result:='';

end;


function TFPrincipal.ContribuintesNota(nome,rg,cnpj,fone,fax,email,cid,uf,logra,numero,complemento,bai,cep:String):String;
var
codcid,codigo:String;
codlog,codbai:variant;

begin

  NOME:=RetiraChar(NOME,'''');
  QVerifica.close;
  QVerifica.sql.Clear;
  QVerifica.sql.add('SELECT * FROM GR_CONTRIBUINTES WHERE COD_EMP_CNT=1 AND UPPER(NOME_CNT) = '''+UPPERCASE(NOME)+''' AND CNPJ_CNT='''+cnpj+'''');
  QVerifica.Open;
  IF QVerifica.IsEmpty then
  begin
   QVerifica.close;
   QVerifica.sql.Clear;
   QVerifica.sql.add('select CAST(MAX(COD_CNT) AS INTEGER) CODIGO FROM GR_CONTRIBUINTES WHERE COD_EMP_CNT=1');
   QVerifica.Open;
   codigo:=IntToStr(QVerifica.fieldByName('CODIGO').AsInteger+1);


   codlog:=logradouro(logra,'');
   if trim(codlog)='' then
   codlog:='NULL';

   codbai:=Bairro(bai);
   if trim(codbai)='' then
   codbai:='NULL';


   if trim(cep)='' then
   cep:='77980000';

   if trim(cid)='' then
   BEGIN
    cid:='SAMPAIO';
    UF:='TO';
   END;

   codcid:=cidade(cid,uf);

   QDestino.close;
   QDestino.sql.Clear;
   QDestino.sql.add('INSERT INTO GR_CONTRIBUINTES (COD_EMP_CNT,COD_CNT,NOME_CNT,RG_CNT,CNPJ_CNT, '+
   ' FAX_CNT,FONE_CNT,EMAIL_CNT,COD_LOG_CNT,COD_BAI_CNT,COD_CID_CNT,NUMERO_CNT,CEP_CNT,COMPLE_CNT, '+
   ' LOGIN_INC_CNT,DTA_INC_CNT,NOM_LOG_CNT,NOM_BAI_CNT) VALUES ('+
                     '1,'+
                     ''''+ZeraEsquerda(9,codigo)+''','+
                     ''''+copy(NOME,1,60)+''','+
                     ''''+TiraCaracter(RG)+''','+
                     ''''+TiraCaracter(CNPJ)+''','+
                     ''''+TiraCaracter(FAX)+''','+
                     ''''+TiraCaracter(FONE)+''','+
                     ''''+EMAIL+''','+
                     codlog+','+
                     codbai+','+
                     ''''+codcid+''','+
                     ''''+NUMERO+''','+
                     ''''+TiraCaracter(CEP)+''','+
                     ''''+copy(trim(RetiraChar(COMPLEMENTO,'''')),1,30)+''','+
                     '''CONVERSAO'','+
                     ''''+FormatDateTime('mm/dd/yyyy',date)+''','+
                     ''''+COPY(TRIM(RetiraChar(logra,'''')),1,60)+''','+
                     ''''+COPY(TRIM(RetiraChar(bai,'''')),1,60)+''''+
                    ')');
   QDestino.execsql;

  end
  else
  begin
   codigo:=QVerifica.fieldByName('COD_CNT').AsString;
  end;

   result:=ZeraEsquerda(9,codigo);

end;


function TFPrincipal.Contribuintes(nome,rg,cnpj,fone,fax,email,cid,uf,logra,numero,complemento,bai,cep:String):String;
var
codcid,codigo:String;
codlog,codbai:variant;

begin

  NOME:=RetiraChar(NOME,'''');
  QVerifica.close;
  QVerifica.sql.Clear;
  QVerifica.sql.add('SELECT * FROM GR_CONTRIBUINTES WHERE COD_EMP_CNT=1 AND UPPER(NOME_CNT) = '''+UPPERCASE(NOME)+'''');
  QVerifica.Open;
  IF QVerifica.IsEmpty then
  begin
   QVerifica.close;
   QVerifica.sql.Clear;
   QVerifica.sql.add('select CAST(MAX(COD_CNT) AS INTEGER) CODIGO FROM GR_CONTRIBUINTES WHERE COD_EMP_CNT=1');
   QVerifica.Open;
   codigo:=IntToStr(QVerifica.fieldByName('CODIGO').AsInteger+1);



   if trim(logra)<>'' then
   begin
    QVerifica.close;
    QVerifica.sql.Clear;
    QVerifica.sql.add('SELECT * FROM GR_LOGRA WHERE COD_EMP_LOG=1 AND COD_LOG='+logra);
    QVerifica.Open;
    if not QVerifica.IsEmpty then
    begin
    codlog:=QVerifica.fieldByName('cod_log').AsString;
    logra:=QVerifica.fieldByName('nome_log').AsString;
    end
    else
    begin
    codlog:='0';
    logra:='';
    end;

   end
   else
   begin
   codlog:='0';
   logra:='';
   end;



   if trim(bai)<>'' then
   begin
    QVerifica.close;
    QVerifica.sql.Clear;
    QVerifica.sql.add('SELECT * FROM GR_BAIRRO WHERE COD_EMP_BAI=1 AND COD_BAI='+bai);
    QVerifica.Open;
    if not QVerifica.IsEmpty then
    begin
    codbai:=QVerifica.fieldByName('cod_bai').AsString;
    bai:=QVerifica.fieldByName('nome_bai').AsString;
    end
    else
    begin
    codbai:='0';
    bai:='';
    end;

   end
   else
   begin
   codbai:='0';
   bai:='';
   end;

   if trim(cep)='' then
   cep:='68900000';

   if trim(cid)='' then
   BEGIN
    cid:='MACAPA';
    UF:='AP';
   END;

   codcid:=cidade(cid,uf);

   QDestino.close;
   QDestino.sql.Clear;
   QDestino.sql.add('INSERT INTO GR_CONTRIBUINTES (COD_EMP_CNT,COD_CNT,NOME_CNT,RG_CNT,CNPJ_CNT, '+
   ' FAX_CNT,FONE_CNT,EMAIL_CNT,COD_LOG_CNT,COD_BAI_CNT,COD_CID_CNT,NUMERO_CNT,CEP_CNT,COMPLE_CNT, '+
   ' LOGIN_INC_CNT,DTA_INC_CNT,NOM_LOG_CNT,NOM_BAI_CNT) VALUES ('+
                     '1,'+
                     ''''+ZeraEsquerda(9,codigo)+''','+
                     ''''+copy(NOME,1,60)+''','+
                     ''''+TiraCaracter(RG)+''','+
                     ''''+TiraCaracter(CNPJ)+''','+
                     ''''+TiraCaracter(FAX)+''','+
                     ''''+TiraCaracter(FONE)+''','+
                     ''''+EMAIL+''','+
                     codlog+','+
                     codbai+','+
                     ''''+codcid+''','+
                     ''''+NUMERO+''','+
                     ''''+TiraCaracter(CEP)+''','+
                     ''''+copy(trim(RetiraChar(COMPLEMENTO,'''')),1,30)+''','+
                     '''CONVERSAO'','+
                     ''''+FormatDateTime('mm/dd/yyyy',date)+''','+
                     ''''+COPY(TRIM(RetiraChar(logra,'''')),1,60)+''','+
                     ''''+COPY(TRIM(RetiraChar(bai,'''')),1,60)+''''+
                    ')');
   QDestino.execsql;

  end
  else
  begin
   codigo:=QVerifica.fieldByName('COD_CNT').AsString;
  end;

   result:=ZeraEsquerda(9,codigo);

end;


Function TFPrincipal.TiraCaracter(s: String): variant;
{ Filtra uma string qualquer, convertendo as suas partes
  numéricas para sua representação decimal, por exemplo:
  'R$ 1.200,00' para 1200,00 '1AB34TZ' para 134}
Var
  i: Integer;
  t: String;
  SeenDecimal, SeenSgn: Boolean;
Begin
  t := '';
  SeenDecimal := False;
  SeenSgn := False;
  if Length(s) <= 0 then
  begin
  result:='';
  exit;
  end;

  {Percorre os caracteres da string:}
  For i := Length(s) Downto 0 Do
  {Filtra a string, aceitando somente números e separador decimal:}
    If (s[i] In ['0'..'9', '-', '+', DecimalSeparator]) Then Begin
      If (s[i] = DecimalSeparator) And (Not SeenDecimal) Then Begin
        t := s[i] + t;
        SeenDecimal := True;
      End
      Else If (s[i] In ['+', '-']) And (Not SeenSgn) And (i = 1) Then Begin
        t := s[i] + t;
        SeenSgn := True;
      End
      Else If s[i] In ['0'..'9'] Then Begin
        t := s[i] + t;
      End;
    End;
  Result := t;
End;


Function TFPrincipal.Replace(Str: String; Lixo: String; Certo: String): String;
Var
 I : Integer;
 retorno: String;
Begin
  I := 1;
  retorno := '';
  If Str <> '' Then
  Begin
    While (I <= Length(Str)) Do
    Begin
      If Copy(str,I,1) = Lixo Then
        retorno := retorno + certo
      Else
        retorno := retorno+Copy(str,I,1);
      I := I + 1;
    End;
  End;
  result := retorno;
End;



Function TFPrincipal.TrataDadosFinanceiro(Valor : Variant) : string;
var rec : string;
begin

 rec := vartostr(Valor);
 if (VarType(Valor) = varDate)  then
 rec := formatdatetime('DD.MM.YYYY',Valor);

 if (VarType(Valor) = varDouble) or (VarType(Valor) = varCurrency) then rec := replace(Valor,',','.');
 if trim(rec) = '' then rec := 'NULL'
 else rec := ''''+ rec +'''';

 Result := rec;
end;




procedure TFPrincipal.Indices;
 var cont,erros:Integer;
begin


    QOrigem.close;
    QOrigem.sql.clear;
    QOrigem.sql.add('select * from TRIUFM');
    QOrigem.open;

    while not QOrigem.eof do
    begin

        cdsdestino.close;
        sqlDestino.commandText:='select * from GR_INDICE WHERE COD_IND='+QOrigem.fieldByName('UFM_S_TIP').AsString;
        cdsdestino.open;

        if cdsdestino.IsEmpty then
         cdsdestino.append
        else
         cdsdestino.edit;

        cdsdestino.FieldByName('COD_EMP_IND').AsInteger:=1;
        cdsdestino.FieldByName('COD_IND').AsInteger:=QOrigem.fieldByName('UFM_S_TIP').AsInteger;
        cdsdestino.FieldByName('DESCRI_IND').AsString:=QOrigem.fieldByName('UFM_A_DES').AsString;

        Erros:=0;
        if not Conexao.InTransaction then Conexao.StartTransaction(TD);

        if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
        if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

        if Erros = 0 then Conexao.Commit(TD)
        else begin
          Conexao.Rollback(TD);
          exit;
        end;
    QOrigem.next;
    end;

    QOrigem.close;
    QOrigem.sql.clear;
    QOrigem.sql.add('select * from TRIUFM2');
    QOrigem.open;
    while not QOrigem.eof do
    begin

        cdsdestino.close;
        sqlDestino.commandText:='select * from GR_INDICEDESDO '+
        ' WHERE COD_IND_IDO='+QOrigem.fieldByName('UFM_S_TIP').AsString+' AND DATA_IDO='''+InverteData(QOrigem.fieldByName('UFM_D_REF').AsString)+'''';
        cdsdestino.open;

        if cdsdestino.IsEmpty then
         cdsdestino.append
        else
         cdsdestino.edit;

        cdsdestino.FieldByName('COD_EMP_IDO').AsInteger:=1;
        cdsdestino.FieldByName('COD_IND_IDO').AsInteger:=QOrigem.fieldByName('UFM_S_TIP').AsInteger;
        cdsdestino.FieldByName('VRINDICE_IDO').AsCurrency:=QOrigem.fieldByName('UFM_N_VAL').AsCurrency;
        cdsdestino.FieldByName('DATA_IDO').AsString:=QOrigem.fieldByName('UFM_D_REF').AsString;

        Erros:=0;
        if not Conexao.InTransaction then Conexao.StartTransaction(TD);

        if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
        if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

        if Erros = 0 then Conexao.Commit(TD)
        else begin
          Conexao.Rollback(TD);
          exit;
        end;

    QOrigem.next;
    end;


end;





procedure TFPrincipal.modulo;
 var cont,modulo,erros:Integer;
begin


        cdsdestino.close;
        sqlDestino.commandText:='select * from FI_MODULO where cod_mod=1';
        cdsdestino.open;

        if cdsdestino.IsEmpty then
        cdsdestino.append
        else
        cdsdestino.edit;

        cdsdestino.FieldByName('cod_emp_mod').AsInteger:=1;
        cdsdestino.FieldByName('cod_mod').AsInteger:=1;
        cdsdestino.FieldByName('descricao_mod').AsString:='IMOBILIÁRIO';


        Erros:=0;
        if not Conexao.InTransaction then Conexao.StartTransaction(TD);

        if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
        if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

        if Erros = 0 then Conexao.Commit(TD)
        else begin
          Conexao.Rollback(TD);
          exit;
        end;



        cdsdestino.close;
        sqlDestino.commandText:='select * from FI_MODULO where cod_mod=2';
        cdsdestino.open;

        if cdsdestino.IsEmpty then
        cdsdestino.append
        else
        cdsdestino.edit;

        cdsdestino.FieldByName('cod_emp_mod').AsInteger:=1;
        cdsdestino.FieldByName('cod_mod').AsInteger:=2;
        cdsdestino.FieldByName('descricao_mod').AsString:='MOBILIÁRIO';


        Erros:=0;
        if not Conexao.InTransaction then Conexao.StartTransaction(TD);

        if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
        if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

        if Erros = 0 then Conexao.Commit(TD)
        else begin
          Conexao.Rollback(TD);
          exit;
        end;

        cdsdestino.close;
        sqlDestino.commandText:='select * from FI_MODULO where cod_mod=3';
        cdsdestino.open;

        if cdsdestino.IsEmpty then
        cdsdestino.append
        else
        cdsdestino.edit;

        cdsdestino.FieldByName('cod_emp_mod').AsInteger:=1;
        cdsdestino.FieldByName('cod_mod').AsInteger:=3;
        cdsdestino.FieldByName('descricao_mod').AsString:='AGUA E ESGOTO';


        Erros:=0;
        if not Conexao.InTransaction then Conexao.StartTransaction(TD);

        if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
        if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

        if Erros = 0 then Conexao.Commit(TD)
        else begin
          Conexao.Rollback(TD);
          exit;
        end;


        cdsdestino.close;
        sqlDestino.commandText:='select * from FI_MODULO where cod_mod=5';
        cdsdestino.open;

        if cdsdestino.IsEmpty then
        cdsdestino.append
        else
        cdsdestino.edit;

        cdsdestino.FieldByName('cod_emp_mod').AsInteger:=1;
        cdsdestino.FieldByName('cod_mod').AsInteger:=5;
        cdsdestino.FieldByName('descricao_mod').AsString:='CONTRIBUINTES';


        Erros:=0;
        if not Conexao.InTransaction then Conexao.StartTransaction(TD);

        if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
        if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

        if Erros = 0 then Conexao.Commit(TD)
        else begin
          Conexao.Rollback(TD);
          exit;
        end;

        cdsdestino.close;
        sqlDestino.commandText:='select * from FI_MODULO where cod_mod=4';
        cdsdestino.open;

        if cdsdestino.IsEmpty then
        cdsdestino.append
        else
        cdsdestino.edit;

        cdsdestino.FieldByName('cod_emp_mod').AsInteger:=1;
        cdsdestino.FieldByName('cod_mod').AsInteger:=4;
        cdsdestino.FieldByName('descricao_mod').AsString:='IMOBILIÁRIO RURAL';


        Erros:=0;
        if not Conexao.InTransaction then Conexao.StartTransaction(TD);

        if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
        if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

        if Erros = 0 then Conexao.Commit(TD)
        else begin
          Conexao.Rollback(TD);
          exit;
        end;


end;


procedure TFPrincipal.bancos;
 var cont,nbanco,erros:Integer;
begin

    QOrigem.Close;
    QOrigem.sql.clear;
    QOrigem.SQL.add('select * from ASP02_TRIBAN ');
    QOrigem.open;

    QVerifica.close;
    QVerifica.sql.clear;
    QVerifica.sql.add('SELECT CAST(MAX(COD_BCO) AS INTEGER) as cod FROM GR_BANCO ');
    QVerifica.Open;
    nBanco:=QVerifica.fieldByName('cod').AsInteger+1;


    while not QOrigem.eof do
    begin

        cdsdestino.close;
        sqlDestino.commandText:='select * from GR_BANCO where BANCO_BCO='''+ZeraEsquerda(3,QOrigem.fieldByName('BAN_I_COD').AsString)+''' ';
        cdsdestino.open;
        if cdsdestino.IsEmpty then
        begin
        cdsdestino.append;
        cdsdestino.FieldByName('COD_bco').AsString:=ZeraEsquerda(3,QOrigem.fieldByName('BAN_I_COD').AsString);
        nbanco:=nbanco+1;
        end
        else
        cdsdestino.edit;
        cdsdestino.FieldByName('cod_emp_bco').AsInteger:=1;
        cdsdestino.FieldByName('banco_bco').AsString:=ZeraEsquerda(3,QOrigem.fieldByName('BAN_I_COD').AsString);
        cdsdestino.FieldByName('nome_bco').AsString:=QOrigem.fieldByName('BAN_A_NOM').AsString;
        Erros:=0;
        if not Conexao.InTransaction then Conexao.StartTransaction(TD);

        if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
        if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

        if Erros = 0 then Conexao.Commit(TD)
        else begin
          Conexao.Rollback(TD);
          exit;
        end;


     QOrigem.Next;
    end;




end;


procedure TFPrincipal.lotes;
 var cont,nbanco,erros:Integer;
begin

    QOrigem.Close;
    QOrigem.sql.clear;
    QOrigem.SQL.add('SELECT DISTINCT LOT_A_NUM FROM TRILOTE ');
    QOrigem.open;
    nBanco:=1;
    while not QOrigem.eof do
    begin

        cdsdestino.close;
        sqlDestino.commandText:='select * from FI_LOTE where COD_LTE='+QOrigem.fieldByName('LOT_A_NUM').AsString;
        cdsdestino.open;
        if cdsdestino.IsEmpty then
        cdsdestino.append
        else
        cdsdestino.edit;
        cdsdestino.FieldByName('COD_EMP_LTE').AsInteger:=1;
        cdsdestino.FieldByName('COD_LTE').AsString:=QOrigem.fieldByName('LOT_A_NUM').AsString;
        Erros:=0;
        if not Conexao.InTransaction then Conexao.StartTransaction(TD);

        if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
        if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

        if Erros = 0 then Conexao.Commit(TD)
        else begin
          Conexao.Rollback(TD);
          exit;
        end;


     QOrigem.Next;
    end;




end;







procedure TFPrincipal.Limpa;
begin


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('delete from fi_itensreceitas');
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('delete from fi_itens');
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('delete from fi_lancamento');
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('delete from fi_receitas');
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('delete from fi_parcela');
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('delete from fi_divida');
  QDestino.execsql;


  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('delete from fi_recprincipal');
  QDestino.execsql;

  QDestino.close;
  QDestino.sql.clear;
  QDestino.sql.add('delete from fi_modulo');
  QDestino.execsql;




end;

procedure TFPrincipal.receitaprincipal;
 var cont,modulo,princ,erros:Integer;
begin

    QOrigem.close;
    QOrigem.sql.clear;
    QOrigem.sql.add(' SELECT DISTINCT A.imp_i_cod,B.IMP_A_DES,A.IMP_A_NAT '+
                    ' FROM TRILANCA A '+
                    ' LEFT JOIN TRIIMP B ON A.IMP_I_COD=B.IMP_I_COD '
                    );
    QOrigem.open;
    while not QOrigem.eof do
    begin

     if QOrigem.fieldByName('IMP_A_NAT').AsString='1' then
     modulo:=1
     else
     if QOrigem.fieldByName('IMP_A_NAT').AsString='2' then
     modulo:=4
     else
     if QOrigem.fieldByName('IMP_A_NAT').AsString='3' then
     modulo:=2
     else
     modulo:=5;




    TRY

      cdsdestino.close;
      sqlDestino.commandText:='select * from FI_RECPRINCIPAL where cod_mod_rep='+IntToStr(modulo)+' and cod_rep='+QOrigem.fieldByName('IMP_I_COD').AsString;
      cdsdestino.open;
      if cdsdestino.IsEmpty then
      cdsdestino.append
      else
      cdsdestino.edit;

      cdsdestino.FieldByName('cod_emp_rep').AsInteger:=1;
      cdsdestino.FieldByName('cod_mod_rep').AsInteger:=modulo;
      cdsdestino.FieldByName('cod_rep').AsInteger:=QOrigem.fieldByName('imp_i_cod').AsInteger;
      cdsdestino.FieldByName('descricao_rep').AsString:=QOrigem.fieldByName('IMP_A_DES').AsString;
      Erros:=0;
      if not Conexao.InTransaction then Conexao.StartTransaction(TD);

      if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
      if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

      if Erros = 0 then Conexao.Commit(TD)
      else begin
        Conexao.Rollback(TD);
        exit;
      end;
    EXCEPT
    cdsdestino.CancelUpdates;
    END;


    QOrigem.Next;
    end;


    QOrigem.close;
    QOrigem.sql.clear;
    QOrigem.sql.add(' SELECT DISTINCT A.imp_i_cod,B.IMP_A_DES,A.IMP_A_NAT '+
                    ' FROM TRILANCA_REPARCELAMENTO A '+
                    ' LEFT JOIN TRIIMP B ON A.IMP_I_COD=B.IMP_I_COD '
                    );
    QOrigem.open;
    while not QOrigem.eof do
    begin

     if QOrigem.fieldByName('IMP_A_NAT').AsString='1' then
     modulo:=1
     else
     if QOrigem.fieldByName('IMP_A_NAT').AsString='2' then
     modulo:=4
     else
     if QOrigem.fieldByName('IMP_A_NAT').AsString='3' then
     modulo:=2
     else
     modulo:=5;




    TRY

      cdsdestino.close;
      sqlDestino.commandText:='select * from FI_RECPRINCIPAL where cod_mod_rep='+IntToStr(modulo)+' and cod_rep='+QOrigem.fieldByName('IMP_I_COD').AsString;
      cdsdestino.open;
      if cdsdestino.IsEmpty then
      cdsdestino.append
      else
      cdsdestino.edit;

      cdsdestino.FieldByName('cod_emp_rep').AsInteger:=1;
      cdsdestino.FieldByName('cod_mod_rep').AsInteger:=modulo;
      cdsdestino.FieldByName('cod_rep').AsInteger:=QOrigem.fieldByName('imp_i_cod').AsInteger;
      cdsdestino.FieldByName('descricao_rep').AsString:=QOrigem.fieldByName('IMP_A_DES').AsString;
      Erros:=0;
      if not Conexao.InTransaction then Conexao.StartTransaction(TD);

      if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
      if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

      if Erros = 0 then Conexao.Commit(TD)
      else begin
        Conexao.Rollback(TD);
        exit;
      end;
    EXCEPT
    cdsdestino.CancelUpdates;
    END;


    QOrigem.Next;
    end;






end;











procedure TFPrincipal.Atividades;
 var cont,erros:Integer;
 receita:String;
begin

//    receita:='2';//iss
//    receita:='4';//Ambultante
//    receita:='8';//Taxi
//    receita:='3';//Taxa
//    receita:='9';//Tax2


    QOrigem.Close;
    QOrigem.sql.Clear;
    QOrigem.sql.add('SELECT * FROM CADTAB');
    QOrigem.Open;

    while not QOrigem.Eof do
    begin

      cdsdestino.close;
      sqlDestino.commandText:='select * from LI_ATIVIDADE where cod_emp_atv is null';
      cdsdestino.open;
      cdsdestino.append;
      cdsdestino.fieldByName('COD_EMP_ATV').AsString:='1';
      cdsdestino.fieldByName('TITULO_ATV').AsString:='N';
      cdsdestino.fieldByName('COD_ATV').AsString:=ZeraEsquerda(6,receita+QOrigem.fieldByname('codigo').AsString);
      cdsdestino.fieldByName('ATIVIDADE_ATV').AsString:=QOrigem.fieldByname('nome').AsString;

//      cdsdestino.fieldByName('TIPOATIVIDADE_ATV').AsString:='01 - Prestação de Servico';
//      cdsdestino.fieldByName('TIPOATIVIDADE_ATV').AsString:='02 - Licença';
//      cdsdestino.fieldByName('TIPOATIVIDADE_ATV').AsString:='03 - Ambulante';
      cdsdestino.fieldByName('TIPOATIVIDADE_ATV').AsString:='08 - Outros';
      cdsdestino.fieldByName('LOGIN_INC_ATV').AsString:='CONVERSAO';
      cdsdestino.fieldByName('DTA_INC_ATV').value:=date;
      Erros:=0;
      if not Conexao.InTransaction then Conexao.StartTransaction(TD);

      if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
      if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

      if Erros = 0 then Conexao.Commit(TD)
      else begin
        Conexao.Rollback(TD);
        exit;
      end;



      cdsdestino.close;
      sqlDestino.commandText:='select * from LI_ATIVDESDO where COD_EMP_ATD is null';
      cdsdestino.open;
      cdsdestino.append;
      cdsdestino.fieldByName('COD_EMP_ATD').AsString:='1';
      cdsdestino.fieldByName('COD_ATV_ATD').AsString:=ZeraEsquerda(6,receita+QOrigem.fieldByname('codigo').AsString);
      cdsdestino.fieldByName('COD_ATD').AsString:=ZeraEsquerda(7,'1');
      cdsdestino.fieldByName('COD_REP_ATD').AsString:=receita;
      cdsdestino.fieldByName('ABREVATIV_ATD').AsString:=QOrigem.fieldByname('nome').AsString;
      cdsdestino.fieldByName('LOGIN_INC_ATD').AsString:='CONVERSAO';
      cdsdestino.fieldByName('DTA_INC_ATD').value:=date;
      Erros:=0;
      if not Conexao.InTransaction then Conexao.StartTransaction(TD);

      if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
      if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

      if Erros = 0 then Conexao.Commit(TD)
      else begin
        Conexao.Rollback(TD);
        exit;
      end;



      cdsdestino.close;
      sqlDestino.commandText:='select * from LI_VALORATIVIDADE where COD_EMP_VRA is null';
      cdsdestino.open;
      cdsdestino.append;
      cdsdestino.fieldByName('COD_EMP_VRA').AsString:='1';
      cdsdestino.fieldByName('COD_SEQ_VRA').AsString:='1';
      cdsdestino.fieldByName('VINCULAREGIAO_VRA').AsString:='N';

      cdsdestino.fieldByName('VALOR_VRA').AsCurrency:=QOrigem.fieldByname('valor').AsCurrency;
      cdsdestino.fieldByName('COD_REC_VRA').AsString:=receita;


      cdsdestino.fieldByName('ISS_VRA').AsString:='N';
      cdsdestino.fieldByName('TXL_VRA').AsString:='S';
      cdsdestino.fieldByName('ANUAL_VRA').AsString:='S';
      cdsdestino.fieldByName('MENSAL_VRA').AsString:='N';
      cdsdestino.fieldByName('APDTABERT_VRA').AsString:='S';
      cdsdestino.fieldByName('COBABERT_VRA').AsString:='N';
      cdsdestino.fieldByName('TIPCALC_VRA').AsString:='01 - Valor Fixo';
      cdsdestino.fieldByName('TIPVALOR_VRA').AsString:='01 - Valor Real';

      cdsdestino.fieldByName('LIMITEI_VRA').AsString:='0';
      cdsdestino.fieldByName('LIMITEF_VRA').AsString:='9999999';
      cdsdestino.fieldByName('COD_ATV_VRA').AsString:=ZeraEsquerda(6,receita+QOrigem.fieldByname('codigo').AsString);
      cdsdestino.fieldByName('COD_ATD_VRA').AsString:=ZeraEsquerda(7,'1');
      cdsdestino.fieldByName('LOGIN_INC_VRA').AsString:='CONVERSAO';
      cdsdestino.fieldByName('DTA_INC_VRA').value:=date;
      Erros:=0;
      if not Conexao.InTransaction then Conexao.StartTransaction(TD);

      if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
      if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

      if Erros = 0 then Conexao.Commit(TD)
      else begin
        Conexao.Rollback(TD);
        exit;
      end;



     QOrigem.Next;
    end;

end;

procedure TFPrincipal.mobiliario;
 var cont,erros:Integer;
 tipoempresa,receita,situacao:String;
begin

//    tipoempresa:='1';//iss
//    tipoempresa:='2';//Ambultante
//    tipoempresa:='3';//Taxi
//    tipoempresa:='4';//Taxa
//    tipoempresa:='5';//Tax2

//    receita:='2';//iss
//    receita:='4';//Ambultante
//    receita:='8';//Taxi
//    receita:='3';//Taxa
//    receita:='9';//Tax2



    QOrigem.Close;
    QOrigem.sql.Clear;
    QOrigem.sql.add('SELECT * FROM CADCONT ');
    QOrigem.Open;

    cdsdestino.close;
    sqlDestino.commandText:='SELECT * FROM LI_MOBIL ';
    cdsdestino.open;


    while not QOrigem.Eof do
    begin
    label5.caption:=ZeraEsquerda(6,QOrigem.fieldByname('codigo').AsString);
    label5.update;



      cdsdestino.append;
      cdsdestino.fieldByName('COD_EMP_MBL').AsString:='1';
      cdsdestino.fieldByName('COD_STR_MBL').AsString:='1';
      cdsdestino.fieldByName('COD_TPC_MBL').value:=TIPOEMPRESA;
      cdsdestino.fieldByName('COD_TEM_MBL').value:='1';
      cdsdestino.fieldByName('COD_MBL').AsString:=receita+'.'+QOrigem.fieldByname('codigo').AsString;
      cdsdestino.fieldByName('INSCRE_MBL').AsString:=QOrigem.fieldByname('INSC_EST').AsString;
      cdsdestino.fieldByName('INSCRM_MBL').AsString:=QOrigem.fieldByname('INSCRICAO_MUNICIPAL').AsString;
      cdsdestino.fieldByName('DTABER_MBL').AsString:=QOrigem.fieldByname('DATA_ABERTURA').AsString;
      cdsdestino.fieldByName('DTENCE_MBL').AsString:=QOrigem.fieldByname('DATA_ENCERRAMENTO').AsString;
      cdsdestino.fieldByName('HORI_MBL').AsString:=QOrigem.fieldByname('horario1').AsString;
      cdsdestino.fieldByName('HORF_MBL').AsString:=QOrigem.fieldByname('horario2').AsString;
      cdsdestino.fieldByName('COD_CNT_MBL').AsString:=Contribuintes(RetiraChar(QOrigem.fieldByname('nome').AsString,''''),
                                                                    QOrigem.fieldByname('insc_est').AsString,
                                                                    QOrigem.fieldByname('cgc').AsString,
                                                                    QOrigem.fieldByname('fone').AsString,
                                                                    '',//fax
                                                                    '',//email
                                                                    QOrigem.fieldByname('cidade').AsString,
                                                                    QOrigem.fieldByname('sigla').AsString,
                                                                    QOrigem.fieldByname('endereco').AsString,
                                                                    QOrigem.fieldByname('numero').AsString,
                                                                    '',//complemento
                                                                    'CENTRO',//BAIRRO
                                                                    QOrigem.fieldByname('CEP').AsString
                                                                    );

      ////////////////////////ENDEREÇO/////////////////////////
      cdsdestino.fieldByName('COD_LOG_MBL').AsString:=logradouro(QOrigem.fieldByname('endereco').AsString,QOrigem.fieldByname('cep').AsString);
      cdsdestino.fieldByName('COD_BAI_MBL').AsString:=bairro('CENTRO');
      cdsdestino.fieldByName('COD_CID_MBL').AsString:=cidade(QOrigem.fieldByname('cidade').AsString,QOrigem.fieldByname('sigla').AsString);
      cdsdestino.fieldByName('NUMERO_MBL').AsString:=QOrigem.fieldByname('numero').AsString;
      cdsdestino.fieldByName('CEPI_MBL').AsString:=TiraCaracter(QOrigem.fieldByname('cep').AsString);
      /////////////////////////////////////////////////////////


      ////////////////////////ENDEREÇO DE CORRESPONDENCIA/////////////////////////
      cdsdestino.fieldByName('COD_LOGE_MBL').AsString:=logradouro(QOrigem.fieldByname('endereco').AsString,QOrigem.fieldByname('cep').AsString);
      cdsdestino.fieldByName('COD_BAIE_MBL').AsString:=bairro('CENTRO');
      cdsdestino.fieldByName('COD_CID_MBL').AsString:=cidade(QOrigem.fieldByname('cidade').AsString,QOrigem.fieldByname('sigla').AsString);
      cdsdestino.fieldByName('NUMEROE_MBL').AsString:=QOrigem.fieldByname('numero').AsString;
      cdsdestino.fieldByName('CEPE_MBL').AsString:=TiraCaracter(QOrigem.fieldByname('cep').AsString);

      QVerifica.close;
      QVerifica.sql.Clear;
      QVerifica.sql.add('SELECT * FROM GR_LOGRA WHERE COD_LOG='+cdsdestino.fieldByName('COD_LOGE_MBL').AsString);
      QVerifica.open;
      cdsdestino.fieldByName('LOGRA_MBL').AsString:=QVerifica.fieldByName('NOME_LOG').AsString;

      QVerifica.close;
      QVerifica.sql.Clear;
      QVerifica.sql.add('SELECT * FROM GR_BAIRRO WHERE COD_BAI='+cdsdestino.fieldByName('COD_BAIE_MBL').AsString);
      QVerifica.open;
      cdsdestino.fieldByName('BAIRRO_MBL').AsString:=QVerifica.fieldByName('NOME_BAI').AsString;

      /////////////////////////////////////////////////////////

      cdsdestino.fieldByName('LOGIN_INC_MBL').AsString:='CONVERSAO';
      cdsdestino.fieldByName('DTA_INC_MBL').value:=date;

      IF cdsdestino.fieldByName('DTENCE_MBL').value=NULL THEN
      cdsdestino.fieldByName('SITUACAO_MBL').value:='01 - Normal'
      else
      cdsdestino.fieldByName('SITUACAO_MBL').value:='03 - Cancelado';


      if QOrigem.fieldByname('isencao').AsString='N' then
      situacao:='1'
      else
      situacao:='2';

      Erros:=0;
      if not Conexao.InTransaction then Conexao.StartTransaction(TD);

      if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
      if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

      if Erros = 0 then Conexao.Commit(TD)
      else begin
        Conexao.Rollback(TD);
        exit;
      end;


    QVerifica.close;
    QVerifica.sql.clear;
    QVerifica.sql.add('SELECT * FROM LI_ATIVIDADE WHERE COD_ATV='''+ZeraEsquerda(6,receita+QOrigem.fieldByName('atividade').AsString)+'''');
    QVerifica.open;
    if not QVerifica.IsEmpty then
    begin
      QDestino.close;
      QDestino.sql.clear;
      QDestino.sql.add('INSERT INTO LI_CADATIV(COD_EMP_CTV,COD_ATV_CTV,COD_ATD_CTV,COD_COB_CTV,COD_MBL_CTV) '+
                        ' VALUES ( '+
                        '1,'+
                        ''''+ZeraEsquerda(6,receita+QOrigem.fieldByName('atividade').AsString)+''','+
                        '''0000001'','+
                        situacao+','+
                        ''''+cdsDestino.fieldByName('cod_mbl').AsString+''''+
                        ')'
                        );
      QDestino.execsql;
    end;


     QOrigem.Next;
    end;

end;




procedure TFPrincipal.receitas;
 var cont,modulo,erros:Integer;
begin

 QOrigem.close;
 QOrigem.sql.clear;
 QOrigem.sql.add('select * from TRITAX ');
 QOrigem.open;

 cont:=1;
  while not QOrigem.eof do
  begin

    cdsdestino.close;
    sqlDestino.commandText:='select * from GR_RECEITA where cod_rec='+QOrigem.fieldByName('TAX_I_COD').AsString;
    cdsdestino.open;

    if cdsdestino.IsEmpty then
    cdsdestino.append
    else
    cdsdestino.edit;

    cdsdestino.FieldByName('cod_emp_rec').AsInteger:=1;
    cdsdestino.FieldByName('cod_rec').AsString:=QOrigem.fieldByName('TAX_I_COD').AsString;
    cdsdestino.FieldByName('descri_rec').AsString:=QOrigem.FieldByName('TAX_A_DES').AsString;
    cdsdestino.FieldByName('abrev_rec').AsString:=QOrigem.FieldByName('TAX_A_ABR').AsString;
    Erros:=0;
    if not Conexao.InTransaction then Conexao.StartTransaction(TD);

    if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
    if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

    if Erros = 0 then Conexao.Commit(TD)
    else begin
      Conexao.Rollback(TD);
      exit;
    end;

   cont:=cont+1;
   QOrigem.next;
  end;

   {

    cdsdestino.close;
    sqlDestino.commandText:='select * from GR_RECEITA where cod_rec=15';
    cdsdestino.open;

    if cdsdestino.IsEmpty then
    cdsdestino.append
    else
    cdsdestino.edit;

    cdsdestino.FieldByName('cod_emp_rec').AsInteger:=1;
    cdsdestino.FieldByName('cod_rec').AsString:='15';
    cdsdestino.FieldByName('descri_rec').AsString:='';
    cdsdestino.FieldByName('abrev_rec').AsString:='';
    cdsdestino.FieldByName('sigla_rec').AsString:='';

    Erros:=0;
    if not Conexao.InTransaction then Conexao.StartTransaction(TD);

    if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
    if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

    if Erros = 0 then Conexao.Commit(TD)
    else begin
      Conexao.Rollback(TD);
      exit;
    end;

    cdsdestino.close;
    sqlDestino.commandText:='select * from GR_RECEITA where cod_rec=13';
    cdsdestino.open;

    if cdsdestino.IsEmpty then
    cdsdestino.append
    else
    cdsdestino.edit;

    cdsdestino.FieldByName('cod_emp_rec').AsInteger:=1;
    cdsdestino.FieldByName('cod_rec').AsString:='13';
    cdsdestino.FieldByName('descri_rec').AsString:='';
    cdsdestino.FieldByName('abrev_rec').AsString:='';
    cdsdestino.FieldByName('sigla_rec').AsString:='';

    Erros:=0;
    if not Conexao.InTransaction then Conexao.StartTransaction(TD);

    if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
    if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

    if Erros = 0 then Conexao.Commit(TD)
    else begin
      Conexao.Rollback(TD);
      exit;
    end;


    cdsdestino.close;
    sqlDestino.commandText:='select * from GR_RECEITA where cod_rec=148';
    cdsdestino.open;

    if cdsdestino.IsEmpty then
    cdsdestino.append
    else
    cdsdestino.edit;

    cdsdestino.FieldByName('cod_emp_rec').AsInteger:=1;
    cdsdestino.FieldByName('cod_rec').AsString:='148';
    cdsdestino.FieldByName('descri_rec').AsString:='';
    cdsdestino.FieldByName('abrev_rec').AsString:='';
    cdsdestino.FieldByName('sigla_rec').AsString:='';

    Erros:=0;
    if not Conexao.InTransaction then Conexao.StartTransaction(TD);

    if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
    if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

    if Erros = 0 then Conexao.Commit(TD)
    else begin
      Conexao.Rollback(TD);
      exit;
    end;

    }


end;


procedure TFPrincipal.outrasreceitas;
 var cont,modulo,erros:Integer;
begin

 QOrigem.close;
 QOrigem.sql.clear;
 QOrigem.sql.add('select * from receita');
 QOrigem.open;

 cont:=1;
  while not QOrigem.eof do
  begin

    cdsdestino.close;
    sqlDestino.commandText:='select * from FI_OUTRASRECEITAS WHERE COD_EMP_CUS IS NULL';
    cdsdestino.open;

    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_cus').AsInteger:=1;
    cdsdestino.FieldByName('cod_rec_cus').AsInteger:=QOrigem.fieldByName('cod_rec').AsInteger;
    cdsdestino.FieldByName('incmulta_cus').AsString:=QOrigem.FieldByName('incmulta').AsString;
    cdsdestino.FieldByName('incjuros_cus').AsString:=QOrigem.FieldByName('incjuros').AsString;
    cdsdestino.FieldByName('inccorre_cus').AsString:=QOrigem.FieldByName('inccorre').AsString;
    cdsdestino.FieldByName('tpcalculo_cus').AsString:='01 - Porcentagem';
    cdsdestino.FieldByName('valor_cus').AsString:=QOrigem.FieldByName('di_valor').AsString;
    cdsdestino.FieldByName('tpcobranca_cus').AsString:='01 - Apenas nas Dívida Executada';
    cdsdestino.FieldByName('tp_cus').AsString:='01 - Honorários';
    cdsdestino.FieldByName('ondecobra_cus').AsString:='';
    cdsdestino.FieldByName('LOGIN_INC_CUS').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_CUS').value:=date;


    cdsdestino.append;
    cdsdestino.FieldByName('cod_emp_cus').AsInteger:=1;
    cdsdestino.FieldByName('cod_rec_cus').AsInteger:=QOrigem.fieldByName('cod_rec1').AsInteger;
    cdsdestino.FieldByName('incmulta_cus').AsString:=QOrigem.FieldByName('incmulta').AsString;
    cdsdestino.FieldByName('incjuros_cus').AsString:=QOrigem.FieldByName('incjuros').AsString;
    cdsdestino.FieldByName('inccorre_cus').AsString:=QOrigem.FieldByName('inccorre').AsString;
    cdsdestino.FieldByName('tpcalculo_cus').AsString:='02 - Valor Fixo';
    cdsdestino.FieldByName('valor_cus').AsString:='1';
    cdsdestino.FieldByName('tpcobranca_cus').AsString:='01 - Apenas nas Dívida Executada';
    cdsdestino.FieldByName('tp_cus').AsString:='02 - Outras Custas';
    cdsdestino.FieldByName('ondecobra_cus').AsString:='';
    cdsdestino.FieldByName('LOGIN_INC_CUS').AsString:='CONVERSAO';
    cdsdestino.FieldByName('DTA_INC_CUS').value:=date;


    Erros:=0;
    if not Conexao.InTransaction then Conexao.StartTransaction(TD);

    if cdsdestino.State in [dsEdit, dsInsert] then cdsdestino.Post;
    if cdsdestino.ChangeCount > 0 then Erros := cdsdestino.ApplyUpdates(-1);

    if Erros = 0 then Conexao.Commit(TD)
    else begin
      Conexao.Rollback(TD);
      exit;
    end;



   cont:=cont+1;
   QOrigem.next;
  end;

end;



procedure TFPrincipal.guias;
 var cont,modulo,erros,recprincipal,coddiv:Integer;
 origem,cadastro,contrib,cadpesquisa,cgc,parcelamento:String;
 matricula,dtcadastro,codruae,codbaie,codlog,codbai:Variant;
begin
   {
      "1" imobiliario
      "2" rural
      "3" economico
      "4" contribuinte
   
    }

 QOrigem.close;
 QOrigem.sql.clear;
 QOrigem.sql.add('SELECT * FROM TRILANCA ');
 QOrigem.open;
 progressBar1.Max:=QOrigem.RecordCount;

 label4.Caption:=IntToStr(ProgressBar1.max);
 label4.Update;


 cont:=1;
 coddiv:=0;
  while not QOrigem.eof do
  begin

  label1.Caption:=IntToStr(cont);
  label1.Update;

  ProgressBar1.Position:=cont;

   label5.Caption:=QOrigem.fieldByName('inscricao').value;
   label5.Update;

   if QOrigem.fieldByName('IMP_A_NAT').AsString='1' then
    modulo:=1
   else
   if QOrigem.fieldByName('IMP_A_NAT').AsString='3' then
    modulo:=2
   else
   if QOrigem.fieldByName('IMP_A_NAT').AsString='2' then
    modulo:=4
   else
    modulo:=5;


   contrib:=ZeraEsquerda(9,QOrigem.fieldByName('CNTI_I_CON').AsString);
   parcelamento:='N';
   recprincipal:=QOrigem.fieldByName('IMP_I_COD').AsInteger;

   if parcelamento='S' then
     Origem:='03 - Dívida Parcelada'
   else
   begin
     if QOrigem.fieldByName('par_s_ano').AsString='2011' then
     Origem:='01 - Dívida do Exercício'
     else
     Origem:='02 - Dívida Ativa';
   end;

   cadastro:=ZeraEsquerda(9,QOrigem.fieldByName('inscricao').AsString);
   coddiv:=QOrigem.fieldByName('par_n_seq').AsInteger;
   matricula:=ZeraEsquerda(9,QOrigem.fieldByName('inscricao').AsString);
   codruae:=null;
   codbaie:=null;
   QDestino.close;
   QDestino.sql.clear;
   QDestino.sql.add('INSERT INTO FI_DIVIDA(COD_EMP_DIV,COD_DIV,COD_MOD_DIV, '+
                    ' COD_REP_DIV,ANO_DIV,ANOREF_DIV,DATACADAST_DIV,ORIGEM_DIV, '+
                    ' COD_CNT_DIV,CODC_CNT_DIV,COD_CAD_DIV,MATRICULA_DIV,'+
                    ' LOGIN_INC_DIV,DTA_INC_DIV '+
                    ') '+
                    'VALUES( '+
                    '1,'+
                    IntToStr(coddiv)+','+
                    IntToStr(modulo)+','+
                    IntToStr(recprincipal)+','+
                    ''''+QOrigem.fieldByName('par_s_ano').AsString+''','+
                    ''''+QOrigem.fieldByName('par_s_ano').AsString+''','+
                    ''''+formatDateTime('mm/dd/YYYY',QOrigem.fieldByName('par_d_lan').AsDateTime)+''','+
                    ''''+Origem+''','+
                    TrataDadosFinanceiro(contrib)+','+
                    TrataDadosFinanceiro(contrib)+','+
                    ''''+cadastro+''','+
                    TrataDadosFinanceiro(matricula)+','+
                    '''DIVIDA'','+
                    ''''+formatDateTime('mm/dd/YYYY',DATE)+''''+
                    ')'
                    );
   QDestino.ExecSQL();




   cont:=cont+1;
   QOrigem.next;
  end;

end;




procedure TFPrincipal.guiasParcelamento;
 var cont,modulo,erros,recprincipal,coddiv:Integer;
 origem,cadastro,contrib,cadpesquisa,cgc,parcelamento:String;
 matricula,dtcadastro,codruae,codbaie,codlog,codbai:Variant;
begin


 QOrigem.close;
 QOrigem.sql.clear;
 QOrigem.sql.add('SELECT * FROM TRILANCA_REPARCELAMENTO ORDER BY rep_n_cod ');
 QOrigem.open;
 progressBar1.Max:=QOrigem.RecordCount;

 label4.Caption:=IntToStr(ProgressBar1.max);
 label4.Update;


  cont:=1;

  QVerifica.close;
  QVerifica.sql.clear;
  QVerifica.sql.add('SELECT MAX(CAST(COD_DIV AS INTEGER)) COD FROM FI_DIVIDA');
  QVerifica.open;
  coddiv:=QVerifica.fieldByName('cod').AsInteger;

  while not QOrigem.eof do
  begin

  label1.Caption:=IntToStr(cont);
  label1.Update;

  ProgressBar1.Position:=cont;

   label5.Caption:=QOrigem.fieldByName('inscricao').value;
   label5.Update;

   if QOrigem.fieldByName('IMP_A_NAT').AsString='1' then
    modulo:=1
   else
   if QOrigem.fieldByName('IMP_A_NAT').AsString='3' then
    modulo:=2
   else
   if QOrigem.fieldByName('IMP_A_NAT').AsString='2' then
    modulo:=4
   else
    modulo:=5;


   contrib:=ZeraEsquerda(9,QOrigem.fieldByName('CNTI_I_CON').AsString);
   parcelamento:='S';
   recprincipal:=QOrigem.fieldByName('IMP_I_COD').AsInteger;
   Origem:='03 - Dívida Parcelada';

   cadastro:=ZeraEsquerda(9,QOrigem.fieldByName('inscricao').AsString);
   coddiv:=coddiv+1;
   matricula:=ZeraEsquerda(9,QOrigem.fieldByName('inscricao').AsString);
   codruae:=null;
   codbaie:=null;
   QDestino.close;
   QDestino.sql.clear;
   QDestino.sql.add('INSERT INTO FI_DIVIDA(COD_EMP_DIV,COD_DIV,COD_MOD_DIV, '+
                    ' COD_REP_DIV,ANO_DIV,ANOREF_DIV,DATACADAST_DIV,ORIGEM_DIV, '+
                    ' COD_CNT_DIV,CODC_CNT_DIV,COD_CAD_DIV,MATRICULA_DIV,ANO_STR_DIV,'+
                    ' LOGIN_INC_DIV,DTA_INC_DIV '+
                    ') '+
                    'VALUES( '+
                    '1,'+
                    IntToStr(coddiv)+','+
                    IntToStr(modulo)+','+
                    IntToStr(recprincipal)+','+
                    ''''+QOrigem.fieldByName('par_s_ano').AsString+''','+
                    ''''+QOrigem.fieldByName('par_s_ano').AsString+''','+
                    ''''+formatDateTime('mm/dd/YYYY',QOrigem.fieldByName('par_d_lan').AsDateTime)+''','+
                    ''''+Origem+''','+
                    TrataDadosFinanceiro(contrib)+','+
                    TrataDadosFinanceiro(contrib)+','+
                    ''''+cadastro+''','+
                    TrataDadosFinanceiro(matricula)+','+
                    TrataDadosFinanceiro(QOrigem.fieldByName('rep_n_cod').AsString)+','+
                    '''PARCE'','+
                    ''''+formatDateTime('mm/dd/YYYY',DATE)+''''+
                    ')'
                    );
   QDestino.ExecSQL();




   cont:=cont+1;
   QOrigem.next;
  end;

end;








function TFPrincipal.criaparcelamento(controle,matricula,ano,receita,dtparcelamento,codseq:String):Integer;
 var cont,erros:Integer;
 origem,cadastro,contribuintes,modulo,recprincipal:String;
 dtcadastro,codruae,codbaie:Variant;
begin




   recprincipal:=receita;



   QVerifica.close;
   QVerifica.sql.clear;
   QVerifica.sql.add('SELECT * FROM FI_DIVIDA '+
   ' WHERE COD_EMP_DIV=1 AND MATRICULA_DIV='''+matricula+''' AND ANO_DIV='''+ano+''' AND COD_REP_DIV='+recprincipal);
   QVerifica.open;


   cont:=1;

   ano:=copy(dtparcelamento,7,4);
   Origem:='03 - Dívida Parcelado';

   cadastro:=QVerifica.fieldByName('cod_cad_div').AsString;
   modulo:=QVerifica.fieldByName('cod_mod_div').AsString;
   contribuintes:=QVerifica.fieldByName('cod_cnt_div').AsString;
   recprincipal:=QVerifica.fieldByName('cod_rep_div').AsString;;
   matricula:=QVerifica.fieldByName('matricula_div').value;

   codruae:=null;
   codbaie:=null;

   QDestino.close;
   QDestino.sql.clear;
   QDestino.sql.add('INSERT INTO FI_DIVIDA(COD_EMP_DIV,COD_DIV,COD_MOD_DIV, '+
                    ' COD_REP_DIV,ANO_DIV,ANOREF_DIV,DATACADAST_DIV,ORIGEM_DIV, '+
                    ' COD_CNT_DIV,CODC_CNT_DIV,COD_CAD_DIV,MATRICULA_DIV,SETOR_DIV,QUADRA_DIV,LOTE_DIV,UNIDADE_DIV, '+
                    ' COD_LOG_DIV,COD_BAI_DIV,NUMERO_DIV,CEPI_DIV,COMPLE_DIV,COD_LOGE_DIV, '+
                    ' COD_BAIE_DIV,NUMEROE_DIV,COMPLEE_DIV,CEPE_DIV,LOGRA_DIV,BAIRRO_DIV,COD_CID_DIV,ANO_STR_DIV,COD_STR_DIV, '+
                    ' LOGIN_INC_DIV,DTA_INC_DIV '+
                    ') '+
                    'VALUES( '+
                    '1,'+
                    codseq+','+
                    modulo+','+
                    recprincipal+','+
                    ''''+ano+''','+
                    ''''+ano+''','+
                    ''''+formatDateTime('mm/dd/YYYY',StrToDate(dtparcelamento))+''','+
                    ''''+Origem+''','+
                    ''''+QVerifica.fieldByName('cod_cnt_div').AsString+''','+
                    TrataDadosFinanceiro(QVerifica.fieldByName('cod_cnt_div').AsString)+','+
                    ''''+cadastro+''','+
                    TrataDadosFinanceiro(matricula)+','+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    'null,'+
                    '''CONVERSAO'','+
                    ''''+formatDateTime('mm/dd/YYYY',DATE)+''''+
                    ')'
                    );
   QDestino.ExecSQL();




   cont:=cont+1;

end;



procedure TFPrincipal.parcelas;
 var cont,erros,tppar,nnumero,i,coddiv:Integer;
 origem,cadastro,situacao,executada,unica,parce,ativa,
 codbanco,cancelado,rece,banco,livro,folha,inscricao,dtinscricao,dtparce,situacaofrc,idCorrecao,
 codrec,datavencimento,datalancamento,datapagamento,datamovimento,lote,pg:String;
 valorReceita,valor,desconto,acrescimos,valorPago:Currency;
begin

 QOrigem.close;
 QOrigem.sql.clear;
 QOrigem.sql.add(' SELECT B.INSCRICAO,B.PAR_D_LAN,B.PAR_S_ANO,A.* '+
                 ' FROM TRIPAR A '+
                 ' INNER JOIN TRILANCA B ON A.PAR_N_SEQ=B.PAR_N_SEQ '+
                 ' WHERE A.SIT_I_COD<>5 ORDER BY A.PAR_N_SEQ '
                 );
 QOrigem.open;

 progressBar1.Max:=QOrigem.RecordCount;

 label4.Caption:=IntToStr(ProgressBar1.max);
 label4.Update;


 cont:=1;
  while not QOrigem.eof do
  begin
   nnumero:=cont;

   label1.Caption:=IntToStr(cont);
   label1.Update;

   ProgressBar1.Position:=cont;

   label5.Caption:=QOrigem.fieldByName('PAR_N_SEQ').AsString;
   label5.Update;
   label6.Caption:=QOrigem.fieldByName('PAR_N_SEQ').AsString;
   label6.Update;

   dtinscricao:='31/01/'+QOrigem.fieldByName('PAR_S_ANO').AsString;

   QCadastro.close;
   QCadastro.sql.clear;
   QCadastro.sql.add('SELECT * FROM TRIPARCELACERTIDAO '+
                     ' WHERE PAR_N_SEQ='+QOrigem.fieldByName('PAR_N_SEQ').AsString+
                     ' AND PAR_I_SUB='+QOrigem.fieldByName('PAR_I_SUB').AsString+
                     ' AND PAR_S_NUM='+QOrigem.fieldByName('PAR_S_NUM').AsString
                     );
   QCadastro.open;

   if not QCadastro.IsEmpty then
   begin
    livro:=QCadastro.fieldByName('liv_i_cod').AsString;
    folha:='1';
    inscricao:=QCadastro.fieldByName('cer_i_cod').AsString;

    ativa:='S';

   end
   else
   begin
    ativa:='N';
   end;

   QCadastro.close;


   QCadastro.close;
   QCadastro.sql.clear;
   QCadastro.sql.add('SELECT * FROM TRILANPROC '+
                     ' WHERE PAR_N_SEQ='+QOrigem.fieldByName('PAR_N_SEQ').AsString+
                     ' AND PAR_I_SUB='+QOrigem.fieldByName('PAR_I_SUB').AsString+
                     ' AND PAR_S_NUM='+QOrigem.fieldByName('PAR_S_NUM').AsString
                     );
   QCadastro.open;

   if not QCadastro.IsEmpty then
   executada:='S'
   else
   executada:='N';

   QCadastro.close;

   pg:='N';
   coddiv:=QOrigem.fieldByName('PAR_N_SEQ').AsInteger;

   tpPar:=QOrigem.fieldByName('PAR_I_SUB').AsInteger;

   unica:=QOrigem.fieldByName('PAR_A_UNICA').AsString;

   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=1)  then
   begin
    situacaofrc:='1';
    cancelado:='N';
    executada:='N';              //divida do exercicio
    situacao:='1';
    ativa:='N';
    parce:='N';
   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=2) or (QOrigem.fieldByName('SIT_I_COD').AsInteger=3)
   or (QOrigem.fieldByName('SIT_I_COD').AsInteger=4) or (QOrigem.fieldByName('SIT_I_COD').AsInteger=29)  then
   begin

     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';

     if executada='S' then
     situacaofrc:='3';

     if situacaofrc='1' then
     situacao:='6'
     else
     if situacaofrc='2' then
     situacao:='7'
     else
     if situacaofrc='3' then
     situacao:='8';

     cancelado:='N';
     parce:='N';
     pg:='S';

   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=6) or (QOrigem.fieldByName('SIT_I_COD').AsInteger=11) then
   begin
    situacaofrc:='2';
    cancelado:='N';
    executada:='N';
    situacao:='2';            //divida ativa
    ativa:='S';
    unica:='N';
    parce:='N';
   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=7) or (QOrigem.fieldByName('SIT_I_COD').AsInteger=15)  then
   begin
    situacaofrc:='3';
    cancelado:='N';
    executada:='S';
    situacao:='3';            //executada
    ativa:='S';
    unica:='N';
    parce:='N';
   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=13) or (QOrigem.fieldByName('SIT_I_COD').AsInteger=14) or (QOrigem.fieldByName('SIT_I_COD').AsInteger=26) then
   begin

     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';         //parcelado

     if executada='S' then
     situacaofrc:='3';

     situacao:='5';
     cancelado:='N';
     parce:='N';

   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=8)  then
   begin

     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';           //cancelado

     if executada='S' then
     situacaofrc:='3';

     situacao:='4';
     cancelado:='S';
     parce:='N';

   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=9)  then
   begin

     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';                //Prescrito

     if executada='S' then
     situacaofrc:='3';

     situacao:='11';
     cancelado:='S';
     parce:='N';

   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=10)  then
   begin

     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';                 //Suspenso

     if executada='S' then
     situacaofrc:='3';

     situacao:='9';
     cancelado:='S';
     parce:='N';

   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=20)  then
   begin

     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';                 //remido

     if executada='S' then
     situacaofrc:='3';

     situacao:='10';
     cancelado:='S';
     parce:='N';

   end
   else
   if QOrigem.fieldByName('SIT_I_COD').AsInteger=27 then
   begin
    situacaofrc:='1';
    cancelado:='N';
    executada:='N';
    situacao:='0';
    ativa:='N';
   end
   else
   if QOrigem.fieldByName('SIT_I_COD').AsInteger=28 then
   begin
    situacaofrc:='1';
    cancelado:='N';
    executada:='S';
    situacao:='0';
    ativa:='N';
   end
   else
   begin
     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';                      //Cancelado

     if executada='S' then
     situacaofrc:='3';

     situacao:='4';
     cancelado:='S';
     parce:='N';

   end;


   parce:='N';


   if trim(livro)='' then
   livro:='1';

   if trim(folha)='' then
   folha:='1';

   if trim(inscricao)='' then
   inscricao:='1';



   try

   idCorrecao:=QOrigem.fieldByName('UFM_S_TIP').AsString;
   datavencimento:=QOrigem.fieldByName('PAR_D_VEN').AsString;

   if trim(datavencimento)='' then
   datavencimento:='31/12/'+QOrigem.fieldByName('PAR_S_ANO').AsString;

   if trim(QOrigem.fieldByName('PAR_D_LAN').AsString)='' then
   datalancamento:='01/01/'+QOrigem.fieldByName('PAR_S_ANO').AsString
   else
   datalancamento:=copy(QOrigem.fieldByName('PAR_D_LAN').AsString,1,10);

   QDestino.close;
   QDestino.sql.clear;
   QDestino.sql.add(' INSERT INTO FI_PARCELA(COD_EMP_PAR,COD_DIV_PAR,TP_PAR, '+
                    ' DATAVENCI,MOEDA_PAR,COD_IND_PAR,DATAGERACAO_PAR,SITUACAO_PAR,SITUACAOANTIGA_PAR,'+
                    ' CANCELADO_PAR,PARCE_PAR,UNICA_PAR,ATIVA_PAR,EXECUTADA_PAR,NNUMERO_PAR, '+
                    ' PARCELA_PAR,DATAPARCE_PAR,VALOR_PAR,LIVRO_PAR,FOLHA_PAR,INSCRI_PAR,'+
                    ' DATAINSCRI_PAR,LOGIN_INC_PAR,DTA_INC_PAR) '+
                    ' VALUES( '+
                    '1,'+
                    IntToStr(coddiv)+','+
                    IntToStr(tppar)+','+
                    ''''+formatDateTime('mm/dd/YYYY',StrToDate(datavencimento))+''','+
                    '''1'','+
                    ''''+QOrigem.fieldByName('UFM_S_TIP').AsString+''','+
                    ''''+formatDateTime('mm/dd/YYYY',StrToDate(datalancamento))+''','+
                    ''''+situacao+''','+
                    ''''+QOrigem.fieldByName('SIT_I_COD').AsString+''','+
                    ''''+cancelado+''','+
                    ''''+parce+''','+
                    ''''+unica+''','+
                    ''''+ativa+''','+
                    ''''+executada+''','+
                    IntToStr(nnumero)+','+
                    QOrigem.fieldByName('par_s_num').AsString+','+
                    ''''+formatDateTime('mm/dd/YYYY',StrToDate(datalancamento))+''','+
                    Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('par_n_val').AsCurrency))+','+
                    livro+','+
                    folha+','+
                    inscricao+','+
                    ''''+formatDateTime('mm/dd/YYYY',StrToDate(dtinscricao))+''','+
                    '''DIVIDA'','+
                    ''''+formatDateTime('mm/dd/YYYY',date)+''''+
                    ')'
                    );

   QDestino.ExecSQL();

   except

   end;


   {
   try
   QDestino.close;
   QDestino.sql.clear;
   QDestino.sql.add('INSERT INTO FI_BAIXACONVERSAO( COD_EMP_CON,COD_DIV_CON,PARCELA_PAR_CON, '+
                                                   ' TP_PAR_CON,ANO_CON,CODIGO_CON,PARCELA_CON, '+
                                                   ' TIPO_CON,CADASTRO_CON,MODULO_CON,CODBARRA_CON) '+
                      'VALUES( '+
                      '1,'+
                      IntToStr(coddiv)+','+
                      QOrigem.fieldByName('nrparcela').AsString+','+
                      IntToStr(tppar)+','+
                      QOrigem.fieldByName('dtAnoDebito').AsString+','+
                      QOrigem.fieldByName('nrNossoNumero').AsString+','+
                      QOrigem.fieldByName('nrparcela').AsString+','+
                      QOrigem.fieldByName('cdDivida').AsString+','+
                      ''''+QOrigem.fieldByName('nrCadastro').AsString+''','+
                           QOrigem.fieldByName('cdTipoCadastro').AsString+','+
                      ''''+QOrigem.fieldByName('cdSubDivida').AsString+''''+
                      ')'
                      );
    QDestino.ExecSQL();

   except
   end;

    }
   ///////////////////////////////Eventos////////////////////////////////////

   QEventos.close;
   QEventos.sql.clear;
   QEventos.sql.add('SELECT * FROM TRIPAR1 WHERE PAR_N_SEQ='+QOrigem.fieldByName('PAR_N_SEQ').AsString+
                    ' AND PAR_S_NUM='''+QOrigem.fieldByName('PAR_S_NUM').AsString+''' AND PAR_I_SUB='+QOrigem.fieldByName('PAR_I_SUB').AsString
                    );
   QEventos.open;
   valorreceita:=0;
   while not QEventos.eof do
   begin

       codrec:=QEventos.fieldByName('TAX_I_COD').AsString;
       valorreceita:=valorreceita+QEventos.fieldByName('PAR_N_VAL').AsCurrency;
       try
       QDestino.close;
       QDestino.sql.clear;
       QDestino.sql.add('INSERT INTO FI_RECEITAS(COD_EMP_FRC,COD_DIV_FRC,TP_PAR_FRC,COD_REC_FRC,ANO_FRC,'+
                        ' SITUACAO_FRC,CODORIGEM_FRC,CODULTORI_FRC,COD_IND_FRC,PARCELA_PAR_FRC,OUTRAS_FRC,LVALOR_FRC ) '+
                        'VALUES( '+
                        '1,'+
                        IntToStr(coddiv)+','+
                        IntToStr(tppar)+','+
                        codrec+','+
                        ''''+QOrigem.fieldByName('PAR_S_ANO').AsString+''','+
                        ''''+situacaofrc+''','+
                        IntToStr(coddiv)+','+
                        IntToStr(coddiv)+','+
                        '1,'+
                        QEventos.fieldByName('PAR_S_NUM').AsString+','+
                        '''N'','+
                        Subs_Virgula_por_Ponto(CurrToStr(QEventos.fieldByName('PAR_N_VAL').AsCurrency))+
                        ')'
                        );
       QDestino.ExecSQL();
       except
       end;
   QEventos.next;
   end;


     if pg='S' then
     begin

          valor:=valorreceita+
                 QOrigem.fieldByName('par_n_cor').AsCurrency+
                 QOrigem.fieldByName('par_n_mul').AsCurrency+
                 QOrigem.fieldByName('par_n_jur').AsCurrency;

          valorPago:=QOrigem.fieldByName('par_n_valpago').AsCurrency;

          if valorPago=0 then
          valorPago:=valor;

          desconto:=0;
          acrescimos:=0;

          if  valor>valorpago then
          desconto:=valor-valorpago
          else
          desconto:=0;

          if valor<valorpago then
          Acrescimos:=valorpago-valor
          else
          acrescimos:=0;


          datapagamento:=QOrigem.fieldByName('PAR_D_DATAPAGTO').AsString;
          dataMovimento:=QOrigem.fieldByName('LOT_D_DATA').AsString;
          lote:=QOrigem.fieldByName('LOT_A_NUM').AsString;
          banco:=QOrigem.fieldByName('BAN_I_COD').AsString;

          if trim(lote)='' then lote:='1';
          if trim(banco)='' then banco:='999';

          if trim(datamovimento)='' then
          datamovimento:=QOrigem.fieldByName('PAR_D_DATAPAGTO').AsString;


          BaixaParcelasFinanceiro(1, QOrigem.fieldByName('PAR_N_SEQ').AsInteger,
          tppar, QOrigem.fieldByName('PAR_S_NUM').AsInteger,datapagamento,
          datamovimento, 'N', BANCO,
          LOTE, QOrigem.fieldByName('par_n_cor').AsCurrency,
          QOrigem.fieldByName('par_n_mul').AsCurrency, QOrigem.fieldByName('par_n_jur').AsCurrency,
          valorreceita,desconto,acrescimos,QOrigem.fieldByName('par_n_valpago').AsCurrency,'DIVIDA',1);
     end;

     cont:=cont+1;
   QOrigem.next;
  end;

end;



procedure TFPrincipal.parcelasParcelamentos;
 var cont,erros,tppar,nnumero,i,coddiv:Integer;
 origem,cadastro,situacao,executada,unica,parce,ativa,
 codbanco,cancelado,rece,banco,livro,folha,inscricao,dtinscricao,dtparce,situacaofrc,idCorrecao,
 codrec,datavencimento,datalancamento,datapagamento,datamovimento,lote,pg:String;
 valorReceita,valor,desconto,acrescimos,valorPago:Currency;
begin

 QOrigem.close;
 QOrigem.sql.clear;
 QOrigem.sql.add(' SELECT B.INSCRICAO,B.PAR_D_LAN,B.PAR_S_ANO,A.* '+
                 ' FROM TRIPAR_REPARCELAMENTO A '+
                 ' INNER JOIN TRILANCA_REPARCELAMENTO B ON A.REP_N_COD=B.REP_N_COD '+
                 ' WHERE SIT_I_COD<>5 '
                 );
 QOrigem.open;

 progressBar1.Max:=QOrigem.RecordCount;

 label4.Caption:=IntToStr(ProgressBar1.max);
 label4.Update;


 cont:=1;
  while not QOrigem.eof do
  begin
   nnumero:=cont;

   label1.Caption:=IntToStr(cont);
   label1.Update;

   ProgressBar1.Position:=cont;

   label5.Caption:=QOrigem.fieldByName('REP_N_COD').AsString;
   label5.Update;
   label6.Caption:=QOrigem.fieldByName('REP_N_COD').AsString;
   label6.Update;

   dtinscricao:='31/01/'+QOrigem.fieldByName('PAR_S_ANO').AsString;

   QVerifica.close;
   QVerifica.sql.clear;
   QVerifica.sql.add(' SELECT COD_DIV FROM FI_DIVIDA '+
                     ' WHERE COD_EMP_DIV=1 AND COD_CAD_DIV='''+ZeraEsquerda(9,QOrigem.fieldByName('inscricao').AsString)+''' '+
                     ' AND ANO_DIV='''+QOrigem.fieldByName('PAR_S_ANO').AsString+''' '+
                     ' AND ANO_STR_DIV='+QOrigem.fieldByName('REP_N_COD').AsString+
                     ' AND LOGIN_INC_DIV=''PARCE'' '
                     );

   QVerifica.open;
   coddiv:=QVerifica.fieldByName('cod_div').AsInteger;

   pg:='N';

   tpPar:=QOrigem.fieldByName('PAR_I_SUB').AsInteger;

   unica:='N';
   ativa:='S';
   executada:='N';
   parce:='S';


   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=1)  then
   begin
    situacaofrc:='2';
    cancelado:='N';
    executada:='N';              //divida do exercicio
    situacao:='2';
   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=2) or (QOrigem.fieldByName('SIT_I_COD').AsInteger=3)
   or (QOrigem.fieldByName('SIT_I_COD').AsInteger=4) or (QOrigem.fieldByName('SIT_I_COD').AsInteger=29)  then
   begin

     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';

     if executada='S' then
     situacaofrc:='3';

     if situacaofrc='1' then
     situacao:='6'
     else
     if situacaofrc='2' then
     situacao:='7'
     else
     if situacaofrc='3' then
     situacao:='8';

     cancelado:='N';
     pg:='S';

   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=6) or (QOrigem.fieldByName('SIT_I_COD').AsInteger=11) then
   begin
    situacaofrc:='2';
    cancelado:='N';
    executada:='N';
    situacao:='2';            //divida ativa
    unica:='N';
   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=7) or (QOrigem.fieldByName('SIT_I_COD').AsInteger=15)  then
   begin
    situacaofrc:='3';
    cancelado:='N';
    executada:='S';
    situacao:='3';            //executada
    ativa:='S';
    unica:='N';
   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=13) or (QOrigem.fieldByName('SIT_I_COD').AsInteger=14) or (QOrigem.fieldByName('SIT_I_COD').AsInteger=26) then
   begin

     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';         //parcelado

     if executada='S' then
     situacaofrc:='3';

     situacao:='5';
     cancelado:='N';

   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=8)  then
   begin

     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';           //cancelado

     if executada='S' then
     situacaofrc:='3';

     situacao:='4';
     cancelado:='S';

   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=9)  then
   begin

     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';                //Prescrito

     if executada='S' then
     situacaofrc:='3';

     situacao:='11';
     cancelado:='S';

   end
   else
   if (QOrigem.fieldByName('SIT_I_COD').AsInteger=10)  then
   begin

     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';                 //Suspenso

     if executada='S' then
     situacaofrc:='3';

     situacao:='9';
     cancelado:='S';

   end
   else
   if QOrigem.fieldByName('SIT_I_COD').AsInteger=27 then
   begin
    situacaofrc:='1';
    cancelado:='N';
    executada:='N';
    situacao:='0';
    ativa:='N';
   end
   else
   if QOrigem.fieldByName('SIT_I_COD').AsInteger=28 then
   begin
    situacaofrc:='1';
    cancelado:='N';
    executada:='S';
    situacao:='0';
    ativa:='N';
   end
   else
   if QOrigem.fieldByName('SIT_I_COD').AsInteger=37 then
   begin
    situacaofrc:='2';
    cancelado:='S';
    executada:='N';
    situacao:='26';
    ativa:='S';
   end
   else
   begin
     if ativa='S' then
     situacaofrc:='2'
     else
     if ativa='N' then
     situacaofrc:='1';                      //Cancelado

     if executada='S' then
     situacaofrc:='3';

     situacao:='4';
     cancelado:='S';

   end;


   parce:='S';


   if trim(livro)='' then
   livro:='1';

   if trim(folha)='' then
   folha:='1';

   if trim(inscricao)='' then
   inscricao:='1';



   try

   idCorrecao:=QOrigem.fieldByName('UFM_S_TIP').AsString;
   datavencimento:=QOrigem.fieldByName('PAR_D_VEN').AsString;

   if trim(datavencimento)='' then
   datavencimento:='31/12/'+QOrigem.fieldByName('PAR_S_ANO').AsString;

   if trim(QOrigem.fieldByName('PAR_D_LAN').AsString)='' then
   datalancamento:='01/01/'+QOrigem.fieldByName('PAR_S_ANO').AsString
   else
   datalancamento:=QOrigem.fieldByName('PAR_D_LAN').AsString;

   QDestino.close;
   QDestino.sql.clear;
   QDestino.sql.add(' INSERT INTO FI_PARCELA(COD_EMP_PAR,COD_DIV_PAR,TP_PAR, '+
                    ' DATAVENCI,MOEDA_PAR,COD_IND_PAR,DATAGERACAO_PAR,SITUACAO_PAR,SITUACAOANTIGA_PAR,'+
                    ' CANCELADO_PAR,PARCE_PAR,UNICA_PAR,ATIVA_PAR,EXECUTADA_PAR,NNUMERO_PAR, '+
                    ' PARCELA_PAR,DATAPARCE_PAR,VALOR_PAR,LIVRO_PAR,FOLHA_PAR,INSCRI_PAR,'+
                    ' DATAINSCRI_PAR,LOGIN_INC_PAR,DTA_INC_PAR) '+
                    ' VALUES( '+
                    '1,'+
                    IntToStr(coddiv)+','+
                    IntToStr(tppar)+','+
                    ''''+formatDateTime('mm/dd/YYYY',StrToDate(datavencimento))+''','+
                    '''1'','+
                    ''''+QOrigem.fieldByName('UFM_S_TIP').AsString+''','+
                    ''''+formatDateTime('mm/dd/YYYY',StrToDate(datalancamento))+''','+
                    ''''+situacao+''','+
                    ''''+QOrigem.fieldByName('SIT_I_COD').AsString+''','+
                    ''''+cancelado+''','+
                    ''''+parce+''','+
                    ''''+unica+''','+
                    ''''+ativa+''','+
                    ''''+executada+''','+
                    IntToStr(nnumero)+','+
                    QOrigem.fieldByName('par_s_num').AsString+','+
                    ''''+formatDateTime('mm/dd/YYYY',StrToDate(datalancamento))+''','+
                    Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('par_n_val').AsCurrency))+','+
                    livro+','+
                    folha+','+
                    inscricao+','+
                    ''''+formatDateTime('mm/dd/YYYY',StrToDate(dtinscricao))+''','+
                    '''PARCE'','+
                    ''''+formatDateTime('mm/dd/YYYY',date)+''''+
                    ')'
                    );

   QDestino.ExecSQL();

   except

   end;


   {
   try
   QDestino.close;
   QDestino.sql.clear;
   QDestino.sql.add('INSERT INTO FI_BAIXACONVERSAO( COD_EMP_CON,COD_DIV_CON,PARCELA_PAR_CON, '+
                                                   ' TP_PAR_CON,ANO_CON,CODIGO_CON,PARCELA_CON, '+
                                                   ' TIPO_CON,CADASTRO_CON,MODULO_CON,CODBARRA_CON) '+
                      'VALUES( '+
                      '1,'+
                      IntToStr(coddiv)+','+
                      QOrigem.fieldByName('nrparcela').AsString+','+
                      IntToStr(tppar)+','+
                      QOrigem.fieldByName('dtAnoDebito').AsString+','+
                      QOrigem.fieldByName('nrNossoNumero').AsString+','+
                      QOrigem.fieldByName('nrparcela').AsString+','+
                      QOrigem.fieldByName('cdDivida').AsString+','+
                      ''''+QOrigem.fieldByName('nrCadastro').AsString+''','+
                           QOrigem.fieldByName('cdTipoCadastro').AsString+','+
                      ''''+QOrigem.fieldByName('cdSubDivida').AsString+''''+
                      ')'
                      );
    QDestino.ExecSQL();

   except
   end;

    }
   ///////////////////////////////Eventos////////////////////////////////////

   QEventos.close;
   QEventos.sql.clear;
   QEventos.sql.add('SELECT * FROM TRIPAR1_REPARCELAMENTO WHERE REP_N_COD='+QOrigem.fieldByName('REP_N_COD').AsString+
                    ' AND PAR_S_NUM='''+QOrigem.fieldByName('PAR_S_NUM').AsString+''' AND PAR_I_SUB='+QOrigem.fieldByName('PAR_I_SUB').AsString
                    );
   QEventos.open;
   valorreceita:=0;
   while not QEventos.eof do
   begin

       codrec:=QEventos.fieldByName('TAX_I_COD').AsString;
       valorreceita:=valorreceita+QEventos.fieldByName('PAR_N_VAL').AsCurrency;
       try
       QDestino.close;
       QDestino.sql.clear;
       QDestino.sql.add('INSERT INTO FI_RECEITAS(COD_EMP_FRC,COD_DIV_FRC,TP_PAR_FRC,COD_REC_FRC,ANO_FRC,'+
                        ' SITUACAO_FRC,CODORIGEM_FRC,CODULTORI_FRC,COD_IND_FRC,PARCELA_PAR_FRC,OUTRAS_FRC, '+
                        ' LVALOR_FRC,LVRCORRE_FRC,LVRMULTA_FRC,LVRJUROS_FRC ) '+
                        'VALUES( '+
                        '1,'+
                        IntToStr(coddiv)+','+
                        IntToStr(tppar)+','+
                        codrec+','+
                        ''''+QOrigem.fieldByName('PAR_S_ANO').AsString+''','+
                        ''''+situacaofrc+''','+
                        IntToStr(coddiv)+','+
                        IntToStr(coddiv)+','+
                        '1,'+
                        QEventos.fieldByName('PAR_S_NUM').AsString+','+
                        '''N'','+
                        Subs_Virgula_por_Ponto(CurrToStr(QEventos.fieldByName('PAR_N_VAL').AsCurrency))+','+
                        Subs_Virgula_por_Ponto(CurrToStr(QEventos.fieldByName('PAR_N_COR_REP').AsCurrency))+','+
                        Subs_Virgula_por_Ponto(CurrToStr(QEventos.fieldByName('PAR_N_MUL_REP').AsCurrency))+','+
                        Subs_Virgula_por_Ponto(CurrToStr(QEventos.fieldByName('PAR_N_JUR_REP').AsCurrency))+
                        ')'
                        );
       QDestino.ExecSQL();
       except
       end;
   QEventos.next;
   end;


     if pg='S' then
     begin

          valor:=valorreceita+
                 QOrigem.fieldByName('par_n_correcao').AsCurrency+
                 QOrigem.fieldByName('par_n_multa').AsCurrency+
                 QOrigem.fieldByName('par_n_juros').AsCurrency+
                 QOrigem.fieldByName('par_n_cor_rep').AsCurrency+
                 QOrigem.fieldByName('par_n_mul_rep').AsCurrency+
                 QOrigem.fieldByName('par_n_jur_rep').AsCurrency;


          valorPago:=QOrigem.fieldByName('par_n_valpago').AsCurrency;

          if valorPago=0 then
          valorPago:=valor;

          desconto:=0;
          acrescimos:=0;

          if  valor>valorpago then
          desconto:=valor-valorpago
          else
          desconto:=0;

          if valor<valorpago then
          Acrescimos:=valorpago-valor
          else
          acrescimos:=0;


          datapagamento:=QOrigem.fieldByName('PAR_D_DATAPAGTO').AsString;
          dataMovimento:=QOrigem.fieldByName('LOT_D_DATA').AsString;
          lote:=QOrigem.fieldByName('LOT_A_NUM').AsString;
          banco:=QOrigem.fieldByName('BAN_I_COD').AsString;

          if trim(lote)='' then lote:='1';
          if trim(banco)='' then banco:='999';

          if trim(datamovimento)='' then
          datamovimento:=QOrigem.fieldByName('PAR_D_DATAPAGTO').AsString;


          BaixaParcelasFinanceiro(1, coddiv,
          tppar, QOrigem.fieldByName('PAR_S_NUM').AsInteger,datapagamento,
          datamovimento, 'N', BANCO,
          LOTE, QOrigem.fieldByName('par_n_correcao').AsCurrency,
          QOrigem.fieldByName('par_n_multa').AsCurrency, QOrigem.fieldByName('par_n_juros').AsCurrency,
          valorreceita,desconto,acrescimos,QOrigem.fieldByName('par_n_valpago').AsCurrency,'PARCE',1);
     end;

     cont:=cont+1;
   QOrigem.next;
  end;

end;








procedure TFPrincipal.lancamentos;
 var cont,erros,nparcela,numero,coddivida:Integer;
 origem,modulo,cadastro,situacao,dtassinatura,dtreferencia:String;
begin

   QOrigem.close;
   QOrigem.sql.clear;
   QOrigem.sql.add('SELECT * FROM TRILANCA_REPARCELAMENTO ORDER BY REP_N_COD ');
   QOrigem.open;
   numero:=1;
   ProgressBar1.max:=QOrigem.recordcount;
   cont:=1;

   while not QOrigem.eof do
   begin
       ProgressBar1.position:=cont;
       cont:=cont+1;
       numero:=numero+1;

    label5.caption:=QOrigem.fieldByName('REP_N_COD').AsString;
    label5.Update;

    if QOrigem.fieldByName('IMP_A_NAT').AsString='1' then
     modulo:='1'
    else
    if QOrigem.fieldByName('IMP_A_NAT').AsString='3' then
     modulo:='2'
    else
    if QOrigem.fieldByName('IMP_A_NAT').AsString='2' then
     modulo:='4'
    else
     modulo:='5';


       if trim(QOrigem.fieldByName('rep_d_can').AsString)<>'' then
       situacao:='S'
       else
       situacao:='N';



       dtassinatura:=QOrigem.fieldByName('PAR_D_LAN').AsString;
       dtreferencia:=QOrigem.fieldByName('PAR_D_LAN').AsString;

       if trim(dtreferencia)='' then
       dtreferencia:=dtassinatura;

       QVerifica.close;
       QVerifica.sql.clear;
       QVerifica.sql.add('SELECT COD_DIV,COD_CNT_DIV FROM FI_DIVIDA '+
                         ' WHERE COD_EMP_DIV=1 AND COD_CAD_DIV='''+ZeraEsquerda(9,QOrigem.fieldByName('inscricao').AsString)+''' '+
                         ' AND ANO_DIV='''+QOrigem.fieldByName('PAR_S_ANO').AsString+''' '+
                         ' AND ANO_STR_DIV='+QOrigem.fieldByName('REP_N_COD').AsString+
                         ' AND LOGIN_INC_DIV=''PARCE'' '
                         );

       QVerifica.open;
       coddivida:=QVerifica.fieldByName('cod_div').AsInteger;



       if trim(QOrigem.fieldByName('CNTI_I_CON_REQUER').AsString)<>'' then
       begin
       QCadastro.close;
       QCadastro.sql.clear;
       QCadastro.sql.add(' SELECT * FROM CNTI_CONTRIBUINTES '+
                         ' WHERE CNTI_I_CON='''+QOrigem.fieldByName('CNTI_I_CON_REQUER').AsString+''' '
                         );

       QCadastro.open;
       end
       else
       begin
        if trim(QOrigem.fieldByName('CNTI_I_CON').AsString)<>'' then
        begin
         QCadastro.close;
         QCadastro.sql.clear;
         QCadastro.sql.add(' SELECT * FROM CNTI_CONTRIBUINTES '+
                           ' WHERE CNTI_I_CON='''+QOrigem.fieldByName('CNTI_I_CON').AsString+''' '
                         );

         QCadastro.open;
        end
        else
        begin
         QCadastro.close;
         QCadastro.sql.clear;
         QCadastro.sql.add(' SELECT * FROM CNTI_CONTRIBUINTES '+
                           ' WHERE CNTI_I_CON='+QVerifica.fieldByName('cod_cnt_div').AsString
                         );

         QCadastro.open;

        end;

       end;

       QDestino.close;
       QDestino.sql.clear;
       QDestino.sql.add('INSERT INTO FI_LANCAMENTO(COD_EMP_LAN,COD_LAN,TP_LAN,VENCI_LAN, '+
                          ' DATA_LAN,NPARCE_LAN,TPCALC_LAN,COD_CAD_LAN,PROCESSO_LAN,DATAPROCESSO_LAN,'+
                          ' COD_DIV_LAN,COD_MOD_LAN,ESTORNADO_LAN,REQUE_LAN,LOGRA_LAN,BAIRRO_LAN,CEPE_LAN,'+
                          ' CNPJ_LAN,NUMEROE_LAN,RG_LAN,COD_CID_LAN) '+
                          'VALUES( '+
                          '1,'+
                          QOrigem.fieldByName('REP_N_COD').AsString+','+
                          '2,'+
                          ''''+formatDateTime('mm/dd/YYYY',StrTodate(dtassinatura))+''','+
                          ''''+formatDateTime('mm/dd/YYYY',StrTodate(dtreferencia))+''','+
                          QOrigem.fieldByName('PAR_S_LAN').AsString+','+
                          '''01 - Parcelas Iguais'','+
                          ''''+ZeraEsquerda(9,QOrigem.fieldByName('Inscricao').AsString)+''','+
                          ''''+QOrigem.fieldByName('rep_a_processo').AsString+''','+
                          ''''+formatDateTime('mm/dd/YYYY',QOrigem.fieldByName('PAR_D_LAN').value)+''','+
                          ''''+IntToStr(coddivida)+''','+
                           modulo+','+
                          ''''+Situacao+''','+
                          ''''+RetiraChar(QCadastro.fieldByName('CNTI_A_NOM').AsString,'''')+''','+
                          ''''+RetiraChar(QCadastro.fieldByName('CNTI_A_LOGR').AsString,'''')+''','+
                          ''''+RetiraChar(QCadastro.fieldByName('CNTI_A_BAIR').AsString,'''')+''','+
                          ''''+RetiraChar(QCadastro.fieldByName('CNTI_A_CEPR').AsString,'''')+''','+
                          ''''+RetiraChar(QCadastro.fieldByName('CNTI_A_CPFCGC').AsString,'''')+''','+
                          ''''+RetiraChar(QCadastro.fieldByName('CNTI_A_NUMR').AsString,'''')+''','+
                          ''''+RetiraChar(QCadastro.fieldByName('CNTI_A_RGIE').AsString,'''')+''','+
                          '''0000001'''+
                          ')'
                          );
       QDestino.ExecSQL();

   QOrigem.next;
   end;


end;




procedure TFPrincipal.Itens;
 var cont,erros,coddivida:Integer;
 origem,cadastro,modulo,tppar,situacao,ano,nparcela:String;
 desconto,acrescimos:Currency;
begin

 QOrigem.close;
 QOrigem.sql.clear;
 QOrigem.sql.add(' SELECT A.*,B.PAR_N_VAL '+
                 ' FROM SEQUENCIAS_REPARCELAMENTO A '+
                 ' INNER JOIN TRIPAR B ON A.PAR_N_SEQ=B.PAR_N_SEQ AND A.PAR_S_NUM=B.PAR_S_NUM '+
                 ' AND B.PAR_I_SUB=A.PAR_I_SUB '+
                 ' ORDER BY REP_N_COD '
                 );
 QOrigem.open;



  cont:=1;
  while not QOrigem.eof do
  begin

  label5.caption:=QOrigem.fieldByName('REP_N_COD').AsString;
  label5.update;

     QVerifica.close;
     QVerifica.sql.clear;
     QVerifica.sql.add('SELECT COD_LAN,TP_LAN FROM FI_LANCAMENTO WHERE COD_EMP_LAN=1 AND TP_LAN=2 AND COD_lan='+QOrigem.fieldByName('REP_N_COD').AsString);
     QVerifica.open;
     if not QVerifica.IsEmpty then
     begin

                 desconto:=0;
                 acrescimos:=0;
                 QAuxiliar.close;
                 QAuxiliar.sql.clear;
                 QAuxiliar.sql.add('SELECT ativa_par,executada_par,cod_mod_div,ano_div FROM FI_PARCELA '+
                 ' INNER JOIN FI_DIVIDA ON COD_EMP_DIV=COD_EMP_PAR AND COD_DIV=COD_DIV_PAR '+
                 ' WHERE COD_EMP_PAR=1 AND COD_DIV_PAR='+QOrigem.fieldByName('par_n_seq').AsString+' AND PARCELA_PAR='+QOrigem.fieldByName('par_s_num').AsString+
                 ' AND TP_PAR='+QOrigem.fieldByName('PAR_I_SUB').AsString
                 );
                 QAuxiliar.open;
                 if not QAuxiliar.IsEmpty then
                 begin
                 if QAuxiliar.fieldByName('ativa_par').AsString='S' then
                 situacao:='2';

                 if QAuxiliar.fieldByName('ativa_par').AsString='N' then
                 situacao:='1';

                 if QAuxiliar.fieldByName('executada_par').AsString='S' then
                 situacao:='3';






                 QDestino.close;
                 QDestino.sql.clear;
                 QDestino.sql.add('INSERT INTO FI_ITENS(COD_EMP_ITS,COD_DIV_ITS,COD_LAN_ITS,TP_LAN_ITS,PARCELA_ITS,TP_ITS, '+
                                  ' VALOR_ITS,CORRE_ITS,JUROS_ITS,MULTA_ITS,DESCOR_ITS,DESCOC_ITS,DESCOM_ITS,DESCOJ_ITS,'+
                                  ' DESCO_ITS,ACRE_ITS,CUSTA_ITS,TP_PAR_TS,'+
                                  ' ANO_ITS,COD_MOD_ITS,SITUACAO_ITS) '+
                                  'VALUES( '+
                                  '1,'+
                                  QOrigem.fieldByName('par_n_seq').AsString+','+
                                  QVerifica.fieldByName('cod_lan').AsString+','+
                                  '2,'+
                                  QOrigem.fieldByName('PAR_S_NUM').AsString+','+
                                  QOrigem.fieldByName('PAR_I_SUB').AsString+','+
                                  Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('PAR_N_VAL').AsCurrency))+','+
                                  Subs_Virgula_por_Ponto(CurrToStr(0))+','+//correcao
                                  Subs_Virgula_por_Ponto(CurrToStr(0))+','+//juros
                                  Subs_Virgula_por_Ponto(CurrToStr(0))+','+//multa
                                  Subs_Virgula_por_Ponto(CurrToStr(0))+','+//desconto receita
                                  Subs_Virgula_por_Ponto(CurrToStr(0 ))+','+//desconto correcao
                                  Subs_Virgula_por_Ponto(CurrToStr( 0))+','+//desconto multa
                                  Subs_Virgula_por_Ponto(CurrToStr( 0))+','+//desconto juros
                                  Subs_Virgula_por_Ponto(CurrToStr(desconto))+','+
                                  Subs_Virgula_por_Ponto(CurrToStr(Acrescimos))+','+
                                  Subs_Virgula_por_Ponto(CurrToStr(0))+','+
                                  QOrigem.fieldByName('PAR_I_SUB').AsString+','+
                                  QAuxiliar.fieldByName('ano_div').AsString+','+
                                  QAuxiliar.fieldByName('cod_mod_div').AsString+','+
                                  situacao+
                                  ')'
                                  );
                 QDestino.ExecSQL();
                end;
      end;



    cont:=cont+1;
   QOrigem.next;
  end;

end;






procedure TFPrincipal.lancamentosCobranca;
 var cont,erros,nparcela:Integer;
 origem,cadastro,modulo,coddivida,tipo:String;
begin

 QOrigem.close;
 QOrigem.sql.clear;
 QOrigem.sql.add('SELECT * FROM ASP02_ARRECADACAO ');
 QOrigem.open;

 progressBar1.Max:=QOrigem.RecordCount;

 label4.Caption:=IntToStr(ProgressBar1.max);
 label4.Update;



  cont:=1;
  while not QOrigem.eof do
  begin

         label1.Caption:=IntToStr(cont);
         label1.Update;

         ProgressBar1.Position:=cont;

         nparcela:=1;
         coddivida:='0';



       if QOrigem.fieldByName('IMP_A_NAT').AsString='1' then
        modulo:='1'
       else
       if QOrigem.fieldByName('IMP_A_NAT').AsString='3' then
        modulo:='2'
       else
       if QOrigem.fieldByName('IMP_A_NAT').AsString='2' then
        modulo:='4'
       else
        modulo:='5';


         QDestino.close;
         QDestino.sql.clear;
         QDestino.sql.add('INSERT INTO FI_LANCAMENTO(COD_EMP_LAN,COD_LAN,TP_LAN,VENCI_LAN, '+
                          ' DATA_LAN,NPARCE_LAN,TPCALC_LAN,COD_CAD_LAN, '+
                          ' COD_DIV_LAN,COD_MOD_LAN,ESTORNADO_LAN, '+
                          ' ENTRADA_LAN,CUSTAS_LAN,DESCONTO_LAN,ACRESCIMO_LAN,NNUMERO_LAN) '+
                          ' VALUES( '+
                          '1,'+
                          QOrigem.fieldByName('ARR_N_COD').AsString+','+
                          '1,'+
                          ''''+formatDateTime('mm/dd/YYYY',QOrigem.fieldByName('ARR_D_VALIDADE').value)+''','+
                          ''''+formatDateTime('mm/dd/YYYY',QOrigem.fieldByName('ARR_D_DATAEMIS').value)+''','+
                          IntToStr(nparcela)+','+
                          '''01 - Parcelas Iguais'','+
                          ''''+ZeraEsquerda(9,QOrigem.fieldByName('INSCRICAO').AsString)+''','+
                          ''''+coddivida+''','+
                           modulo+','+
                          '''N'','+
                          Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('PAR_N_VRLAN').AsCurrency+
                                                           QOrigem.fieldByName('PAR_N_MUL').AsCurrency+
                                                           QOrigem.fieldByName('PAR_N_JUR').AsCurrency+
                                                           QOrigem.fieldByName('PAR_N_COR').AsCurrency-
                                                           QOrigem.fieldByName('PAR_N_DES').AsCurrency
                                                           ))+','+
                          Subs_Virgula_por_Ponto(CurrToStr(0))+','+
                          Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('PAR_N_DES').AsCurrency))+','+
                          '0,'+
                          QOrigem.fieldByName('ARR_N_COD').AsString+
                          ')'
                          );
         QDestino.ExecSQL();



   cont:=cont+1;
   QOrigem.next;
  end;

end;





procedure TFPrincipal.ItensCobranca;
 var cont,erros,totreceitas,nreceitas,coddivida:Integer;
 origem,cadastro,modulo,tppar,situacao,ano,nparcela,codlan,tipo:String;
 totDescontoRec,TotDescontoAtualiza,vrCorrecao,vrMulta,vrJuros,vrDesconto,
 vrReceitas,DiferCorrecao,DiferMulta,DiferJuros,DiferDesconto,DiferReceitas,
 vrDescoR,vrDescoC,vrDescoM,vrDescoJ,ValorDescontoCorrecao,ValorDescontoMulta,ValorDescontoJuros,ValorDescontoReceita,
 diferDescontoCorrecao,diferDescontoMulta,diferDescontoJuros,diferDescontoReceita:Double;
 vrParcela,Desconto:Double;
begin

 QOrigem.close;
 QOrigem.sql.clear;
 QOrigem.sql.add('SELECT * FROM ASP02_ARRECAD_PARCELA ORDER BY ARR_N_COD ' );
 QOrigem.open;
 progressBar1.Max:=QOrigem.RecordCount;

 label4.Caption:=IntToStr(ProgressBar1.max);
 label4.Update;



 cont:=1;
  while not QOrigem.eof do
  begin

  label1.Caption:=IntToStr(cont);
  label1.Update;

  ProgressBar1.Position:=cont;



   label5.Caption:=QOrigem.fieldByName('ARR_N_COD').value;
   label5.Update;
   QVerifica.close;
   QVerifica.sql.clear;
   QVerifica.sql.add('SELECT * FROM FI_LANCAMENTO WHERE COD_EMP_LAN=1 AND TP_LAN=1 AND COD_LAN='+QOrigem.fieldByName('ARR_N_COD').AsString);
   QVerifica.open;
   if not QVerifica.IsEmpty then
   begin
         codlan:=QVerifica.fieldByName('cod_lan').AsString;

         if trim(QOrigem.fieldByName('REP_N_COD').AsString)<>'0' then
         begin

             QVerifica.close;
             QVerifica.sql.clear;
             QVerifica.sql.add(' SELECT COD_DIV FROM FI_DIVIDA '+
                               ' WHERE COD_EMP_DIV=1 '+
                               ' AND ANO_STR_DIV='+QOrigem.fieldByName('REP_N_COD').AsString+
                               ' AND LOGIN_INC_DIV=''PARCE'' '
                               );

             QVerifica.open;
             coddivida:=QVerifica.fieldByName('cod_div').AsInteger;

         end
         else
         coddivida:=QOrigem.fieldByName('par_n_seq').AsInteger;

         QVerifica.close;
         QVerifica.sql.clear;
         QVerifica.sql.add(' SELECT PARCELA_PAR,COD_DIV_PAR,COD_MOD_DIV,ANO_DIV,TP_PAR,ATIVA_PAR,EXECUTADA_PAR FROM FI_PARCELA '+
                           ' INNER JOIN FI_DIVIDA ON COD_DIV=COD_DIV_PAR AND COD_EMP_PAR=COD_EMP_DIV '+
                           ' WHERE COD_EMP_PAR=1 AND COD_DIV_PAR='+IntToStr(coddivida)+' AND PARCELA_PAR='+QOrigem.fieldByName('PAR_S_NUM').AsString+
                           ' AND TP_PAR='+QOrigem.fieldByName('PAR_I_SUB').AsString
                           );
         QVerifica.open;

         if not QVerifica.IsEmpty then
         begin

           ano:=QVerifica.fieldByName('ano_div').AsString;
           coddivida:=QVerifica.fieldByName('cod_div_par').AsInteger;
           nparcela:=QVerifica.fieldByName('parcela_par').AsString;
           modulo:=QVerifica.fieldByName('cod_mod_div').AsString;
           tppar:=QVerifica.fieldByName('tp_par').AsString;


           if copy(QVerifica.fieldByName('EXECUTADA_PAR').AsString,1,1)='S' then
           situacao:='3'
           else
           if copy(QVerifica.fieldByName('ATIVA_PAR').AsString,1,1)='S' then
           situacao:='2'
           else
           situacao:='1';



           vrParcela:=QOrigem.fieldByName('PAR_N_VAL').AsCurrency;




           vrCorrecao:=0;vrMulta:=0;vrJuros:=0;
           vrDesconto:=0;vrReceitas:=0;DiferCorrecao:=0;
           DiferMulta:=0;DiferJuros:=0;DiferDesconto:=0;DiferReceitas:=0;

           vrDescoR:=0;vrDescoC:=0;vrDescoM:=0;vrDescoJ:=0;
           ValorDescontoCorrecao:=0;ValorDescontoMulta:=0;
           ValorDescontoJuros:=0;ValorDescontoReceita:=0;

           diferDescontoCorrecao:=0;diferDescontoMulta:=0;
           diferDescontoJuros:=0;diferDescontoReceita:=0;


           ValorDescontoCorrecao:=0;
           ValorDescontoMulta:=0;
           ValorDescontoJuros:=0;

          try
           QDestino.close;
           QDestino.sql.clear;
           QDestino.sql.add('INSERT INTO FI_ITENS(COD_EMP_ITS,COD_DIV_ITS,COD_LAN_ITS,TP_LAN_ITS,PARCELA_ITS,TP_ITS, '+
                            ' VALOR_ITS,CORRE_ITS,JUROS_ITS,MULTA_ITS,DESCO_ITS,ACRE_ITS,CUSTA_ITS,TP_PAR_TS,'+
                            ' ANO_ITS,COD_MOD_ITS,SITUACAO_ITS) '+
                            'VALUES( '+
                            '1,'+
                            IntToStr(coddivida)+','+
                            codlan+','+
                            '1,'+
                            nparcela+','+
                            tppar+','+
                            Subs_Virgula_por_Ponto(CurrToStr(vrParcela))+','+
                            Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('PAR_N_COR_REP').AsCurrency+QOrigem.fieldByName('PAR_N_COR').AsCurrency))+','+
                            Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('PAR_N_JUR_REP').AsCurrency+QOrigem.fieldByName('PAR_N_JUR').AsCurrency))+','+
                            Subs_Virgula_por_Ponto(CurrToStr(QOrigem.fieldByName('PAR_N_MUL_REP').AsCurrency+QOrigem.fieldByName('PAR_N_MUL').AsCurrency))+','+
                            Subs_Virgula_por_Ponto(CurrToStr(ValorDescontoCorrecao+ValorDescontoMulta+ValorDescontoJuros))+','+
                            '0,'+
                            Subs_Virgula_por_Ponto('0')+','+
                            tppar+','+
                            Ano+','+
                            modulo+','+
                            situacao+
                            ')'
                            );
           QDestino.ExecSQL();
          except
          end;



         QEventos.close;
         QEventos.sql.clear;
         QEventos.sql.add(' SELECT * FROM ASP02_ARRECAD_RECEITAS '+
                          ' WHERE ARR_N_COD='+QOrigem.fieldByName('ARR_N_COD').AsString+
                          ' AND PAR_N_SEQ='+QOrigem.fieldByName('PAR_N_SEQ').AsString+
                          ' AND REP_N_COD='+QOrigem.fieldByName('REP_N_COD').AsString+
                          ' AND PAR_S_NUM='+QOrigem.fieldByName('PAR_S_NUM').AsString+
                          ' AND PAR_I_SUB='+QOrigem.fieldByName('PAR_I_SUB').AsString
                          );
         QEventos.open;


         while not QEventos.eof do
         begin

            vrCorrecao:=QEventos.fieldByName('PAR_N_COR_REP').AsCurrency+QEventos.fieldByName('PAR_N_COR').AsCurrency;
            vrMulta:=QEventos.fieldByName('PAR_N_MUL_REP').AsCurrency+QEventos.fieldByName('PAR_N_MUL').AsCurrency;
            vrJuros:=QEventos.fieldByName('PAR_N_JUR_REP').AsCurrency+QEventos.fieldByName('PAR_N_JUR').AsCurrency;

            vrDescoC := 0;
            vrDescoM := 0;
            vrDescoJ := 0;
            vrDescoR := QEventos.fieldByName('PAR_N_DES').AsCurrency;




            QVerifica.close;
            QVerifica.sql.clear;
            QVerifica.sql.add('SELECT * FROM FI_RECEITAS WHERE COD_EMP_FRC=1 '+
            ' AND COD_DIV_FRC='+IntToStr(coddivida)+' AND PARCELA_PAR_FRC='+nparcela+
            ' AND TP_PAR_FRC='+tppar+' AND COD_REC_FRC='+QEventos.fieldByName('tax_i_cod').AsString);
            QVerifica.Open;
            if not QVerifica.IsEmpty then
            begin
               vrCorrecao:=QEventos.fieldByName('PAR_N_COR_REP').AsCurrency+QEventos.fieldByName('PAR_N_COR').AsCurrency;
               vrMulta:=QEventos.fieldByName('PAR_N_MUL_REP').AsCurrency+QEventos.fieldByName('PAR_N_MUL').AsCurrency;
               vrJuros:=QEventos.fieldByName('PAR_N_JUR_REP').AsCurrency+QEventos.fieldByName('PAR_N_JUR').AsCurrency;

               vrDescoC := 0;
               vrDescoM := 0;
               vrDescoJ := 0;
               vrDescoR := 0;

               if QVerifica.fieldByName('lvalor_frc').AsCurrency>QEventos.fieldByName('PAR_N_VAL').AsCurrency then
               vrDescoR:=QVerifica.fieldByName('lvalor_frc').AsCurrency-QEventos.fieldByName('PAR_N_VAL').AsCurrency;

               if QVerifica.fieldByName('lvrcorre_frc').AsCurrency>vrCorrecao then
               vrDescoC:=QVerifica.fieldByName('lvrcorre_frc').AsCurrency-vrCorrecao;

               if QVerifica.fieldByName('lvrmulta_frc').AsCurrency>vrMulta then
               vrDescoM:=QVerifica.fieldByName('lvrmulta_frc').AsCurrency-vrMulta;

               if QVerifica.fieldByName('lvrJuros_frc').AsCurrency>vrJuros then
               vrDescoJ:=QVerifica.fieldByName('lvrJuros_frc').AsCurrency-vrJuros;


               try
                 QDestino.close;
                 QDestino.sql.clear;
                 QDestino.sql.add('INSERT INTO FI_ITENSRECEITAS(COD_EMP_IRE,COD_LAN_IRE,TP_LAN_IRE,COD_DIV_IRE,TP_PAR_IRE,COD_REC_IRE,ANO_IRE, '+
                                  ' SITUACAO_IRE,CODORIGEM_IRE,CODULTORI_IRE,PARCELA_PAR_IRE,OUTRA_IRE,LVALOR_IRE, '+
                                  'LVRCORRE_IRE,LVRMULTA_IRE,LVRJUROS_IRE,LDESCOR_IRE,LDESCOC_IRE,LDESCOM_IRE,LDESCOJ_IRE,LACRES_IRE '+
                                  ' ) '+
                                  'VALUES( '+
                                  '1,'+
                                  codlan+','+
                                  '1,'+
                                  QVerifica.fieldByName('cod_div_frc').AsString+','+
                                  QVerifica.fieldByName('tp_par_frc').AsString+','+
                                  QVerifica.fieldByName('cod_rec_frc').AsString+','+
                                  ''''+QVerifica.fieldByName('ano_frc').AsString+''','+
                                  ''''+QVerifica.fieldByName('situacao_frc').AsString+''','+
                                  QVerifica.fieldByName('codorigem_frc').AsString+','+
                                  QVerifica.fieldByName('codultori_frc').AsString+','+
                                  QVerifica.fieldByName('parcela_par_frc').AsString+','+
                                  '''N'','+
                                  Subs_Virgula_por_Ponto(CurrToStr(QEventos.fieldByName('PAR_N_VAL').AsCurrency))+','+
                                  Subs_Virgula_por_Ponto(CurrToStr(vrCorrecao))+','+
                                  Subs_Virgula_por_Ponto(CurrToStr(vrMulta))+','+
                                  Subs_Virgula_por_Ponto(CurrToStr(vrJuros))+','+
                                  Subs_Virgula_por_Ponto(CurrToStr(vrDescoR))+','+
                                  Subs_Virgula_por_Ponto(CurrToStr(vrDescoC))+','+
                                  Subs_Virgula_por_Ponto(CurrToStr(vrDescoM))+','+
                                  Subs_Virgula_por_Ponto(CurrToStr(vrDescoJ))+','+
                                  '0'+
                                  ')'
                                  );
                 QDestino.ExecSQL();
               except
               end;
            end;


         QEventos.next;
         end;//laço do fi receitas


         end;//verifica se existe a parcela

   end;//localizou no fi_lancamento




    cont:=cont+1;
   QOrigem.next;
  end;

end;








procedure TFPrincipal.Button1Click(Sender: TObject);
begin

// nao esquecer de verificar quem um valor pago muito doido 999.999.999.999.999

//NotasFiscaisAvulsa;
NotasFiscaisAvulsaItens;

//AcertaContribuintes;
//AcertaContribuintes1;
//AcertaHistorico;
//Fiscais;

//graficas;
//aidf;

//leituras;
//leiturasCadastro;
//acertaMobiliario;
//AcertaTestada;

//gleba;
//agrupamento;
//AtualizaDados;
//Generators;

//limpa;

//indices;

//modulo;
//receitaprincipal;
//receitas;
//bancos;
//lotes;

{
 QDestino.close;
 QDestino.sql.clear;
 QDestino.sql.add('delete from fi_DIVIDAEXCLUIDAS');
 QDestino.execsql;

 QDestino.close;
 QDestino.sql.clear;
 QDestino.sql.add('delete from fi_DIVIDA WHERE LOGIN_INC_DIV=''DIVIDA''');
 QDestino.execsql;

 guias;

 QDestino.close;
 QDestino.sql.clear;
 QDestino.sql.add('delete from FI_PARCELASEXCLUIDAS');
 QDestino.execsql;

 QDestino.close;
 QDestino.sql.clear;
 QDestino.sql.add('delete from FI_PARCELA WHERE LOGIN_INC_PAR=''DIVIDA''');
 QDestino.execsql;

 parcelas;


 QDestino.close;
 QDestino.sql.clear;
 QDestino.sql.add('delete from fi_DIVIDAEXCLUIDAS');
 QDestino.execsql;

 QDestino.close;
 QDestino.sql.clear;
 QDestino.sql.add('delete from fi_DIVIDA WHERE LOGIN_INC_DIV=''PARCE''');
 QDestino.execsql;

 guiasParcelamento;


 QDestino.close;
 QDestino.sql.clear;
 QDestino.sql.add('delete from FI_PARCELASEXCLUIDAS');
 QDestino.execsql;

 QDestino.close;
 QDestino.sql.clear;
 QDestino.sql.add('delete from FI_PARCELA WHERE LOGIN_INC_PAR=''PARCE''');
 QDestino.execsql;

 parcelasParcelamentos;


 QDestino.close;
 QDestino.sql.clear;
 QDestino.sql.add('delete from FI_LANCAMENTO WHERE COD_EMP_LAN=1 AND TP_LAN=2');
 QDestino.execsql;
 lancamentos;

 QDestino.close;
 QDestino.sql.clear;
 QDestino.sql.add('delete from FI_ITENS WHERE COD_EMP_ITS=1 AND TP_LAN_ITS=2');
 QDestino.execsql;
 itens;

 QDestino.close;
 QDestino.sql.clear;
 QDestino.sql.add('delete from FI_LANCAMENTO where cod_emp_lan=1 and tp_lan=1');
 QDestino.execsql;

 lancamentosCobranca;

 QDestino.close;
 QDestino.sql.clear;
 QDestino.sql.add('delete from FI_ITENS where cod_emp_its=1 and tp_lan_its=1  ');
 QDestino.execsql;

 itensCobranca;
 }

//Juros;
//Multa;

// refis;
//dividaativa;
//AcertaCadastro;
//AcertaCadastroLancamento;
//atualizaDados;
//Fichasreceitas;
//Contabilizacao;
//BuscaContribuinteDiversos;


 end;

procedure TFPrincipal.FormCreate(Sender: TObject);
begin
  TD.TransactionID:=1;
  TD.IsolationLevel:=xilREADCOMMITTED;

end;

end.

